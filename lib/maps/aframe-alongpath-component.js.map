{"version":3,"sources":["aframe-alongpath-component.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","modules","__webpack_require__","moduleId","installedModules","id","loaded","m","c","p","AFRAME","registerComponent","schema","curve","default","triggers","triggerRadius","type","dur","delay","loop","rotate","constraint","x","y","z","resetonplay","init","update","oldData","this","document","querySelector","data","querySelectorAll","initialPosition","el","object3D","position","console","warn","reset","interval","removeState","activeTrigger","tick","time","timeDelta","components","is","setAttribute","points","addState","emit","getPoint","axis","THREE","Vector3","up","tangent","getTangentAt","normalize","crossVectors","radians","Math","acos","dot","quaternion","setFromAxisAngle","updateActiveTrigger","error","play","remove","copy","distanceTo"],"mappings":"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","file":"../aframe-alongpath-component.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/******/(function (modules) {\n\t// webpackBootstrap\n\t/******/ // The module cache\n\t/******/var installedModules = {};\n\n\t/******/ // The require function\n\t/******/function __webpack_require__(moduleId) {\n\n\t\t/******/ // Check if module is in cache\n\t\t/******/if (installedModules[moduleId])\n\t\t\t/******/return installedModules[moduleId].exports;\n\n\t\t/******/ // Create a new module (and put it into the cache)\n\t\t/******/var module = installedModules[moduleId] = {\n\t\t\t/******/exports: {},\n\t\t\t/******/id: moduleId,\n\t\t\t/******/loaded: false\n\t\t\t/******/ };\n\n\t\t/******/ // Execute the module function\n\t\t/******/modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t\t/******/ // Flag the module as loaded\n\t\t/******/module.loaded = true;\n\n\t\t/******/ // Return the exports of the module\n\t\t/******/return module.exports;\n\t\t/******/\n\t}\n\n\t/******/ // expose the modules object (__webpack_modules__)\n\t/******/__webpack_require__.m = modules;\n\n\t/******/ // expose the module cache\n\t/******/__webpack_require__.c = installedModules;\n\n\t/******/ // __webpack_public_path__\n\t/******/__webpack_require__.p = \"\";\n\n\t/******/ // Load entry module and return exports\n\t/******/return __webpack_require__(0);\n\t/******/\n})(\n/************************************************************************/\n/******/[\n/* 0 */\n/***/function (module, exports) {\n\n\tif (typeof AFRAME === 'undefined') {\n\t\tthrow new Error('Component attempted to register before AFRAME was available.');\n\t}\n\n\t/**\n  * Alongpath component for A-Frame.\n  * Move Entities along a predefined Curve\n  */\n\tAFRAME.registerComponent('alongpath', {\n\n\t\t//dependencies: ['curve'],\n\n\t\tschema: {\n\t\t\tcurve: { default: '' },\n\t\t\ttriggers: { default: 'a-curve-point' },\n\t\t\ttriggerRadius: { type: 'number', default: 0.01 },\n\t\t\tdur: { default: 1000 },\n\t\t\tdelay: { default: 0 },\n\t\t\tloop: { default: false },\n\t\t\trotate: { default: false },\n\t\t\tconstraint: { type: 'vec3', default: { x: 0, y: 0, z: 1 } },\n\t\t\tresetonplay: { default: true }\n\t\t},\n\n\t\tinit: function init() {\n\n\t\t\t// We have to fetch curve and triggers manually because of an A-FRAME ISSUE\n\t\t\t// with Property-Type \"Selector\" / \"SelectorAll\": https://github.com/aframevr/aframe/issues/2517\n\n\t\t},\n\n\t\tupdate: function update(oldData) {\n\n\t\t\tthis.curve = document.querySelector(this.data.curve);\n\t\t\tthis.triggers = this.curve.querySelectorAll(this.data.triggers);\n\n\t\t\tif (!this.curve) {\n\t\t\t\tconsole.warn(\"Curve not found. Can't follow anything...\");\n\t\t\t} else {\n\t\t\t\tthis.initialPosition = this.el.object3D.position;\n\t\t\t}\n\n\t\t\tthis.reset();\n\t\t},\n\n\t\treset: function reset() {\n\t\t\t// Reset to initial state\n\t\t\tthis.interval = 0;\n\n\t\t\tthis.el.removeState(\"endofpath\");\n\t\t\tthis.el.removeState(\"moveonpath\");\n\n\t\t\tif (this.activeTrigger) {\n\t\t\t\tthis.activeTrigger.removeState(\"alongpath-active-trigger\");\n\t\t\t\tthis.activeTrigger = null;\n\t\t\t}\n\t\t},\n\n\t\ttick: function tick(time, timeDelta) {\n\t\t\tvar curve = this.curve.components['curve'] ? this.curve.components['curve'].curve : null;\n\n\t\t\tif (curve) {\n\t\t\t\t// Only update position if we didn't reach\n\t\t\t\t// the end of the path\n\t\t\t\tif (!this.el.is(\"endofpath\")) {\n\t\t\t\t\tthis.interval = this.interval + timeDelta;\n\n\t\t\t\t\tvar i = 0;\n\n\t\t\t\t\tif (this.interval - this.data.delay >= this.data.dur) {\n\t\t\t\t\t\t// Time is up, we should be at the end of the path\n\t\t\t\t\t\ti = 1;\n\t\t\t\t\t} else if (this.interval - this.data.delay < 0) {\n\t\t\t\t\t\t// We are still waiting for the delay-time to finish\n\t\t\t\t\t\t// so keep entity at the beginning of the path\n\t\t\t\t\t\ti = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Update path position based on timing\n\t\t\t\t\t\ti = (this.interval - this.data.delay) / this.data.dur;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.data.loop === false && i >= 1) {\n\t\t\t\t\t\t// Set the end-position\n\t\t\t\t\t\tthis.el.setAttribute('position', curve.points[curve.points.length - 1]);\n\n\t\t\t\t\t\t// We have reached the end of the path and are not going\n\t\t\t\t\t\t// to loop back to the beginning therefore set final state\n\t\t\t\t\t\tthis.el.removeState(\"moveonpath\");\n\t\t\t\t\t\tthis.el.addState(\"endofpath\");\n\t\t\t\t\t\tthis.el.emit(\"movingended\");\n\t\t\t\t\t} else if (this.data.loop === true && i >= 1) {\n\t\t\t\t\t\t// We have reached the end of the path\n\t\t\t\t\t\t// but we are looping through the curve,\n\t\t\t\t\t\t// so restart here.\n\t\t\t\t\t\tthis.el.emit(\"movingended\");\n\t\t\t\t\t\tthis.interval = this.data.delay;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We are starting to move or somewhere in the middle of the path…\n\t\t\t\t\t\tif (!this.el.is(\"moveonpath\")) {\n\t\t\t\t\t\t\tthis.el.addState(\"moveonpath\");\n\t\t\t\t\t\t\tthis.el.emit(\"movingstarted\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// …updating position\n\t\t\t\t\t\tvar p = curve.getPoint(i);\n\t\t\t\t\t\tthis.el.setAttribute('position', p);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update Rotation of Entity\n\t\t\t\t\t// Based on http://jsfiddle.net/qGPTT/133/\n\t\t\t\t\tif (this.data.rotate === true) {\n\t\t\t\t\t\tvar axis = new THREE.Vector3();\n\t\t\t\t\t\t// forward vector, allows customization of which x,y,z component is up during the path movement\n\t\t\t\t\t\tvar up = new THREE.Vector3(this.data.constraint.x, this.data.constraint.y, this.data.constraint.z);\n\t\t\t\t\t\t//var up = new THREE.Vector3(0, 0, 1); // previous code\n\t\t\t\t\t\tvar tangent = curve.getTangentAt(i).normalize();\n\n\t\t\t\t\t\taxis.crossVectors(up, tangent).normalize();\n\n\t\t\t\t\t\tvar radians = Math.acos(up.dot(tangent));\n\n\t\t\t\t\t\tthis.el.object3D.quaternion.setFromAxisAngle(axis, radians);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Check for Active-Triggers\n\t\t\t\t\tif (this.triggers && this.triggers.length > 0) {\n\t\t\t\t\t\tthis.updateActiveTrigger();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.error(\"The entity associated with the curve property has no curve component.\");\n\t\t\t}\n\t\t},\n\n\t\tplay: function play() {\n\t\t\tif (this.data.resetonplay) {\n\t\t\t\tthis.reset();\n\t\t\t}\n\t\t},\n\n\t\tremove: function remove() {\n\t\t\tthis.el.object3D.position.copy(this.initialPosition);\n\t\t},\n\n\t\tupdateActiveTrigger: function updateActiveTrigger() {\n\t\t\tfor (var i = 0; i < this.triggers.length; i++) {\n\t\t\t\tif (this.triggers[i].object3D) {\n\t\t\t\t\tif (this.triggers[i].object3D.position.distanceTo(this.el.object3D.position) <= this.data.triggerRadius) {\n\t\t\t\t\t\t// If this element is not the active trigger, activate it - and if necessary deactivate other triggers.\n\t\t\t\t\t\tif (this.activeTrigger && this.activeTrigger != this.triggers[i]) {\n\t\t\t\t\t\t\tthis.activeTrigger.removeState(\"alongpath-active-trigger\");\n\t\t\t\t\t\t\tthis.activeTrigger.emit(\"alongpath-trigger-deactivated\");\n\n\t\t\t\t\t\t\tthis.activeTrigger = this.triggers[i];\n\t\t\t\t\t\t\tthis.activeTrigger.addState(\"alongpath-active-trigger\");\n\t\t\t\t\t\t\tthis.activeTrigger.emit(\"alongpath-trigger-activated\");\n\t\t\t\t\t\t} else if (!this.activeTrigger) {\n\t\t\t\t\t\t\tthis.activeTrigger = this.triggers[i];\n\t\t\t\t\t\t\tthis.activeTrigger.addState(\"alongpath-active-trigger\");\n\t\t\t\t\t\t\tthis.activeTrigger.emit(\"alongpath-trigger-activated\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If this Element was the active trigger, deactivate it\n\t\t\t\t\t\tif (this.activeTrigger && this.activeTrigger == this.triggers[i]) {\n\t\t\t\t\t\t\tthis.activeTrigger.removeState(\"alongpath-active-trigger\");\n\t\t\t\t\t\t\tthis.activeTrigger.emit(\"alongpath-trigger-deactivated\");\n\t\t\t\t\t\t\tthis.activeTrigger = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t});\n\n\t/***/\n}]\n/******/);\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYWZyYW1lLWFsb25ncGF0aC1jb21wb25lbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0FBLFFBQVMsQ0FBQyxVQUFTLE9BQVQsRUFBa0I7QUFBRTtBQUM5QixTQUQ0QixDQUNsQjtBQUNWLFNBQVUsSUFBSSxtQkFBbUIsRUFBdkI7O0FBRVYsU0FKNEIsQ0FJbEI7QUFDVixTQUFVLFNBQVMsbUJBQVQsQ0FBNkIsUUFBN0IsRUFBdUM7O0FBRWpELFVBRmlELENBRXRDO0FBQ1gsVUFBVyxJQUFHLGlCQUFpQixRQUFqQixDQUFIO0FBQ1gsV0FBWSxPQUFPLGlCQUFpQixRQUFqQixFQUEyQixPQUFsQzs7QUFFWixVQU5pRCxDQU10QztBQUNYLFVBQVcsSUFBSSxTQUFTLGlCQUFpQixRQUFqQixJQUE2QjtBQUNyRCxXQUFZLFNBQVMsRUFEZ0M7QUFFckQsV0FBWSxJQUFJLFFBRnFDO0FBR3JELFdBQVksUUFBUTtBQUNwQixXQUpxRCxFQUExQzs7QUFNWCxVQWJpRCxDQWF0QztBQUNYLFVBQVcsUUFBUSxRQUFSLEVBQWtCLElBQWxCLENBQXVCLE9BQU8sT0FBOUIsRUFBdUMsTUFBdkMsRUFBK0MsT0FBTyxPQUF0RCxFQUErRCxtQkFBL0Q7O0FBRVgsVUFoQmlELENBZ0J0QztBQUNYLFVBQVcsT0FBTyxNQUFQLEdBQWdCLElBQWhCOztBQUVYLFVBbkJpRCxDQW1CdEM7QUFDWCxVQUFXLE9BQU8sT0FBTyxPQUFkO0FBQ1g7QUFBVzs7QUFHWCxTQTdCNEIsQ0E2QmxCO0FBQ1YsU0FBVSxvQkFBb0IsQ0FBcEIsR0FBd0IsT0FBeEI7O0FBRVYsU0FoQzRCLENBZ0NsQjtBQUNWLFNBQVUsb0JBQW9CLENBQXBCLEdBQXdCLGdCQUF4Qjs7QUFFVixTQW5DNEIsQ0FtQ2xCO0FBQ1YsU0FBVSxvQkFBb0IsQ0FBcEIsR0FBd0IsRUFBeEI7O0FBRVYsU0F0QzRCLENBc0NsQjtB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QUFLLEVBQUwsQ0FBUSxRQUFSLENBQWlCLFFBQS9ELEtBQTRFLEtBQUssSUFBTCxDQUFVLGFBQTFGLEVBQXlHO0FBQ3JHO0FBQ0EsVUFBSSxLQUFLLGFBQUwsSUFBdUIsS0FBSyxhQUFMLElBQXNCLEtBQUssUUFBTCxDQUFjLENBQWQsQ0FBakQsRUFBb0U7QUFDaEUsWUFBSyxhQUFMLENBQW1CLFdBQW5CLENBQStCLDBCQUEvQjtBQUNBLFlBQUssYUFBTCxDQUFtQixJQUFuQixDQUF3QiwrQkFBeEI7O0FBRUEsWUFBSyxhQUFMLEdBQXFCLEtBQUssUUFBTCxDQUFjLENBQWQsQ0FBckI7QUFDQSxZQUFLLGFBQUwsQ0FBbUIsUUFBbkIsQ0FBNEIsMEJBQTVCO0FBQ0EsWUFBSyxhQUFMLENBQW1CLElBQW5CLENBQXdCLDZCQUF4QjtBQUNILE9BUEQsTUFPTyxJQUFJLENBQUMsS0FBSyxhQUFWLEVBQXlCO0FBQzVCLFlBQUssYUFBTCxHQUFxQixLQUFLLFFBQUwsQ0FBYyxDQUFkLENBQXJCO0FBQ0EsWUFBSyxhQUFMLENBQW1CLFFBQW5CLENBQTRCLDBCQUE1QjtBQUNBLFlBQUssYUFBTCxDQUFtQixJQUFuQixDQUF3Qiw2QkFBeEI7QUFDSDs7QUFFRDtBQUNILE1BaEJELE1BZ0JPO0FBQ0g7QUFDQSxVQUFJLEtBQUssYUFBTCxJQUF1QixLQUFLLGFBQUwsSUFBc0IsS0FBSyxRQUFMLENBQWMsQ0FBZCxDQUFqRCxFQUFvRTtBQUNoRSxZQUFLLGFBQUwsQ0FBbUIsV0FBbkIsQ0FBK0IsMEJBQS9CO0FBQ0EsWUFBSyxhQUFMLENBQW1CLElBQW5CLENBQXdCLCtCQUF4QjtBQUNBLFlBQUssYUFBTCxHQUFxQixJQUFyQjtBQUNIO0FBQ0o7QUFDSjtBQUNKO0FBQ0o7O0FBcktpQyxFQUF0Qzs7QUF5S0Q7QUFBTyxDQXJMRztBQXNMVixRQWhPUyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuLyoqKioqKi8gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuLyoqKioqKi8gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuXG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fSxcbi8qKioqKiovIFx0XHRcdGlkOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGxvYWRlZDogZmFsc2Vcbi8qKioqKiovIFx0XHR9O1xuXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmxvYWRlZCA9IHRydWU7XG5cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuXG5cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbi8qKioqKiovIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vKioqKioqLyBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKDApO1xuLyoqKioqKi8gfSlcbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKioqKioqLyAoW1xuLyogMCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdGlmICh0eXBlb2YgQUZSQU1FID09PSAndW5kZWZpbmVkJykge1xuXHQgICAgdGhyb3cgbmV3IEVycm9yKCdDb21wb25lbnQgYXR0ZW1wdGVkIHRvIHJlZ2lzdGVyIGJlZm9yZSBBRlJBTUUgd2FzIGF2YWlsYWJsZS4nKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBBbG9uZ3BhdGggY29tcG9uZW50IGZvciBBLUZyYW1lLlxuXHQgKiBNb3ZlIEVudGl0aWVzIGFsb25nIGEgcHJlZGVmaW5lZCBDdXJ2ZVxuXHQgKi9cblx0QUZSQU1FLnJlZ2lzdGVyQ29tcG9uZW50KCdhbG9uZ3BhdGgnLCB7XG5cblx0ICAgIC8vZGVwZW5kZW5jaWVzOiBbJ2N1cnZlJ10sXG5cblx0ICAgIHNjaGVtYToge1xuXHQgICAgICAgIGN1cnZlOiB7ZGVmYXVsdDogJyd9LFxuXHQgICAgICAgIHRyaWdnZXJzOiB7ZGVmYXVsdDogJ2EtY3VydmUtcG9pbnQnfSxcblx0ICAgICAgICB0cmlnZ2VyUmFkaXVzOiB7dHlwZTogJ251bWJlcicsIGRlZmF1bHQ6IDAuMDF9LFxuXHQgICAgICAgIGR1cjoge2RlZmF1bHQ6IDEwMDB9LFxuXHQgICAgICAgIGRlbGF5OiB7ZGVmYXVsdDogMH0sXG5cdCAgICAgICAgbG9vcDoge2RlZmF1bHQ6IGZhbHNlfSxcblx0ICAgICAgICByb3RhdGU6IHtkZWZhdWx0OiBmYWxzZX0sXG5cdCAgICAgICAgY29uc3RyYWludDoge3R5cGU6ICd2ZWMzJywgZGVmYXVsdDogeyB4OiAwLCB5OiAwLCB6OiAxIH19LFxuXHQgICAgICAgIHJlc2V0b25wbGF5OiB7ZGVmYXVsdDp0cnVlfVxuXHQgICAgfSxcblxuXHQgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuXG5cdCAgICAgICAgLy8gV2UgaGF2ZSB0byBmZXRjaCBjdXJ2ZSBhbmQgdHJpZ2dlcnMgbWFudWFsbHkgYmVjYXVzZSBvZiBhbiBBLUZSQU1FIElTU1VFXG5cdCAgICAgICAgLy8gd2l0aCBQcm9wZXJ0eS1UeXBlIFwiU2VsZWN0b3JcIiAvIFwiU2VsZWN0b3JBbGxcIjogaHR0cHM6Ly9naXRodWIuY29tL2FmcmFtZXZyL2FmcmFtZS9pc3N1ZXMvMjUxN1xuXG5cdCAgICB9LFxuXG5cdCAgICB1cGRhdGU6IGZ1bmN0aW9uIChvbGREYXRhKSB7XG5cblx0ICAgICAgICB0aGlzLmN1cnZlID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLmRhdGEuY3VydmUpO1xuXHQgICAgICAgIHRoaXMudHJpZ2dlcnMgPSB0aGlzLmN1cnZlLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5kYXRhLnRyaWdnZXJzKTtcblxuXHQgICAgICAgIGlmICghdGhpcy5jdXJ2ZSkge1xuXHQgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJDdXJ2ZSBub3QgZm91bmQuIENhbid0IGZvbGxvdyBhbnl0aGluZy4uLlwiKTtcblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICB0aGlzLmluaXRpYWxQb3NpdGlvbiA9IHRoaXMuZWwub2JqZWN0M0QucG9zaXRpb247XG5cdCAgICAgICAgfVxuXG5cdCAgICAgICAgdGhpcy5yZXNldCgpO1xuXHQgICAgfSxcblxuXHQgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuXHQgICAgICAgIC8vIFJlc2V0IHRvIGluaXRpYWwgc3RhdGVcblx0ICAgICAgICB0aGlzLmludGVydmFsID0gMDtcblxuXHQgICAgICAgIHRoaXMuZWwucmVtb3ZlU3RhdGUoXCJlbmRvZnBhdGhcIik7XG5cdCAgICAgICAgdGhpcy5lbC5yZW1vdmVTdGF0ZShcIm1vdmVvbnBhdGhcIik7XG5cblx0ICAgICAgICBpZiAodGhpcy5hY3RpdmVUcmlnZ2VyKSB7XG5cdCAgICAgICAgICAgIHRoaXMuYWN0aXZlVHJpZ2dlci5yZW1vdmVTdGF0ZShcImFsb25ncGF0aC1hY3RpdmUtdHJpZ2dlclwiKTtcblx0ICAgICAgICAgICAgdGhpcy5hY3RpdmVUcmlnZ2VyID0gbnVsbDtcblx0ICAgICAgICB9XG5cdCAgICB9LFxuXG5cdCAgICB0aWNrOiBmdW5jdGlvbiAodGltZSwgdGltZURlbHRhKSB7XG5cdCAgICAgICAgdmFyIGN1cnZlID0gdGhpcy5jdXJ2ZS5jb21wb25lbnRzWydjdXJ2ZSddID8gdGhpcy5jdXJ2ZS5jb21wb25lbnRzWydjdXJ2ZSddLmN1cnZlIDogbnVsbDtcblxuXHQgICAgICAgIGlmIChjdXJ2ZSkge1xuXHQgICAgICAgICAgICAvLyBPbmx5IHVwZGF0ZSBwb3NpdGlvbiBpZiB3ZSBkaWRuJ3QgcmVhY2hcblx0ICAgICAgICAgICAgLy8gdGhlIGVuZCBvZiB0aGUgcGF0aFxuXHQgICAgICAgICAgICBpZiAoIXRoaXMuZWwuaXMoXCJlbmRvZnBhdGhcIikpIHtcblx0ICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJ2YWwgPSB0aGlzLmludGVydmFsICsgdGltZURlbHRhO1xuXG5cdCAgICAgICAgICAgICAgICB2YXIgaSA9IDA7XG5cblx0ICAgICAgICAgICAgICAgIGlmICh0aGlzLmludGVydmFsIC0gdGhpcy5kYXRhLmRlbGF5ID49IHRoaXMuZGF0YS5kdXIpIHtcblx0ICAgICAgICAgICAgICAgICAgICAvLyBUaW1lIGlzIHVwLCB3ZSBzaG91bGQgYmUgYXQgdGhlIGVuZCBvZiB0aGUgcGF0aFxuXHQgICAgICAgICAgICAgICAgICAgIGkgPSAxO1xuXHQgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgodGhpcy5pbnRlcnZhbCAtIHRoaXMuZGF0YS5kZWxheSA8IDApKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgLy8gV2UgYXJlIHN0aWxsIHdhaXRpbmcgZm9yIHRoZSBkZWxheS10aW1lIHRvIGZpbmlzaFxuXHQgICAgICAgICAgICAgICAgICAgIC8vIHNvIGtlZXAgZW50aXR5IGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHBhdGhcblx0ICAgICAgICAgICAgICAgICAgICBpID0gMDtcblx0ICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIHBhdGggcG9zaXRpb24gYmFzZWQgb24gdGltaW5nXG5cdCAgICAgICAgICAgICAgICAgICAgaSA9ICh0aGlzLmludGVydmFsIC0gdGhpcy5kYXRhLmRlbGF5KSAvIHRoaXMuZGF0YS5kdXI7XG5cdCAgICAgICAgICAgICAgICB9XG5cblx0ICAgICAgICAgICAgICAgIGlmICgodGhpcy5kYXRhLmxvb3AgPT09IGZhbHNlKSAmJiBpID49IDEpIHtcblx0ICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdGhlIGVuZC1wb3NpdGlvblxuXHQgICAgICAgICAgICAgICAgICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGN1cnZlLnBvaW50c1tjdXJ2ZS5wb2ludHMubGVuZ3RoIC0gMV0pO1xuXG5cdCAgICAgICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSByZWFjaGVkIHRoZSBlbmQgb2YgdGhlIHBhdGggYW5kIGFyZSBub3QgZ29pbmdcblx0ICAgICAgICAgICAgICAgICAgICAvLyB0byBsb29wIGJhY2sgdG8gdGhlIGJlZ2lubmluZyB0aGVyZWZvcmUgc2V0IGZpbmFsIHN0YXRlXG5cdCAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC5yZW1vdmVTdGF0ZShcIm1vdmVvbnBhdGhcIik7XG5cdCAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC5hZGRTdGF0ZShcImVuZG9mcGF0aFwiKTtcblx0ICAgICAgICAgICAgICAgICAgICB0aGlzLmVsLmVtaXQoXCJtb3ZpbmdlbmRlZFwiKTtcblx0ICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKHRoaXMuZGF0YS5sb29wID09PSB0cnVlKSAmJiBpID49IDEpIHtcblx0ICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgcGF0aFxuXHQgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCB3ZSBhcmUgbG9vcGluZyB0aHJvdWdoIHRoZSBjdXJ2ZSxcblx0ICAgICAgICAgICAgICAgICAgICAvLyBzbyByZXN0YXJ0IGhlcmUuXG5cdCAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC5lbWl0KFwibW92aW5nZW5kZWRcIik7XG5cdCAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcnZhbCA9IHRoaXMuZGF0YS5kZWxheTtcblx0ICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgICAgICAgICAgLy8gV2UgYXJlIHN0YXJ0aW5nIHRvIG1vdmUgb3Igc29tZXdoZXJlIGluIHRoZSBtaWRkbGUgb2YgdGhlIHBhdGjigKZcblx0ICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZWwuaXMoXCJtb3Zlb25wYXRoXCIpKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZWwuYWRkU3RhdGUoXCJtb3Zlb25wYXRoXCIpO1xuXHQgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVsLmVtaXQoXCJtb3ZpbmdzdGFydGVkXCIpO1xuXHQgICAgICAgICAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICAgICAgICAgIC8vIOKApnVwZGF0aW5nIHBvc2l0aW9uXG5cdCAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSBjdXJ2ZS5nZXRQb2ludChpKTtcblx0ICAgICAgICAgICAgICAgICAgICB0aGlzLmVsLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBwKTtcblx0ICAgICAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICAgICAgLy8gVXBkYXRlIFJvdGF0aW9uIG9mIEVudGl0eVxuXHQgICAgICAgICAgICAgICAgLy8gQmFzZWQgb24gaHR0cDovL2pzZmlkZGxlLm5ldC9xR1BUVC8xMzMvXG5cdCAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhLnJvdGF0ZSA9PT0gdHJ1ZSkge1xuXHQgICAgICAgICAgICAgICAgICAgIHZhciBheGlzID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcblx0ICAgICAgICAgICAgICAgIFx0Ly8gZm9yd2FyZCB2ZWN0b3IsIGFsbG93cyBjdXN0b21pemF0aW9uIG9mIHdoaWNoIHgseSx6IGNvbXBvbmVudCBpcyB1cCBkdXJpbmcgdGhlIHBhdGggbW92ZW1lbnRcblx0ICAgICAgICAgICAgICAgICAgICB2YXIgdXAgPSBuZXcgVEhSRUUuVmVjdG9yMyh0aGlzLmRhdGEuY29uc3RyYWludC54LCB0aGlzLmRhdGEuY29uc3RyYWludC55LCB0aGlzLmRhdGEuY29uc3RyYWludC56KTtcblx0ICAgICAgICAgICAgICAgICAgICAvL3ZhciB1cCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDEpOyAvLyBwcmV2aW91cyBjb2RlXG5cdCAgICAgICAgICAgICAgICAgICAgdmFyIHRhbmdlbnQgPSBjdXJ2ZS5nZXRUYW5nZW50QXQoaSkubm9ybWFsaXplKCk7XG5cblx0ICAgICAgICAgICAgICAgICAgICBheGlzLmNyb3NzVmVjdG9ycyh1cCwgdGFuZ2VudCkubm9ybWFsaXplKCk7XG5cblx0ICAgICAgICAgICAgICAgICAgICB2YXIgcmFkaWFucyA9IE1hdGguYWNvcyh1cC5kb3QodGFuZ2VudCkpO1xuXG5cdCAgICAgICAgICAgICAgICAgICAgdGhpcy5lbC5vYmplY3QzRC5xdWF0ZXJuaW9uLnNldEZyb21BeGlzQW5nbGUoYXhpcywgcmFkaWFucyk7XG5cdCAgICAgICAgICAgICAgICB9XG5cblx0ICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBBY3RpdmUtVHJpZ2dlcnNcblx0ICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyaWdnZXJzICYmICh0aGlzLnRyaWdnZXJzLmxlbmd0aCA+IDApKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVBY3RpdmVUcmlnZ2VyKCk7XG5cdCAgICAgICAgICAgICAgICB9XG5cdCAgICAgICAgICAgIH1cblx0ICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVGhlIGVudGl0eSBhc3NvY2lhdGVkIHdpdGggdGhlIGN1cnZlIHByb3BlcnR5IGhhcyBubyBjdXJ2ZSBjb21wb25lbnQuXCIpO1x0XG5cdCAgICAgICAgfVxuXHQgICAgfSxcblxuXHQgICAgcGxheTogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIGlmICh0aGlzLmRhdGEucmVzZXRvbnBsYXkpIHtcblx0ICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuXHQgICAgICAgIH1cblx0ICAgIH0sXG5cblx0ICAgIHJlbW92ZTogZnVuY3Rpb24gKCkge1xuXHQgICAgICAgIHRoaXMuZWwub2JqZWN0M0QucG9zaXRpb24uY29weSh0aGlzLmluaXRpYWxQb3NpdGlvbik7XG5cdCAgICB9LFxuXG5cdCAgICB1cGRhdGVBY3RpdmVUcmlnZ2VyOiBmdW5jdGlvbigpIHtcblx0ICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudHJpZ2dlcnMubGVuZ3RoOyBpKyspIHtcblx0ICAgICAgICAgICAgaWYgKHRoaXMudHJpZ2dlcnNbaV0ub2JqZWN0M0QpIHtcblx0ICAgICAgICAgICAgICAgIGlmICh0aGlzLnRyaWdnZXJzW2ldLm9iamVjdDNELnBvc2l0aW9uLmRpc3RhbmNlVG8odGhpcy5lbC5vYmplY3QzRC5wb3NpdGlvbikgPD0gdGhpcy5kYXRhLnRyaWdnZXJSYWRpdXMpIHtcblx0ICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGVsZW1lbnQgaXMgbm90IHRoZSBhY3RpdmUgdHJpZ2dlciwgYWN0aXZhdGUgaXQgLSBhbmQgaWYgbmVjZXNzYXJ5IGRlYWN0aXZhdGUgb3RoZXIgdHJpZ2dlcnMuXG5cdCAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlVHJpZ2dlciAmJiAodGhpcy5hY3RpdmVUcmlnZ2VyICE9IHRoaXMudHJpZ2dlcnNbaV0pKSB7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlVHJpZ2dlci5yZW1vdmVTdGF0ZShcImFsb25ncGF0aC1hY3RpdmUtdHJpZ2dlclwiKTtcblx0ICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmVUcmlnZ2VyLmVtaXQoXCJhbG9uZ3BhdGgtdHJpZ2dlci1kZWFjdGl2YXRlZFwiKTtcblxuXHQgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXIgPSB0aGlzLnRyaWdnZXJzW2ldO1xuXHQgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXIuYWRkU3RhdGUoXCJhbG9uZ3BhdGgtYWN0aXZlLXRyaWdnZXJcIik7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlVHJpZ2dlci5lbWl0KFwiYWxvbmdwYXRoLXRyaWdnZXItYWN0aXZhdGVkXCIpO1xuXHQgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuYWN0aXZlVHJpZ2dlcikge1xuXHQgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXIgPSB0aGlzLnRyaWdnZXJzW2ldO1xuXHQgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXIuYWRkU3RhdGUoXCJhbG9uZ3BhdGgtYWN0aXZlLXRyaWdnZXJcIik7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlVHJpZ2dlci5lbWl0KFwiYWxvbmdwYXRoLXRyaWdnZXItYWN0aXZhdGVkXCIpO1xuXHQgICAgICAgICAgICAgICAgICAgIH1cblxuXHQgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXHQgICAgICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIEVsZW1lbnQgd2FzIHRoZSBhY3RpdmUgdHJpZ2dlciwgZGVhY3RpdmF0ZSBpdFxuXHQgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZVRyaWdnZXIgJiYgKHRoaXMuYWN0aXZlVHJpZ2dlciA9PSB0aGlzLnRyaWdnZXJzW2ldKSkge1xuXHQgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXIucmVtb3ZlU3RhdGUoXCJhbG9uZ3BhdGgtYWN0aXZlLXRyaWdnZXJcIik7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlVHJpZ2dlci5lbWl0KFwiYWxvbmdwYXRoLXRyaWdnZXItZGVhY3RpdmF0ZWRcIik7XG5cdCAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZlVHJpZ2dlciA9IG51bGw7XG5cdCAgICAgICAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICAgICAgfVxuXHQgICAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgfVxuXG5cdH0pO1xuXG4vKioqLyB9KVxuLyoqKioqKi8gXSk7Il19\n"]}