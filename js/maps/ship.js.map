{"version":3,"sources":["ship.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module"],"mappings":"CAAA,SAAUA,EAAEC,EAAEC,EAAEC,GAAG,SAASC,EAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,IAAIE,EAAkB,mBAATC,SAAqBA,QAAQ,IAAIF,GAAGC,EAAE,OAAOA,EAAEF,GAAE,GAAI,GAAGI,EAAE,OAAOA,EAAEJ,GAAE,GAAI,IAAIK,EAAE,IAAIC,MAAM,uBAAuBN,EAAE,KAAK,MAAMK,EAAEE,KAAK,mBAAmBF,EAAE,IAAIG,EAAEX,EAAEG,IAAIS,YAAYb,EAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,IAAIE,EAAED,EAAEI,GAAG,GAAGL,GAAG,OAAOI,EAAEF,GAAIF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,OAAOD,EAAEG,GAAGS,QAAkD,IAAI,IAA1CL,EAAkB,mBAATD,SAAqBA,QAAgBH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,IAAI,OAAOD,EAAvb,EAA4ba,GAAG,SAAST,EAAQU,EAAOJ,GACvd,uBAqOW","file":"../ship.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\nfunction Ship() {\n\tvar action = {\n\t\trender: function render(data, OPTION) {\n\t\t\tvar attr = {\n\t\t\t\t\"dom\": null, // ships html dom component\n\t\t\t\t\"health\": null, // ship's health bar, display as dots\n\t\t\t\t\"color\": null, // ship color\n\t\t\t\t\"name\": null, // ship's display name\n\t\t\t\t\"owner\": null,\n\t\t\t\t\"id\": null,\n\t\t\t\t\"x\": null,\n\t\t\t\t\"y\": null,\n\t\t\t\t\"z\": null,\n\t\t\t\t\"firepower\": null,\n\t\t\t\t\"hull\": null,\n\t\t\t\t\"speed\": null,\n\t\t\t\t\"range\": null,\n\t\t\t\t\"sunk\": null\n\t\t\t};\n\t\t\tfor (var keys in data) {\n\t\t\t\tattr[keys] = data[keys];\n\t\t\t}\n\n\t\t\tvar doc = document.getElementById('scene');\n\t\t\tvar ship = document.createElement('a-entity');\n\n\t\t\tship.setAttribute('position', data.x + ' ' + data.y + ' ' + data.z);\n\t\t\tif (attr.color === 'rgb(255, 255, 0)') {\n\t\t\t\tship.setAttribute('template', 'src: #submarine-template');\n\t\t\t\tship.setAttribute('class', 'submarine');\n\t\t\t} else {\n\t\t\t\tship.setAttribute('template', 'src: #boat-template');\n\t\t\t\tship.setAttribute('class', 'boat');\n\t\t\t}\n\n\t\t\tvar heart = '';\n\t\t\tfor (var i = 0; i < attr.hull; i++) {\n\t\t\t\theart += ' •';\n\t\t\t}\n\t\t\tattr.health = heart;\n\n\t\t\t// ${variable} <- variable name be lower case\n\t\t\tship.setAttribute('data-ship_color', 'color: ' + attr.color + '; metalness: 0.4;');\n\t\t\tship.setAttribute('data-ship_name', 'value: ' + attr.name + '; font: #play;');\n\t\t\tship.setAttribute('data-ship_health', 'value: ' + heart + ';');\n\n\t\t\tattr.dom = doc.appendChild(ship);\n\n\t\t\treturn attr;\n\t\t},\n\n\t\tsinkShip: function sinkShip(data, OPTION) {\n\t\t\tconsole.log('sink: ', data);\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar doc = document.getElementById('scene');\n\t\t\t\tvar track = document.getElementById('track');\n\t\t\t\tvar action = data.present.next.actions[0]; // sink action should only have a size of one\n\t\t\t\tvar ship = data.html[action.id];\n\n\t\t\t\tvar debug = document.createElement('a-draw-curve');\n\t\t\t\tdebug.setAttribute('curveref', '#track');\n\t\t\t\tdebug.setAttribute('material', 'shader: line; color: black;');\n\t\t\t\tdoc.appendChild(debug);\n\n\t\t\t\tvar point1 = document.createElement('a-curve-point');\n\t\t\t\tvar point2 = document.createElement('a-curve-point');\n\t\t\t\tpoint1.setAttribute('position', action.x + ' ' + action.y + ' ' + action.z);\n\t\t\t\tpoint2.setAttribute('position', action.x + ' ' + (action.y - OPTION.SinkDistance) + ' ' + action.z);\n\t\t\t\ttrack.appendChild(point1);\n\t\t\t\ttrack.appendChild(point2);\n\n\t\t\t\tship.dom.setAttribute('alongpath', 'curve: #track; rotate: true; constraint: 0 1 0; delay: ' + OPTION.WaitTimeBetweenAction + '; dur: 3000;');\n\n\t\t\t\tship.dom.addEventListener('movingended', function () {\n\t\t\t\t\tship.dom.removeAttribute('alongpath');\n\t\t\t\t\tif (debug.parentNode) {\n\t\t\t\t\t\tdoc.removeChild(debug);\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (track.hasChildNodes()) {\n\t\t\t\t\t\ttrack.removeChild(track.childNodes[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\tship.dom.removeAttribute('alongpath');\n\t\t\t\t\tship.dom.setAttribute('visible', false);\n\t\t\t\t\t// shipDom.childNodes.forEach((node) => {\n\t\t\t\t\t// \tconsole.log(node);\n\t\t\t\t\t// \tnode.setAttribute('visible', false);\n\t\t\t\t\t// });\n\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\thitShip: function hitShip(data) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar action = data.present.next.actions[0];\n\t\t\t\tvar ship = data.html[action.id];\n\t\t\t\tvar heart = '';\n\n\t\t\t\tfor (var i = 0; i < data[0].health; i++) {\n\t\t\t\t\theart += ' •';\n\t\t\t\t}\n\n\t\t\t\tfor (var _i = 0; _i < ship.dom.childNodes.length; _i++) {\n\t\t\t\t\tif (ship.dom.childNodes[_i].className === 'ship-health') {\n\t\t\t\t\t\tship.dom.childNodes[_i].setAttribute('text-geometry', 'value: ' + heart + ';');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t},\n\n\t\tfireShip: function fireShip(data, OPTION) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar doc = document.getElementById('scene');\n\t\t\t\tvar track = document.getElementById('track');\n\n\t\t\t\tvar bullet = document.createElement('a-sphere');\n\t\t\t\tvar source = document.createElement('a-curve-point');\n\t\t\t\tvar arc = document.createElement('a-curve-point');\n\t\t\t\tvar target = document.createElement('a-curve-point');\n\t\t\t\tbullet.setAttribute('color', 'gray');\n\t\t\t\tbullet.setAttribute('radius', '0.1');\n\t\t\t\tbullet.setAttribute('position', data[0].x + ' ' + data[0].y + ' ' + data[0].z);\n\t\t\t\tsource.setAttribute('position', data[0].x + ' ' + data[0].y + ' ' + data[0].z);\n\t\t\t\ttarget.setAttribute('position', data[0].atX + ' ' + data[0].atY + ' ' + data[0].atZ);\n\t\t\t\tarc.setAttribute('position', (data[0].atX + data[0].x) / 2 + \" \" + ((data[0].atY + data[0].y) / 2 + OPTION.BulletArc) + \" \" + (data[0].atZ + data[0].z) / 2);\n\t\t\t\ttrack.appendChild(source);\n\t\t\t\ttrack.appendChild(arc);\n\t\t\t\ttrack.appendChild(target);\n\n\t\t\t\tvar debug = document.createElement('a-draw-curve');\n\t\t\t\tdebug.setAttribute('curveref', '#track');\n\t\t\t\tdebug.setAttribute('material', 'shader: line; color: red;');\n\t\t\t\tdoc.appendChild(debug);\n\n\t\t\t\tvar path = doc.appendChild(bullet);\n\t\t\t\tpath.setAttribute('alongpath', 'curve: #track; rotate: true; constant: 0 0 1; delay: 200; dur: 500');\n\n\t\t\t\tpath.addEventListener('movingended', function () {\n\t\t\t\t\tpath.removeAttribute('alongpath');\n\t\t\t\t\tif (debug.parentNode) {\n\t\t\t\t\t\tdoc.removeChild(debug);\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (track.hasChildNodes()) {\n\t\t\t\t\t\ttrack.removeChild(track.childNodes[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (path.parentNode) {\n\t\t\t\t\t\tdoc.removeChild(path);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tmoveShip: function moveShip(model, data, OPTION) {\n\t\t\tconsole.log(\"moveShip() \", model, data);\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tconsole.log(data, model);\n\t\t\t\tvar doc = document.getElementById('scene');\n\t\t\t\tvar track = document.getElementById('track');\n\t\t\t\tvar ship = model[data[0].id];\n\n\t\t\t\t// add a path to show movement along the path\n\t\t\t\tvar debug = document.createElement('a-draw-curve');\n\t\t\t\tdebug.setAttribute('curveref', '#track');\n\t\t\t\tdebug.setAttribute('material', 'shader: line; color: blue;');\n\t\t\t\tdoc.appendChild(debug);\n\n\t\t\t\t// add current location as a starting point of the curve\n\t\t\t\tvar point = document.createElement('a-curve-point');\n\t\t\t\tpoint.setAttribute('position', ship.x + ' ' + ship.y + ' ' + ship.z);\n\t\t\t\ttrack.appendChild(point);\n\t\t\t\t// add chain-able goal locations to the curve\n\t\t\t\tvar previous = { 'x': ship.x, 'z': ship.z };\n\t\t\t\tvar xDistance = 0;\n\t\t\t\tvar zDistance = 0;\n\t\t\t\t// console.log(\"current: \", model[data[0].id])\n\t\t\t\t// console.log(\"length: \", data);\n\t\t\t\tconsole.log('past the debug');\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\tpoint = document.createElement('a-curve-point');\n\t\t\t\t\tpoint.setAttribute('position', data[i].x + ' ' + data[i].y + ' ' + data[i].z);\n\t\t\t\t\txDistance += Math.abs(data[i].x - previous.x);\n\t\t\t\t\tzDistance += Math.abs(data[i].z - previous.z);\n\t\t\t\t\ttrack.appendChild(point);\n\t\t\t\t\tprevious = { 'x': data[i].x, 'y': data[i].z };\n\t\t\t\t\tif (i + 1 < data.length && data[i].x === data[i + 1].x && data[i].z === data[i + 1].z) {\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// define time for movement so that speed of difference distance is consistent\n\t\t\t\tvar duration = (xDistance + zDistance) * OPTION.WaitTimePerTileMoved;\n\t\t\t\tship.dom.setAttribute('alongpath', 'curve: #track; rotate: true; constraint: 0 0 1; delay: ' + OPTION.WaitTimeBetweenAction + '; dur: ' + duration + ';');\n\t\t\t\tconsole.log('past the set attribute');\n\n\t\t\t\tship.dom.addEventListener('movingended', function () {\n\t\t\t\t\tif (debug.parentNode) {\n\t\t\t\t\t\tdoc.removeChild(debug);\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (track.hasChildNodes()) {\n\t\t\t\t\t\ttrack.removeChild(track.childNodes[0]);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(data);\n\t\t\t\t\tship.dom.removeAttribute('alongpath');\n\t\t\t\t\tship.x = data[data.length - 1].x;\n\t\t\t\t\tship.y = data[data.length - 1].y;\n\t\t\t\t\tship.z = data[data.length - 1].z;\n\t\t\t\t\tconsole.log('past the updater');\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\treturn action;\n}\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvc2hpcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQ0EsU0FBUyxJQUFULEdBQWdCO0FBQ2YsS0FBSSxTQUFTO0FBQ1osVUFBUSxnQkFBQyxJQUFELEVBQU8sTUFBUCxFQUFrQjtBQUN6QixPQUFJLE9BQU87QUFDVixXQUFPLElBREcsRUFDRztBQUNiLGNBQVUsSUFGQSxFQUVNO0FBQ2hCLGFBQVMsSUFIQyxFQUdLO0FBQ2YsWUFBUSxJQUpFLEVBSUk7QUFDZCxhQUFTLElBTEM7QUFNVixVQUFNLElBTkk7QUFPVixTQUFLLElBUEs7QUFRVixTQUFLLElBUks7QUFTVixTQUFLLElBVEs7QUFVVixpQkFBYSxJQVZIO0FBV1YsWUFBUSxJQVhFO0FBWVYsYUFBUyxJQVpDO0FBYVYsYUFBUyxJQWJDO0FBY1YsWUFBUTtBQWRFLElBQVg7QUFnQkEsUUFBSyxJQUFJLElBQVQsSUFBaUIsSUFBakIsRUFBdUI7QUFDdEIsU0FBSyxJQUFMLElBQWEsS0FBSyxJQUFMLENBQWI7QUFDQTs7QUFFRCxPQUFJLE1BQU0sU0FBUyxjQUFULENBQXdCLE9BQXhCLENBQVY7QUFDQSxPQUFJLE9BQU8sU0FBUyxhQUFULENBQXVCLFVBQXZCLENBQVg7O0FBRUEsUUFBSyxZQUFMLENBQWtCLFVBQWxCLEVBQThCLEtBQUssQ0FBTCxHQUFTLEdBQVQsR0FBZSxLQUFLLENBQXBCLEdBQXdCLEdBQXhCLEdBQThCLEtBQUssQ0FBakU7QUFDQSxPQUFJLEtBQUssS0FBTCxLQUFlLGtCQUFuQixFQUF1QztBQUN0QyxTQUFLLFlBQUwsQ0FBa0IsVUFBbEIsRUFBOEIsMEJBQTlCO0FBQ0EsU0FBSyxZQUFMLENBQWtCLE9BQWxCLEVBQTJCLFdBQTNCO0FBQ0EsSUFIRCxNQUlLO0FBQ0osU0FBSyxZQUFMLENBQWtCLFVBQWxCLEVBQThCLHFCQUE5QjtBQUNBLFNBQUssWUFBTCxDQUFrQixPQUFsQixF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QVEsQ0FBUixLQUFjLEtBQUssSUFBRSxDQUFQLEVBQVUsQ0FBaEYsRUFBbUY7QUFDbEY7QUFDQTtBQUNEOztBQUVEO0FBQ0EsUUFBSSxXQUFXLENBQUMsWUFBVSxTQUFYLElBQXNCLE9BQU8sb0JBQTVDO0FBQ0EsU0FBSyxHQUFMLENBQVMsWUFBVCxDQUFzQixXQUF0QixFQUFtQyw0REFBMEQsT0FBTyxxQkFBakUsR0FBdUYsU0FBdkYsR0FBaUcsUUFBakcsR0FBMEcsR0FBN0k7QUFDQSxZQUFRLEdBQVIsQ0FBWSx3QkFBWjs7QUFFQSxTQUFLLEdBQUwsQ0FBUyxnQkFBVCxDQUEwQixhQUExQixFQUF5QyxZQUFNO0FBQzlDLFNBQUksTUFBTSxVQUFWLEVBQXNCO0FBQ3JCLFVBQUksV0FBSixDQUFnQixLQUFoQjtBQUNBOztBQUVELFlBQU0sTUFBTSxhQUFOLEVBQU4sRUFBNkI7QUFDNUIsWUFBTSxXQUFOLENBQWtCLE1BQU0sVUFBTixDQUFpQixDQUFqQixDQUFsQjtBQUNBO0FBQ0QsYUFBUSxHQUFSLENBQVksSUFBWjtBQUNBLFVBQUssR0FBTCxDQUFTLGVBQVQsQ0FBeUIsV0FBekI7QUFDQSxVQUFLLENBQUwsR0FBUyxLQUFLLEtBQUssTUFBTCxHQUFZLENBQWpCLEVBQW9CLENBQTdCO0FBQ0EsVUFBSyxDQUFMLEdBQVMsS0FBSyxLQUFLLE1BQUwsR0FBWSxDQUFqQixFQUFvQixDQUE3QjtBQUNBLFVBQUssQ0FBTCxHQUFTLEtBQUssS0FBSyxNQUFMLEdBQVksQ0FBakIsRUFBb0IsQ0FBN0I7QUFDQSxhQUFRLEdBQVIsQ0FBWSxrQkFBWjtBQUNBO0FBQ0EsS0FmRDtBQWdCQSxJQXhETSxDQUFQO0FBeURBO0FBN05XLEVBQWI7O0FBZ09BLFFBQU8sTUFBUDtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxuZnVuY3Rpb24gU2hpcCgpIHtcblx0bGV0IGFjdGlvbiA9IHtcblx0XHRyZW5kZXI6IChkYXRhLCBPUFRJT04pID0+IHtcblx0XHRcdGxldCBhdHRyID0ge1xuXHRcdFx0XHRcImRvbVwiOiBudWxsLCAvLyBzaGlwcyBodG1sIGRvbSBjb21wb25lbnRcblx0XHRcdFx0XCJoZWFsdGhcIjogbnVsbCwgLy8gc2hpcCdzIGhlYWx0aCBiYXIsIGRpc3BsYXkgYXMgZG90c1xuXHRcdFx0XHRcImNvbG9yXCI6IG51bGwsIC8vIHNoaXAgY29sb3Jcblx0XHRcdFx0XCJuYW1lXCI6IG51bGwsIC8vIHNoaXAncyBkaXNwbGF5IG5hbWVcblx0XHRcdFx0XCJvd25lclwiOiBudWxsLFxuXHRcdFx0XHRcImlkXCI6IG51bGwsXG5cdFx0XHRcdFwieFwiOiBudWxsLFxuXHRcdFx0XHRcInlcIjogbnVsbCxcblx0XHRcdFx0XCJ6XCI6IG51bGwsXG5cdFx0XHRcdFwiZmlyZXBvd2VyXCI6IG51bGwsXG5cdFx0XHRcdFwiaHVsbFwiOiBudWxsLFxuXHRcdFx0XHRcInNwZWVkXCI6IG51bGwsXG5cdFx0XHRcdFwicmFuZ2VcIjogbnVsbCxcblx0XHRcdFx0XCJzdW5rXCI6IG51bGxcblx0XHRcdH1cblx0XHRcdGZvciAobGV0IGtleXMgaW4gZGF0YSkge1xuXHRcdFx0XHRhdHRyW2tleXNdID0gZGF0YVtrZXlzXTtcblx0XHRcdH1cblxuXHRcdFx0bGV0IGRvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2VuZScpO1xuXHRcdFx0bGV0IHNoaXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWVudGl0eScpO1xuXG5cdFx0XHRzaGlwLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBkYXRhLnggKyAnICcgKyBkYXRhLnkgKyAnICcgKyBkYXRhLnopO1xuXHRcdFx0aWYgKGF0dHIuY29sb3IgPT09ICdyZ2IoMjU1LCAyNTUsIDApJykge1xuXHRcdFx0XHRzaGlwLnNldEF0dHJpYnV0ZSgndGVtcGxhdGUnLCAnc3JjOiAjc3VibWFyaW5lLXRlbXBsYXRlJyk7XG5cdFx0XHRcdHNoaXAuc2V0QXR0cmlidXRlKCdjbGFzcycsICdzdWJtYXJpbmUnKTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRzaGlwLnNldEF0dHJpYnV0ZSgndGVtcGxhdGUnLCAnc3JjOiAjYm9hdC10ZW1wbGF0ZScpO1xuXHRcdFx0XHRzaGlwLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnYm9hdCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRsZXQgaGVhcnQgPSAnJztcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgYXR0ci5odWxsOyBpKyspIHtcblx0XHRcdFx0aGVhcnQgKz0gJyDigKInO1xuXHRcdFx0fVxuXHRcdFx0YXR0ci5oZWFsdGggPSBoZWFydDtcblxuXHRcdFx0Ly8gJHt2YXJpYWJsZX0gPC0gdmFyaWFibGUgbmFtZSBiZSBsb3dlciBjYXNlXG5cdFx0XHRzaGlwLnNldEF0dHJpYnV0ZSgnZGF0YS1zaGlwX2NvbG9yJywgJ2NvbG9yOiAnK2F0dHIuY29sb3IrJzsgbWV0YWxuZXNzOiAwLjQ7Jyk7XG5cdFx0XHRzaGlwLnNldEF0dHJpYnV0ZSgnZGF0YS1zaGlwX25hbWUnLCAndmFsdWU6ICcrYXR0ci5uYW1lKyc7IGZvbnQ6ICNwbGF5OycpO1xuXHRcdFx0c2hpcC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2hpcF9oZWFsdGgnLCAndmFsdWU6ICcraGVhcnQrJzsnKTtcblxuXHRcdFx0YXR0ci5kb20gPSBkb2MuYXBwZW5kQ2hpbGQoc2hpcCk7XG5cblx0XHRcdHJldHVybiBhdHRyO1xuXHRcdH0sXG5cblx0XHRzaW5rU2hpcDogKGRhdGEsIE9QVElPTikgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coJ3Npbms6ICcsIGRhdGEpO1xuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdFx0bGV0IGRvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2VuZScpO1xuXHRcdFx0XHRsZXQgdHJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHJhY2snKTtcblx0XHRcdFx0bGV0IGFjdGlvbiA9IGRhdGEucHJlc2VudC5uZXh0LmFjdGlvbnNbMF07IC8vIHNpbmsgYWN0aW9uIHNob3VsZCBvbmx5IGhhdmUgYSBzaXplIG9mIG9uZVxuXHRcdFx0XHRsZXQgc2hpcCA9IGRhdGEuaHRtbFthY3Rpb24uaWRdO1xuXHRcdFx0XHRcblx0XHRcdFx0bGV0IGRlYnVnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1kcmF3LWN1cnZlJyk7XG5cdFx0XHRcdGRlYnVnLnNldEF0dHJpYnV0ZSgnY3VydmVyZWYnLCAnI3RyYWNrJyk7XG5cdFx0XHRcdGRlYnVnLnNldEF0dHJpYnV0ZSgnbWF0ZXJpYWwnLCAnc2hhZGVyOiBsaW5lOyBjb2xvcjogYmxhY2s7Jyk7XG5cdFx0XHRcdGRvYy5hcHBlbmRDaGlsZChkZWJ1Zyk7XG5cblx0XHRcdFx0dmFyIHBvaW50MSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtY3VydmUtcG9pbnQnKTtcblx0XHRcdFx0dmFyIHBvaW50MiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtY3VydmUtcG9pbnQnKTtcblx0XHRcdFx0cG9pbnQxLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBhY3Rpb24ueCArICcgJyArIGFjdGlvbi55ICsgJyAnICsgYWN0aW9uLnopO1xuXHRcdFx0XHRwb2ludDIuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGFjdGlvbi54ICsgJyAnICsgKGFjdGlvbi55IC0gT1BUSU9OLlNpbmtEaXN0YW5jZSkgKyAnICcgKyBhY3Rpb24ueik7XG5cdFx0XHRcdHRyYWNrLmFwcGVuZENoaWxkKHBvaW50MSk7XG5cdFx0XHRcdHRyYWNrLmFwcGVuZENoaWxkKHBvaW50Mik7XG5cblx0XHRcdFx0c2hpcC5kb20uc2V0QXR0cmlidXRlKCdhbG9uZ3BhdGgnLCAnY3VydmU6ICN0cmFjazsgcm90YXRlOiB0cnVlOyBjb25zdHJhaW50OiAwIDEgMDsgZGVsYXk6ICcgKyBPUFRJT04uV2FpdFRpbWVCZXR3ZWVuQWN0aW9uICsgJzsgZHVyOiAzMDAwOycpO1xuXG5cdFx0XHRcdHNoaXAuZG9tLmFkZEV2ZW50TGlzdGVuZXIoJ21vdmluZ2VuZGVkJywgKCkgPT4ge1xuXHRcdFx0XHRcdHNoaXAuZG9tLnJlbW92ZUF0dHJpYnV0ZSgnYWxvbmdwYXRoJyk7XG5cdFx0XHRcdFx0aWYgKGRlYnVnLnBhcmVudE5vZGUpIHtcblx0XHRcdFx0XHRcdGRvYy5yZW1vdmVDaGlsZChkZWJ1Zyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0d2hpbGUodHJhY2suaGFzQ2hpbGROb2RlcygpKSB7XG5cdFx0XHRcdFx0XHR0cmFjay5yZW1vdmVDaGlsZCh0cmFjay5jaGlsZE5vZGVzWzBdKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzaGlwLmRvbS5yZW1vdmVBdHRyaWJ1dGUoJ2Fsb25ncGF0aCcpO1xuXHRcdFx0XHRcdHNoaXAuZG9tLnNldEF0dHJpYnV0ZSgndmlzaWJsZScsIGZhbHNlKTtcblx0XHRcdFx0XHQvLyBzaGlwRG9tLmNoaWxkTm9kZXMuZm9yRWFjaCgobm9kZSkgPT4ge1xuXHRcdFx0XHRcdC8vIFx0Y29uc29sZS5sb2cobm9kZSk7XG5cdFx0XHRcdFx0Ly8gXHRub2RlLnNldEF0dHJpYnV0ZSgndmlzaWJsZScsIGZhbHNlKTtcblx0XHRcdFx0XHQvLyB9KTtcblxuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0aGl0U2hpcDogKGRhdGEpID0+IHtcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdGxldCBhY3Rpb24gPSBkYXRhLnByZXNlbnQubmV4dC5hY3Rpb25zWzBdO1xuXHRcdFx0XHRsZXQgc2hpcCA9IGRhdGEuaHRtbFthY3Rpb24uaWRdO1xuXHRcdFx0XHRsZXQgaGVhcnQgPSAnJztcblxuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFbMF0uaGVhbHRoOyBpKyspIHtcblx0XHRcdFx0XHRoZWFydCArPSAnIOKAoic7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAuZG9tLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRpZiAoc2hpcC5kb20uY2hpbGROb2Rlc1tpXS5jbGFzc05hbWUgPT09ICdzaGlwLWhlYWx0aCcpIHtcblx0XHRcdFx0XHRcdHNoaXAuZG9tLmNoaWxkTm9kZXNbaV0uc2V0QXR0cmlidXRlKCd0ZXh0LWdlb21ldHJ5JywgJ3ZhbHVlOiAnICsgaGVhcnQgKyAnOycpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdGZpcmVTaGlwOiAoZGF0YSwgT1BUSU9OKSA9PiB7XG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0XHRsZXQgZG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjZW5lJyk7XG5cdFx0XHRcdGxldCB0cmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmFjaycpO1xuXG5cdFx0XHRcdGxldCBidWxsZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLXNwaGVyZScpO1xuXHRcdFx0XHRsZXQgc291cmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1jdXJ2ZS1wb2ludCcpO1xuXHRcdFx0XHRsZXQgYXJjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1jdXJ2ZS1wb2ludCcpO1xuXHRcdFx0XHRsZXQgdGFyZ2V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1jdXJ2ZS1wb2ludCcpO1xuXHRcdFx0XHRidWxsZXQuc2V0QXR0cmlidXRlKCdjb2xvcicsICdncmF5Jyk7XG5cdFx0XHRcdGJ1bGxldC5zZXRBdHRyaWJ1dGUoJ3JhZGl1cycsICcwLjEnKTtcblx0XHRcdFx0YnVsbGV0LnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBkYXRhWzBdLnggKyAnICcgKyBkYXRhWzBdLnkgKyAnICcgKyBkYXRhWzBdLnopO1xuXHRcdFx0XHRzb3VyY2Uuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGRhdGFbMF0ueCArICcgJyArIGRhdGFbMF0ueSArICcgJyArIGRhdGFbMF0ueik7XG5cdFx0XHRcdHRhcmdldC5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgZGF0YVswXS5hdFggKyAnICcgKyBkYXRhWzBdLmF0WSArICcgJyArIGRhdGFbMF0uYXRaKTtcblx0XHRcdFx0YXJjLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCAoZGF0YVswXS5hdFgrZGF0YVswXS54KS8yICsgXCIgXCIgKyAoKChkYXRhWzBdLmF0WStkYXRhWzBdLnkpLzIpK09QVElPTi5CdWxsZXRBcmMpICsgXCIgXCIgKyAoZGF0YVswXS5hdForZGF0YVswXS56KS8yKTtcblx0XHRcdFx0dHJhY2suYXBwZW5kQ2hpbGQoc291cmNlKTtcblx0XHRcdFx0dHJhY2suYXBwZW5kQ2hpbGQoYXJjKTtcblx0XHRcdFx0dHJhY2suYXBwZW5kQ2hpbGQodGFyZ2V0KTtcblxuXHRcdFx0XHRsZXQgZGVidWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWRyYXctY3VydmUnKTtcblx0XHRcdFx0ZGVidWcuc2V0QXR0cmlidXRlKCdjdXJ2ZXJlZicsICcjdHJhY2snKTtcblx0XHRcdFx0ZGVidWcuc2V0QXR0cmlidXRlKCdtYXRlcmlhbCcsICdzaGFkZXI6IGxpbmU7IGNvbG9yOiByZWQ7Jyk7XG5cdFx0XHRcdGRvYy5hcHBlbmRDaGlsZChkZWJ1Zyk7XG5cblx0XHRcdFx0bGV0IHBhdGggPSBkb2MuYXBwZW5kQ2hpbGQoYnVsbGV0KTtcblx0XHRcdFx0cGF0aC5zZXRBdHRyaWJ1dGUoJ2Fsb25ncGF0aCcsICdjdXJ2ZTogI3RyYWNrOyByb3RhdGU6IHRydWU7IGNvbnN0YW50OiAwIDAgMTsgZGVsYXk6IDIwMDsgZHVyOiA1MDAnKTtcblxuXHRcdFx0XHRwYXRoLmFkZEV2ZW50TGlzdGVuZXIoJ21vdmluZ2VuZGVkJywgKCkgPT4ge1xuXHRcdFx0XHRcdHBhdGgucmVtb3ZlQXR0cmlidXRlKCdhbG9uZ3BhdGgnKTtcblx0XHRcdFx0XHRpZiAoZGVidWcucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdFx0ZG9jLnJlbW92ZUNoaWxkKGRlYnVnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR3aGlsZSh0cmFjay5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHRcdHRyYWNrLnJlbW92ZUNoaWxkKHRyYWNrLmNoaWxkTm9kZXNbMF0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChwYXRoLnBhcmVudE5vZGUpIHtcblx0XHRcdFx0XHRcdGRvYy5yZW1vdmVDaGlsZChwYXRoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdG1vdmVTaGlwOiAobW9kZWwsIGRhdGEsIE9QVElPTikgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coXCJtb3ZlU2hpcCgpIFwiLCBtb2RlbCwgZGF0YSk7XG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhkYXRhLCBtb2RlbCk7XG5cdFx0XHRcdGxldCBkb2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NlbmUnKTtcblx0XHRcdFx0bGV0IHRyYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyYWNrJyk7XG5cdFx0XHRcdGxldCBzaGlwID0gbW9kZWxbZGF0YVswXS5pZF07XG5cblx0XHRcdFx0Ly8gYWRkIGEgcGF0aCB0byBzaG93IG1vdmVtZW50IGFsb25nIHRoZSBwYXRoXG5cdFx0XHRcdGxldCBkZWJ1ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZHJhdy1jdXJ2ZScpO1xuXHRcdFx0XHRkZWJ1Zy5zZXRBdHRyaWJ1dGUoJ2N1cnZlcmVmJywgJyN0cmFjaycpO1xuXHRcdFx0XHRkZWJ1Zy5zZXRBdHRyaWJ1dGUoJ21hdGVyaWFsJywgJ3NoYWRlcjogbGluZTsgY29sb3I6IGJsdWU7Jyk7XG5cdFx0XHRcdGRvYy5hcHBlbmRDaGlsZChkZWJ1Zyk7XG5cblx0XHRcdFx0Ly8gYWRkIGN1cnJlbnQgbG9jYXRpb24gYXMgYSBzdGFydGluZyBwb2ludCBvZiB0aGUgY3VydmVcblx0XHRcdFx0bGV0IHBvaW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1jdXJ2ZS1wb2ludCcpO1xuXHRcdFx0XHRwb2ludC5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgc2hpcC54ICsgJyAnICsgc2hpcC55ICsgJyAnICsgc2hpcC56KTtcblx0XHRcdFx0dHJhY2suYXBwZW5kQ2hpbGQocG9pbnQpO1xuXHRcdFx0XHQvLyBhZGQgY2hhaW4tYWJsZSBnb2FsIGxvY2F0aW9ucyB0byB0aGUgY3VydmVcblx0XHRcdFx0bGV0IHByZXZpb3VzID0geyd4Jzogc2hpcC54LCAneic6IHNoaXAuen07XG5cdFx0XHRcdGxldCB4RGlzdGFuY2UgPSAwO1xuXHRcdFx0XHRsZXQgekRpc3RhbmNlID0gMDtcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coXCJjdXJyZW50OiBcIiwgbW9kZWxbZGF0YVswXS5pZF0pXG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKFwibGVuZ3RoOiBcIiwgZGF0YSk7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdwYXN0IHRoZSBkZWJ1ZycpO1xuXHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0XHRwb2ludCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtY3VydmUtcG9pbnQnKTtcblx0XHRcdFx0XHRwb2ludC5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgZGF0YVtpXS54ICsgJyAnICsgZGF0YVtpXS55ICsgJyAnICsgZGF0YVtpXS56KTtcblx0XHRcdFx0XHR4RGlzdGFuY2UgKz0gTWF0aC5hYnMoZGF0YVtpXS54IC0gcHJldmlvdXMueCk7XG5cdFx0XHRcdFx0ekRpc3RhbmNlICs9IE1hdGguYWJzKGRhdGFbaV0ueiAtIHByZXZpb3VzLnopO1xuXHRcdFx0XHRcdHRyYWNrLmFwcGVuZENoaWxkKHBvaW50KTtcblx0XHRcdFx0XHRwcmV2aW91cyA9IHsneCc6IGRhdGFbaV0ueCwgJ3knOiBkYXRhW2ldLnp9O1xuXHRcdFx0XHRcdGlmIChpICsgMSA8IGRhdGEubGVuZ3RoICYmIGRhdGFbaV0ueCA9PT0gZGF0YVtpKzFdLnggJiYgZGF0YVtpXS56ID09PSBkYXRhW2krMV0ueikge1xuXHRcdFx0XHRcdFx0aSsrO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIGRlZmluZSB0aW1lIGZvciBtb3ZlbWVudCBzbyB0aGF0IHNwZWVkIG9mIGRpZmZlcmVuY2UgZGlzdGFuY2UgaXMgY29uc2lzdGVudFxuXHRcdFx0XHRsZXQgZHVyYXRpb24gPSAoeERpc3RhbmNlK3pEaXN0YW5jZSkqT1BUSU9OLldhaXRUaW1lUGVyVGlsZU1vdmVkO1xuXHRcdFx0XHRzaGlwLmRvbS5zZXRBdHRyaWJ1dGUoJ2Fsb25ncGF0aCcsICdjdXJ2ZTogI3RyYWNrOyByb3RhdGU6IHRydWU7IGNvbnN0cmFpbnQ6IDAgMCAxOyBkZWxheTogJytPUFRJT04uV2FpdFRpbWVCZXR3ZWVuQWN0aW9uKyc7IGR1cjogJytkdXJhdGlvbisnOycpO1xuXHRcdFx0XHRjb25zb2xlLmxvZygncGFzdCB0aGUgc2V0IGF0dHJpYnV0ZScpO1xuXG5cdFx0XHRcdHNoaXAuZG9tLmFkZEV2ZW50TGlzdGVuZXIoJ21vdmluZ2VuZGVkJywgKCkgPT4ge1xuXHRcdFx0XHRcdGlmIChkZWJ1Zy5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdFx0XHRkb2MucmVtb3ZlQ2hpbGQoZGVidWcpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHdoaWxlKHRyYWNrLmhhc0NoaWxkTm9kZXMoKSkge1xuXHRcdFx0XHRcdFx0dHJhY2sucmVtb3ZlQ2hpbGQodHJhY2suY2hpbGROb2Rlc1swXSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGRhdGEpO1xuXHRcdFx0XHRcdHNoaXAuZG9tLnJlbW92ZUF0dHJpYnV0ZSgnYWxvbmdwYXRoJyk7XG5cdFx0XHRcdFx0c2hpcC54ID0gZGF0YVtkYXRhLmxlbmd0aC0xXS54O1xuXHRcdFx0XHRcdHNoaXAueSA9IGRhdGFbZGF0YS5sZW5ndGgtMV0ueTtcblx0XHRcdFx0XHRzaGlwLnogPSBkYXRhW2RhdGEubGVuZ3RoLTFdLno7XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coJ3Bhc3QgdGhlIHVwZGF0ZXInKTtcblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGFjdGlvbjtcbn0iXX0=\n"]}