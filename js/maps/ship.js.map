{"version":3,"sources":["ship.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module"],"mappings":"CAAA,SAAUA,EAAEC,EAAEC,EAAEC,GAAG,SAASC,EAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,IAAIE,EAAkB,mBAATC,SAAqBA,QAAQ,IAAIF,GAAGC,EAAE,OAAOA,EAAEF,GAAE,GAAI,GAAGI,EAAE,OAAOA,EAAEJ,GAAE,GAAI,IAAIK,EAAE,IAAIC,MAAM,uBAAuBN,EAAE,KAAK,MAAMK,EAAEE,KAAK,mBAAmBF,EAAE,IAAIG,EAAEX,EAAEG,IAAIS,YAAYb,EAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAG,IAAIE,EAAED,EAAEI,GAAG,GAAGL,GAAG,OAAOI,EAAEF,GAAIF,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,OAAOD,EAAEG,GAAGS,QAAkD,IAAI,IAA1CL,EAAkB,mBAATD,SAAqBA,QAAgBH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,IAAI,OAAOD,EAAvb,EAA4ba,GAAG,SAAST,EAAQU,EAAOJ,GACvd,uBA6PW","file":"../ship.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\nfunction Ship() {\n\tvar action = {\n\t\trender: function render(data) {\n\t\t\tvar attr = {\n\t\t\t\t\"dom\": null, // ships html dom component\n\t\t\t\t\"health\": null, // ship's health bar, display as dots\n\t\t\t\t\"color\": null, // ship color\n\t\t\t\t\"name\": null, // ship's display name\n\t\t\t\t\"owner\": null,\n\t\t\t\t\"id\": null,\n\t\t\t\t\"x\": null,\n\t\t\t\t\"y\": null,\n\t\t\t\t\"z\": null,\n\t\t\t\t\"firepower\": null,\n\t\t\t\t\"hull\": null,\n\t\t\t\t\"speed\": null,\n\t\t\t\t\"range\": null,\n\t\t\t\t\"sunk\": null\n\t\t\t};\n\t\t\tfor (var keys in data) {\n\t\t\t\tattr[keys] = data[keys];\n\t\t\t}\n\n\t\t\tvar doc = document.getElementById('scene');\n\t\t\tvar ship = document.createElement('a-entity');\n\n\t\t\tship.setAttribute('position', data.x + ' ' + data.y + ' ' + data.z);\n\t\t\tif (data.color === 'rgb(255, 255, 0)') {\n\t\t\t\tship.setAttribute('template', 'src: #submarine-template');\n\t\t\t\tship.setAttribute('class', 'submarine');\n\t\t\t} else {\n\t\t\t\tship.setAttribute('template', 'src: #boat-template');\n\t\t\t\tship.setAttribute('class', 'boat');\n\t\t\t}\n\n\t\t\tvar heart = '';\n\t\t\tfor (var i = 0; i < data.hull; i++) {\n\t\t\t\theart += ' •';\n\t\t\t}\n\n\t\t\t// ${variable} <- variable name be lower case\n\t\t\tship.setAttribute('data-ship_color', \"color: \" + data.color + \"; metalness: 0.4;\");\n\t\t\tship.setAttribute('data-ship_name', \"value: \" + data.name + \"; font: #play;\");\n\t\t\tship.setAttribute('data-ship_health', \"value: \" + heart + \"';\");\n\n\t\t\tattr.dom = doc.appendChild(ship);\n\n\t\t\treturn attr;\n\t\t},\n\n\t\tupdate: function update(domElement, current) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tconsole.log(domElement);\n\t\t\t\tconsole.log(current);\n\t\t\t\tcurrent.states.forEach(function (state) {\n\t\t\t\t\tvar ship = domElement[state.id];\n\t\t\t\t\tvar heart = '';\n\t\t\t\t\tfor (var i = 0; i < state.health; i++) {\n\t\t\t\t\t\theart += ' •';\n\t\t\t\t\t}\n\n\t\t\t\t\tship.dom.setAttribute('position', state.x + \" \" + state.y + \" \" + state.z);\n\t\t\t\t\tship.dom.setAttribute('visible', !state.sunk);\n\t\t\t\t\tship.dom.setAttribute('health', \"value: \" + heart);\n\t\t\t\t\tconsole.log(heart);\n\t\t\t\t\tship.dom.removeAttribute('alongpath');\n\t\t\t\t});\n\t\t\t\tvar doc = document.getElementById('scene');\n\t\t\t\tvar track = document.getElementById('track');\n\n\t\t\t\tdoc.removeChild(track);\n\t\t\t\ttrack = document.createElement('a-curve');\n\t\t\t\ttrack.setAttribute('id', 'track');\n\t\t\t\ttrack.setAttribute('type', 'Line');\n\t\t\t\tdoc.appendChild(track);\n\n\t\t\t\t// while(track.hasChildNodes()) {\n\t\t\t\t// \ttrack.removeChild(track.childNodes[0]);\n\t\t\t\t// }\n\t\t\t\tresolve();\n\t\t\t});\n\t\t},\n\n\t\tsinkShip: function sinkShip(domElement, current, OPTION) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar doc = document.getElementById('scene');\n\t\t\t\tvar track = document.getElementById('track');\n\t\t\t\tconsole.log(\"sinkShip(): \", domElement, current);\n\t\t\t\tvar action = current.task.actions[0]; // sink action should only have a size of one\n\t\t\t\tvar ship = domElement[action.id];\n\n\t\t\t\tvar debug = document.createElement('a-draw-curve');\n\t\t\t\tdebug.setAttribute('curveref', '#track');\n\t\t\t\tdebug.setAttribute('material', 'shader: line; color: black;');\n\t\t\t\tdoc.appendChild(debug);\n\n\t\t\t\tvar point1 = document.createElement('a-curve-point');\n\t\t\t\tvar point2 = document.createElement('a-curve-point');\n\t\t\t\tpoint1.setAttribute('position', action.x + \" \" + action.y + \" \" + action.z);\n\t\t\t\tpoint2.setAttribute('position', action.x + \" \" + (action.y - OPTION.SinkDistance) + \" \" + action.z);\n\t\t\t\ttrack.appendChild(point1);\n\t\t\t\ttrack.appendChild(point2);\n\n\t\t\t\tship.dom.setAttribute('alongpath', \"curve: #track; rotate: true; constraint: 0 1 0; delay: \" + OPTION.WaitTimeBetweenAction + \"; dur: 3000;\");\n\n\t\t\t\tship.dom.addEventListener('movingended', function () {\n\t\t\t\t\tship.dom.removeAttribute('alongpath');\n\t\t\t\t\tship.dom.setAttribute('visible', false);\n\n\t\t\t\t\tif (debug.parentNode) {\n\t\t\t\t\t\tdoc.removeChild(debug);\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (track.hasChildNodes()) {\n\t\t\t\t\t\ttrack.removeChild(track.childNodes[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\thitShip: function hitShip(domElement, current) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar action = current.task.actions[0];\n\t\t\t\tvar ship = domElement[action.id];\n\t\t\t\tvar heart = '';\n\n\t\t\t\tfor (var i = 0; i < action.health; i++) {\n\t\t\t\t\theart += ' •';\n\t\t\t\t}\n\t\t\t\tconsole.log(ship.dom.childNodes.length);\n\t\t\t\tfor (var _i = 0; _i < ship.dom.childNodes.length; _i++) {\n\t\t\t\t\tif (ship.dom.childNodes[_i].className === 'ship-health') {\n\t\t\t\t\t\tship.dom.childNodes[_i].setAttribute('text-geometry', \"value: \" + heart + \";\");\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t},\n\n\t\tfireShip: function fireShip(current, OPTION) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar doc = document.getElementById('scene');\n\t\t\t\tvar track = document.getElementById('track');\n\t\t\t\tvar data = current.task.actions;\n\n\t\t\t\tvar bullet = document.createElement('a-sphere');\n\t\t\t\tvar source = document.createElement('a-curve-point');\n\t\t\t\tvar arc = document.createElement('a-curve-point');\n\t\t\t\tvar target = document.createElement('a-curve-point');\n\t\t\t\tbullet.setAttribute('color', 'gray');\n\t\t\t\tbullet.setAttribute('radius', '0.1');\n\t\t\t\tbullet.setAttribute('position', data[0].x + \" \" + data[0].y + \" \" + data[0].z);\n\t\t\t\tsource.setAttribute('position', data[0].x + \" \" + data[0].y + \" \" + data[0].z);\n\t\t\t\ttarget.setAttribute('position', data[0].atX + \" \" + data[0].atY + \" \" + data[0].atZ);\n\t\t\t\tarc.setAttribute('position', (data[0].atX + data[0].x) / 2 + \" \" + ((data[0].atY + data[0].y) / 2 + OPTION.BulletArc) + \" \" + (data[0].atZ + data[0].z) / 2);\n\t\t\t\ttrack.appendChild(source);\n\t\t\t\ttrack.appendChild(arc);\n\t\t\t\ttrack.appendChild(target);\n\n\t\t\t\tvar debug = document.createElement('a-draw-curve');\n\t\t\t\tdebug.setAttribute('curveref', '#track');\n\t\t\t\tdebug.setAttribute('material', 'shader: line; color: red;');\n\t\t\t\tdoc.appendChild(debug);\n\n\t\t\t\tvar path = doc.appendChild(bullet);\n\t\t\t\tpath.setAttribute('alongpath', 'curve: #track; rotate: true; constant: 0 0 1; delay: 200; dur: 500');\n\n\t\t\t\tpath.addEventListener('movingended', function () {\n\t\t\t\t\tpath.removeAttribute('alongpath');\n\t\t\t\t\tif (debug.parentNode) {\n\t\t\t\t\t\tdoc.removeChild(debug);\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (track.hasChildNodes()) {\n\t\t\t\t\t\ttrack.removeChild(track.childNodes[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (path.parentNode) {\n\t\t\t\t\t\tdoc.removeChild(path);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tmoveShip: function moveShip(domElement, current, OPTION) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar doc = document.getElementById('scene');\n\t\t\t\tvar track = document.getElementById('track');\n\t\t\t\tvar data = current.task.actions;\n\t\t\t\tvar ship = domElement[data[0].id];\n\n\t\t\t\t// add a path to show movement along the path\n\t\t\t\tvar debug = document.createElement('a-draw-curve');\n\t\t\t\tdebug.setAttribute('curveref', '#track');\n\t\t\t\tdebug.setAttribute('material', 'shader: line; color: blue;');\n\t\t\t\tdoc.appendChild(debug);\n\n\t\t\t\t// add current location as a starting point of the curve\n\t\t\t\tvar point = document.createElement('a-curve-point');\n\t\t\t\tpoint.setAttribute('position', ship.x + ' ' + ship.y + ' ' + ship.z);\n\t\t\t\ttrack.appendChild(point);\n\t\t\t\t// add chain-able goal locations to the curve\n\t\t\t\tvar previous = { x: ship.x, z: ship.z };\n\t\t\t\tvar xDistance = 0;\n\t\t\t\tvar zDistance = 0;\n\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\tpoint = document.createElement('a-curve-point');\n\t\t\t\t\tpoint.setAttribute('position', data[i].x + \" \" + data[i].y + \" \" + data[i].z);\n\t\t\t\t\txDistance += Math.abs(data[i].x - previous.x);\n\t\t\t\t\tzDistance += Math.abs(data[i].z - previous.z);\n\t\t\t\t\ttrack.appendChild(point);\n\t\t\t\t\tprevious = { x: data[i].x, z: data[i].z };\n\t\t\t\t\tif (i + 1 < data.length && data[i].x === data[i + 1].x && data[i].z === data[i + 1].z) {\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// define time for movement so that speed of difference distance is consistent\n\t\t\t\tvar duration = (xDistance + zDistance) * OPTION.WaitTimePerTileMoved;\n\t\t\t\tship.dom.setAttribute('alongpath', \"curve: #track; rotate: true; constraint: 0 0 1; delay: \" + OPTION.WaitTimeBetweenAction + \"; dur: \" + duration + \";\");\n\n\t\t\t\tship.dom.addEventListener('movingended', function () {\n\t\t\t\t\tif (debug.parentNode) {\n\t\t\t\t\t\tdoc.removeChild(debug);\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (track.hasChildNodes()) {\n\t\t\t\t\t\ttrack.removeChild(track.childNodes[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\tship.dom.removeAttribute('alongpath');\n\t\t\t\t\tship.x = data[data.length - 1].x;\n\t\t\t\t\tship.y = data[data.length - 1].y;\n\t\t\t\t\tship.z = data[data.length - 1].z;\n\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\treturn action;\n}\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvc2hpcC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQ0EsU0FBUyxJQUFULEdBQWdCO0FBQ2YsS0FBSSxTQUFTO0FBQ1osVUFBUSxnQkFBQyxJQUFELEVBQVU7QUFDakIsT0FBSSxPQUFPO0FBQ1YsV0FBTyxJQURHLEVBQ0c7QUFDYixjQUFVLElBRkEsRUFFTTtBQUNoQixhQUFTLElBSEMsRUFHSztBQUNmLFlBQVEsSUFKRSxFQUlJO0FBQ2QsYUFBUyxJQUxDO0FBTVYsVUFBTSxJQU5JO0FBT1YsU0FBSyxJQVBLO0FBUVYsU0FBSyxJQVJLO0FBU1YsU0FBSyxJQVRLO0FBVVYsaUJBQWEsSUFWSDtBQVdWLFlBQVEsSUFYRTtBQVlWLGFBQVMsSUFaQztBQWFWLGFBQVMsSUFiQztBQWNWLFlBQVE7QUFkRSxJQUFYO0FBZ0JBLFFBQUssSUFBSSxJQUFULElBQWlCLElBQWpCLEVBQXVCO0FBQ3RCLFNBQUssSUFBTCxJQUFhLEtBQUssSUFBTCxDQUFiO0FBQ0E7O0FBRUQsT0FBSSxNQUFNLFNBQVMsY0FBVCxDQUF3QixPQUF4QixDQUFWO0FBQ0EsT0FBSSxPQUFPLFNBQVMsYUFBVCxDQUF1QixVQUF2QixDQUFYOztBQUVBLFFBQUssWUFBTCxDQUFrQixVQUFsQixFQUE4QixLQUFLLENBQUwsR0FBUyxHQUFULEdBQWUsS0FBSyxDQUFwQixHQUF3QixHQUF4QixHQUE4QixLQUFLLENBQWpFO0FBQ0EsT0FBSSxLQUFLLEtBQUwsS0FBZSxrQkFBbkIsRUFBdUM7QUFDdEMsU0FBSyxZQUFMLENBQWtCLFVBQWxCLEVBQThCLDBCQUE5QjtBQUNBLFNBQUssWUFBTCxDQUFrQixPQUFsQixFQUEyQixXQUEzQjtBQUNBLElBSEQsTUFJSztBQUNKLFNBQUssWUFBTCxDQUFrQixVQUFsQixFQUE4QixxQkFBOUI7QUFDQSxTQUFLLFlBQUwsQ0FBa0IsT0FBbEIsRUFBMkIsTUFBM0I7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Q0FBa0IsTUFBTSxVQUFOLENBQWlCLENBQWpCLENBQWxCO0FBQ0E7O0FBRUQsVUFBSyxHQUFMLENBQVMsZUFBVCxDQUF5QixXQUF6QjtBQUNBLFVBQUssQ0FBTCxHQUFTLEtBQUssS0FBSyxNQUFMLEdBQVksQ0FBakIsRUFBb0IsQ0FBN0I7QUFDQSxVQUFLLENBQUwsR0FBUyxLQUFLLEtBQUssTUFBTCxHQUFZLENBQWpCLEVBQW9CLENBQTdCO0FBQ0EsVUFBSyxDQUFMLEdBQVMsS0FBSyxLQUFLLE1BQUwsR0FBWSxDQUFqQixFQUFvQixDQUE3Qjs7QUFFQTtBQUNBLEtBZkQ7QUFnQkEsSUFyRE0sQ0FBUDtBQXNEQTtBQXJQVyxFQUFiOztBQXdQQSxRQUFPLE1BQVA7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJcbmZ1bmN0aW9uIFNoaXAoKSB7XG5cdGxldCBhY3Rpb24gPSB7XG5cdFx0cmVuZGVyOiAoZGF0YSkgPT4ge1xuXHRcdFx0bGV0IGF0dHIgPSB7XG5cdFx0XHRcdFwiZG9tXCI6IG51bGwsIC8vIHNoaXBzIGh0bWwgZG9tIGNvbXBvbmVudFxuXHRcdFx0XHRcImhlYWx0aFwiOiBudWxsLCAvLyBzaGlwJ3MgaGVhbHRoIGJhciwgZGlzcGxheSBhcyBkb3RzXG5cdFx0XHRcdFwiY29sb3JcIjogbnVsbCwgLy8gc2hpcCBjb2xvclxuXHRcdFx0XHRcIm5hbWVcIjogbnVsbCwgLy8gc2hpcCdzIGRpc3BsYXkgbmFtZVxuXHRcdFx0XHRcIm93bmVyXCI6IG51bGwsXG5cdFx0XHRcdFwiaWRcIjogbnVsbCxcblx0XHRcdFx0XCJ4XCI6IG51bGwsXG5cdFx0XHRcdFwieVwiOiBudWxsLFxuXHRcdFx0XHRcInpcIjogbnVsbCxcblx0XHRcdFx0XCJmaXJlcG93ZXJcIjogbnVsbCxcblx0XHRcdFx0XCJodWxsXCI6IG51bGwsXG5cdFx0XHRcdFwic3BlZWRcIjogbnVsbCxcblx0XHRcdFx0XCJyYW5nZVwiOiBudWxsLFxuXHRcdFx0XHRcInN1bmtcIjogbnVsbFxuXHRcdFx0fVxuXHRcdFx0Zm9yIChsZXQga2V5cyBpbiBkYXRhKSB7XG5cdFx0XHRcdGF0dHJba2V5c10gPSBkYXRhW2tleXNdO1xuXHRcdFx0fVxuXG5cdFx0XHRsZXQgZG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjZW5lJyk7XG5cdFx0XHRsZXQgc2hpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZW50aXR5Jyk7XG5cblx0XHRcdHNoaXAuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGRhdGEueCArICcgJyArIGRhdGEueSArICcgJyArIGRhdGEueik7XG5cdFx0XHRpZiAoZGF0YS5jb2xvciA9PT0gJ3JnYigyNTUsIDI1NSwgMCknKSB7XG5cdFx0XHRcdHNoaXAuc2V0QXR0cmlidXRlKCd0ZW1wbGF0ZScsICdzcmM6ICNzdWJtYXJpbmUtdGVtcGxhdGUnKTtcblx0XHRcdFx0c2hpcC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3N1Ym1hcmluZScpO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHNoaXAuc2V0QXR0cmlidXRlKCd0ZW1wbGF0ZScsICdzcmM6ICNib2F0LXRlbXBsYXRlJyk7XG5cdFx0XHRcdHNoaXAuc2V0QXR0cmlidXRlKCdjbGFzcycsICdib2F0Jyk7XG5cdFx0XHR9XG5cblx0XHRcdGxldCBoZWFydCA9ICcnO1xuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmh1bGw7IGkrKykge1xuXHRcdFx0XHRoZWFydCArPSAnIOKAoic7XG5cdFx0XHR9XG5cblx0XHRcdC8vICR7dmFyaWFibGV9IDwtIHZhcmlhYmxlIG5hbWUgYmUgbG93ZXIgY2FzZVxuXHRcdFx0c2hpcC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2hpcF9jb2xvcicsIGBjb2xvcjogJHtkYXRhLmNvbG9yfTsgbWV0YWxuZXNzOiAwLjQ7YCk7XG5cdFx0XHRzaGlwLnNldEF0dHJpYnV0ZSgnZGF0YS1zaGlwX25hbWUnLCBgdmFsdWU6ICR7ZGF0YS5uYW1lfTsgZm9udDogI3BsYXk7YCk7XG5cdFx0XHRzaGlwLnNldEF0dHJpYnV0ZSgnZGF0YS1zaGlwX2hlYWx0aCcsIGB2YWx1ZTogJHtoZWFydH0nO2ApO1xuXG5cdFx0XHRhdHRyLmRvbSA9IGRvYy5hcHBlbmRDaGlsZChzaGlwKTtcblxuXHRcdFx0cmV0dXJuIGF0dHI7XG5cdFx0fSxcblxuXHRcdHVwZGF0ZTogKGRvbUVsZW1lbnQsIGN1cnJlbnQpID0+IHtcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGRvbUVsZW1lbnQpO1xuXHRcdFx0XHRjb25zb2xlLmxvZyhjdXJyZW50KTtcblx0XHRcdFx0Y3VycmVudC5zdGF0ZXMuZm9yRWFjaCgoc3RhdGUpID0+IHtcblx0XHRcdFx0XHRsZXQgc2hpcCA9IGRvbUVsZW1lbnRbc3RhdGUuaWRdO1xuXHRcdFx0XHRcdGxldCBoZWFydCA9ICcnO1xuXHRcdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgc3RhdGUuaGVhbHRoOyBpKyspIHtcblx0XHRcdFx0XHRcdGhlYXJ0ICs9ICcg4oCiJztcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRzaGlwLmRvbS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgYCR7c3RhdGUueH0gJHtzdGF0ZS55fSAke3N0YXRlLnp9YCk7XG5cdFx0XHRcdFx0c2hpcC5kb20uc2V0QXR0cmlidXRlKCd2aXNpYmxlJywgIXN0YXRlLnN1bmspO1xuXHRcdFx0XHRcdHNoaXAuZG9tLnNldEF0dHJpYnV0ZSgnaGVhbHRoJywgYHZhbHVlOiAke2hlYXJ0fWApO1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGhlYXJ0KTtcblx0XHRcdFx0XHRzaGlwLmRvbS5yZW1vdmVBdHRyaWJ1dGUoJ2Fsb25ncGF0aCcpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0bGV0IGRvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2VuZScpO1xuXHRcdFx0XHRsZXQgdHJhY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHJhY2snKTtcblx0XHRcdFx0XG5cdFx0XHRcdGRvYy5yZW1vdmVDaGlsZCh0cmFjayk7XG5cdFx0XHRcdHRyYWNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1jdXJ2ZScpO1xuXHRcdFx0XHR0cmFjay5zZXRBdHRyaWJ1dGUoJ2lkJywgJ3RyYWNrJyk7XG5cdFx0XHRcdHRyYWNrLnNldEF0dHJpYnV0ZSgndHlwZScsICdMaW5lJyk7XG5cdFx0XHRcdGRvYy5hcHBlbmRDaGlsZCh0cmFjayk7XG5cblx0XHRcdFx0Ly8gd2hpbGUodHJhY2suaGFzQ2hpbGROb2RlcygpKSB7XG5cdFx0XHRcdC8vIFx0dHJhY2sucmVtb3ZlQ2hpbGQodHJhY2suY2hpbGROb2Rlc1swXSk7XG5cdFx0XHRcdC8vIH1cblx0XHRcdFx0cmVzb2x2ZSgpO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdHNpbmtTaGlwOiAoZG9tRWxlbWVudCwgY3VycmVudCwgT1BUSU9OKSA9PiB7XG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0XHRsZXQgZG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjZW5lJyk7XG5cdFx0XHRcdGxldCB0cmFjayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmFjaycpO1xuXHRcdFx0XHRjb25zb2xlLmxvZyhcInNpbmtTaGlwKCk6IFwiLCBkb21FbGVtZW50LCBjdXJyZW50KTtcblx0XHRcdFx0bGV0IGFjdGlvbiA9IGN1cnJlbnQudGFzay5hY3Rpb25zWzBdOyAvLyBzaW5rIGFjdGlvbiBzaG91bGQgb25seSBoYXZlIGEgc2l6ZSBvZiBvbmVcblx0XHRcdFx0bGV0IHNoaXAgPSBkb21FbGVtZW50W2FjdGlvbi5pZF07XG5cdFx0XHRcdFxuXHRcdFx0XHRsZXQgZGVidWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWRyYXctY3VydmUnKTtcblx0XHRcdFx0ZGVidWcuc2V0QXR0cmlidXRlKCdjdXJ2ZXJlZicsICcjdHJhY2snKTtcblx0XHRcdFx0ZGVidWcuc2V0QXR0cmlidXRlKCdtYXRlcmlhbCcsICdzaGFkZXI6IGxpbmU7IGNvbG9yOiBibGFjazsnKTtcblx0XHRcdFx0ZG9jLmFwcGVuZENoaWxkKGRlYnVnKTtcblxuXHRcdFx0XHR2YXIgcG9pbnQxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1jdXJ2ZS1wb2ludCcpO1xuXHRcdFx0XHR2YXIgcG9pbnQyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1jdXJ2ZS1wb2ludCcpO1xuXHRcdFx0XHRwb2ludDEuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGAke2FjdGlvbi54fSAke2FjdGlvbi55fSAke2FjdGlvbi56fWApO1xuXHRcdFx0XHRwb2ludDIuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGAke2FjdGlvbi54fSAkeyhhY3Rpb24ueSAtIE9QVElPTi5TaW5rRGlzdGFuY2UpfSAke2FjdGlvbi56fWApO1xuXHRcdFx0XHR0cmFjay5hcHBlbmRDaGlsZChwb2ludDEpO1xuXHRcdFx0XHR0cmFjay5hcHBlbmRDaGlsZChwb2ludDIpO1xuXG5cdFx0XHRcdHNoaXAuZG9tLnNldEF0dHJpYnV0ZSgnYWxvbmdwYXRoJywgYGN1cnZlOiAjdHJhY2s7IHJvdGF0ZTogdHJ1ZTsgY29uc3RyYWludDogMCAxIDA7IGRlbGF5OiAke09QVElPTi5XYWl0VGltZUJldHdlZW5BY3Rpb259OyBkdXI6IDMwMDA7YCk7XG5cblx0XHRcdFx0c2hpcC5kb20uYWRkRXZlbnRMaXN0ZW5lcignbW92aW5nZW5kZWQnLCAoKSA9PiB7XG5cdFx0XHRcdFx0c2hpcC5kb20ucmVtb3ZlQXR0cmlidXRlKCdhbG9uZ3BhdGgnKTtcblx0XHRcdFx0XHRzaGlwLmRvbS5zZXRBdHRyaWJ1dGUoJ3Zpc2libGUnLCBmYWxzZSk7XG5cblx0XHRcdFx0XHRpZiAoZGVidWcucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdFx0ZG9jLnJlbW92ZUNoaWxkKGRlYnVnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR3aGlsZSh0cmFjay5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHRcdHRyYWNrLnJlbW92ZUNoaWxkKHRyYWNrLmNoaWxkTm9kZXNbMF0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0aGl0U2hpcDogKGRvbUVsZW1lbnQsIGN1cnJlbnQpID0+IHtcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdGxldCBhY3Rpb24gPSBjdXJyZW50LnRhc2suYWN0aW9uc1swXTtcblx0XHRcdFx0bGV0IHNoaXAgPSBkb21FbGVtZW50W2FjdGlvbi5pZF07XG5cdFx0XHRcdGxldCBoZWFydCA9ICcnO1xuXG5cdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgYWN0aW9uLmhlYWx0aDsgaSsrKSB7XG5cdFx0XHRcdFx0aGVhcnQgKz0gJyDigKInO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNvbnNvbGUubG9nKHNoaXAuZG9tLmNoaWxkTm9kZXMubGVuZ3RoKTtcblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmRvbS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0aWYgKHNoaXAuZG9tLmNoaWxkTm9kZXNbaV0uY2xhc3NOYW1lID09PSAnc2hpcC1oZWFsdGgnKSB7XG5cdFx0XHRcdFx0XHRzaGlwLmRvbS5jaGlsZE5vZGVzW2ldLnNldEF0dHJpYnV0ZSgndGV4dC1nZW9tZXRyeScsIGB2YWx1ZTogJHtoZWFydH07YCk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0ZmlyZVNoaXA6IChjdXJyZW50LCBPUFRJT04pID0+IHtcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdGxldCBkb2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NlbmUnKTtcblx0XHRcdFx0bGV0IHRyYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyYWNrJyk7XG5cdFx0XHRcdGxldCBkYXRhID0gY3VycmVudC50YXNrLmFjdGlvbnM7XG5cblx0XHRcdFx0bGV0IGJ1bGxldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Etc3BoZXJlJyk7XG5cdFx0XHRcdGxldCBzb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWN1cnZlLXBvaW50Jyk7XG5cdFx0XHRcdGxldCBhcmMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWN1cnZlLXBvaW50Jyk7XG5cdFx0XHRcdGxldCB0YXJnZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWN1cnZlLXBvaW50Jyk7XG5cdFx0XHRcdGJ1bGxldC5zZXRBdHRyaWJ1dGUoJ2NvbG9yJywgJ2dyYXknKTtcblx0XHRcdFx0YnVsbGV0LnNldEF0dHJpYnV0ZSgncmFkaXVzJywgJzAuMScpO1xuXHRcdFx0XHRidWxsZXQuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGAke2RhdGFbMF0ueH0gJHtkYXRhWzBdLnl9ICR7ZGF0YVswXS56fWApO1xuXHRcdFx0XHRzb3VyY2Uuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGAke2RhdGFbMF0ueH0gJHtkYXRhWzBdLnl9ICR7ZGF0YVswXS56fWApO1xuXHRcdFx0XHR0YXJnZXQuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGAke2RhdGFbMF0uYXRYfSAke2RhdGFbMF0uYXRZfSAke2RhdGFbMF0uYXRafWApO1xuXHRcdFx0XHRhcmMuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGAkeyhkYXRhWzBdLmF0WCtkYXRhWzBdLngpLzJ9ICR7KCgoZGF0YVswXS5hdFkrZGF0YVswXS55KS8yKStPUFRJT04uQnVsbGV0QXJjKX0gJHsoZGF0YVswXS5hdForZGF0YVswXS56KS8yfWApO1xuXHRcdFx0XHR0cmFjay5hcHBlbmRDaGlsZChzb3VyY2UpO1xuXHRcdFx0XHR0cmFjay5hcHBlbmRDaGlsZChhcmMpO1xuXHRcdFx0XHR0cmFjay5hcHBlbmRDaGlsZCh0YXJnZXQpO1xuXG5cdFx0XHRcdGxldCBkZWJ1ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtZHJhdy1jdXJ2ZScpO1xuXHRcdFx0XHRkZWJ1Zy5zZXRBdHRyaWJ1dGUoJ2N1cnZlcmVmJywgJyN0cmFjaycpO1xuXHRcdFx0XHRkZWJ1Zy5zZXRBdHRyaWJ1dGUoJ21hdGVyaWFsJywgJ3NoYWRlcjogbGluZTsgY29sb3I6IHJlZDsnKTtcblx0XHRcdFx0ZG9jLmFwcGVuZENoaWxkKGRlYnVnKTtcblxuXHRcdFx0XHRsZXQgcGF0aCA9IGRvYy5hcHBlbmRDaGlsZChidWxsZXQpO1xuXHRcdFx0XHRwYXRoLnNldEF0dHJpYnV0ZSgnYWxvbmdwYXRoJywgJ2N1cnZlOiAjdHJhY2s7IHJvdGF0ZTogdHJ1ZTsgY29uc3RhbnQ6IDAgMCAxOyBkZWxheTogMjAwOyBkdXI6IDUwMCcpO1xuXG5cdFx0XHRcdHBhdGguYWRkRXZlbnRMaXN0ZW5lcignbW92aW5nZW5kZWQnLCAoKSA9PiB7XG5cdFx0XHRcdFx0cGF0aC5yZW1vdmVBdHRyaWJ1dGUoJ2Fsb25ncGF0aCcpO1xuXHRcdFx0XHRcdGlmIChkZWJ1Zy5wYXJlbnROb2RlKSB7XG5cdFx0XHRcdFx0XHRkb2MucmVtb3ZlQ2hpbGQoZGVidWcpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHdoaWxlKHRyYWNrLmhhc0NoaWxkTm9kZXMoKSkge1xuXHRcdFx0XHRcdFx0dHJhY2sucmVtb3ZlQ2hpbGQodHJhY2suY2hpbGROb2Rlc1swXSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHBhdGgucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdFx0ZG9jLnJlbW92ZUNoaWxkKHBhdGgpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0bW92ZVNoaXA6IChkb21FbGVtZW50LCBjdXJyZW50LCBPUFRJT04pID0+IHtcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHRcdGxldCBkb2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NlbmUnKTtcblx0XHRcdFx0bGV0IHRyYWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyYWNrJyk7XG5cdFx0XHRcdGxldCBkYXRhID0gY3VycmVudC50YXNrLmFjdGlvbnM7XG5cdFx0XHRcdGxldCBzaGlwID0gZG9tRWxlbWVudFtkYXRhWzBdLmlkXTtcblxuXHRcdFx0XHQvLyBhZGQgYSBwYXRoIHRvIHNob3cgbW92ZW1lbnQgYWxvbmcgdGhlIHBhdGhcblx0XHRcdFx0bGV0IGRlYnVnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1kcmF3LWN1cnZlJyk7XG5cdFx0XHRcdGRlYnVnLnNldEF0dHJpYnV0ZSgnY3VydmVyZWYnLCAnI3RyYWNrJyk7XG5cdFx0XHRcdGRlYnVnLnNldEF0dHJpYnV0ZSgnbWF0ZXJpYWwnLCAnc2hhZGVyOiBsaW5lOyBjb2xvcjogYmx1ZTsnKTtcblx0XHRcdFx0ZG9jLmFwcGVuZENoaWxkKGRlYnVnKTtcblxuXHRcdFx0XHQvLyBhZGQgY3VycmVudCBsb2NhdGlvbiBhcyBhIHN0YXJ0aW5nIHBvaW50IG9mIHRoZSBjdXJ2ZVxuXHRcdFx0XHRsZXQgcG9pbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWN1cnZlLXBvaW50Jyk7XG5cdFx0XHRcdHBvaW50LnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBzaGlwLnggKyAnICcgKyBzaGlwLnkgKyAnICcgKyBzaGlwLnopO1xuXHRcdFx0XHR0cmFjay5hcHBlbmRDaGlsZChwb2ludCk7XG5cdFx0XHRcdC8vIGFkZCBjaGFpbi1hYmxlIGdvYWwgbG9jYXRpb25zIHRvIHRoZSBjdXJ2ZVxuXHRcdFx0XHRsZXQgcHJldmlvdXMgPSB7eDogc2hpcC54LCB6OiBzaGlwLnp9O1xuXHRcdFx0XHRsZXQgeERpc3RhbmNlID0gMDtcblx0XHRcdFx0bGV0IHpEaXN0YW5jZSA9IDA7XG5cblx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0cG9pbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWN1cnZlLXBvaW50Jyk7XG5cdFx0XHRcdFx0cG9pbnQuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGAke2RhdGFbaV0ueH0gJHtkYXRhW2ldLnl9ICR7ZGF0YVtpXS56fWApO1xuXHRcdFx0XHRcdHhEaXN0YW5jZSArPSBNYXRoLmFicyhkYXRhW2ldLnggLSBwcmV2aW91cy54KTtcblx0XHRcdFx0XHR6RGlzdGFuY2UgKz0gTWF0aC5hYnMoZGF0YVtpXS56IC0gcHJldmlvdXMueik7XG5cdFx0XHRcdFx0dHJhY2suYXBwZW5kQ2hpbGQocG9pbnQpO1xuXHRcdFx0XHRcdHByZXZpb3VzID0ge3g6IGRhdGFbaV0ueCwgejogZGF0YVtpXS56fTtcblx0XHRcdFx0XHRpZiAoaSArIDEgPCBkYXRhLmxlbmd0aCAmJiBkYXRhW2ldLnggPT09IGRhdGFbaSsxXS54ICYmIGRhdGFbaV0ueiA9PT0gZGF0YVtpKzFdLnopIHtcblx0XHRcdFx0XHRcdGkrKztcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBkZWZpbmUgdGltZSBmb3IgbW92ZW1lbnQgc28gdGhhdCBzcGVlZCBvZiBkaWZmZXJlbmNlIGRpc3RhbmNlIGlzIGNvbnNpc3RlbnRcblx0XHRcdFx0bGV0IGR1cmF0aW9uID0gKHhEaXN0YW5jZSt6RGlzdGFuY2UpKk9QVElPTi5XYWl0VGltZVBlclRpbGVNb3ZlZDtcblx0XHRcdFx0c2hpcC5kb20uc2V0QXR0cmlidXRlKCdhbG9uZ3BhdGgnLCBgY3VydmU6ICN0cmFjazsgcm90YXRlOiB0cnVlOyBjb25zdHJhaW50OiAwIDAgMTsgZGVsYXk6ICR7T1BUSU9OLldhaXRUaW1lQmV0d2VlbkFjdGlvbn07IGR1cjogJHtkdXJhdGlvbn07YCk7XG5cblx0XHRcdFx0c2hpcC5kb20uYWRkRXZlbnRMaXN0ZW5lcignbW92aW5nZW5kZWQnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRpZiAoZGVidWcucGFyZW50Tm9kZSkge1xuXHRcdFx0XHRcdFx0ZG9jLnJlbW92ZUNoaWxkKGRlYnVnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR3aGlsZSh0cmFjay5oYXNDaGlsZE5vZGVzKCkpIHtcblx0XHRcdFx0XHRcdHRyYWNrLnJlbW92ZUNoaWxkKHRyYWNrLmNoaWxkTm9kZXNbMF0pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHNoaXAuZG9tLnJlbW92ZUF0dHJpYnV0ZSgnYWxvbmdwYXRoJyk7XG5cdFx0XHRcdFx0c2hpcC54ID0gZGF0YVtkYXRhLmxlbmd0aC0xXS54O1xuXHRcdFx0XHRcdHNoaXAueSA9IGRhdGFbZGF0YS5sZW5ndGgtMV0ueTtcblx0XHRcdFx0XHRzaGlwLnogPSBkYXRhW2RhdGEubGVuZ3RoLTFdLno7XG5cblx0XHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGFjdGlvbjtcbn0iXX0=\n"]}