{"version":3,"sources":["main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","Simulation","transform","data","scale","OPTION","console","log","map","entry","hasOwnProperty","atX","atZ","atY","ShipYOffset","x","z","y","preprocess","result","GridScale","Math","floor","ocean","OceanYOffset","width","depth","density","ships","forEach","ship","sunk","turns","last","actions","id","type","push","actionChain","undefined","snapshots","past","present","future","currentState","states","next","turn","unshift","tree","action","structure","reducer","pop","initScene","inputs","doc","document","getElementById","track","createElement","setAttribute","appendChild","Constants","htmlElements","htmlElement","camera","CameraYOffset","atan","String","battleship","render","slide","value","model","html","test","setTimeout","simulate","notStop","m_chain","current","shift","moveShip","then","done","catch","err","error","fireShip","hitShip","sinkShip","warn","vex","dialog","alert","OceanPadding","SinkDistance","BulletArc","WaitTimePerTileMoved","WaitTimeBetweenAction","init","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","getParameterByName","database","ref","child","once","res","ids","val","input","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","Ship"],"mappings":"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","file":"../main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\n// Initialize Firebase\nvar config = {\n\tapiKey: \"AIzaSyA9EYUXVL5WAh6Aam1qXlWyvi3b7HLcZ1U\",\n\tauthDomain: \"esigamma.firebaseapp.com\",\n\tdatabaseURL: \"https://esigamma.firebaseio.com\",\n\tprojectId: \"esigamma\",\n\tstorageBucket: \"esigamma.appspot.com\",\n\tmessagingSenderId: \"734163636039\"\n};\nfirebase.initializeApp(config);\n\nvar database = firebase.database();\nvar battleship = Ship();\n\nvar test = void 0;\n\nfunction getParameterByName(name, url) {\n\tif (!url) url = window.location.href;\n\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n\tvar results = regex.exec(url);\n\tif (!results) return null;\n\tif (!results[2]) return '';\n\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nfunction Simulation() {\n\n\t// private\n\tvar Constants = {\n\t\tGridScale: 4,\n\t\tCameraYOffset: 25,\n\t\tOceanYOffset: 0,\n\t\tOceanPadding: 10,\n\t\tShipYOffset: 0,\n\t\tSinkDistance: 5,\n\t\tBulletArc: 2,\n\t\tWaitTimePerTileMoved: 300,\n\t\tWaitTimeBetweenAction: 50 // in miliseconds\n\t};\n\n\tvar m_input = {};\n\n\tvar m_ships = []; // stores formatted json of ship initialization\n\tvar m_chain = []; // stores chainable actions in a turn\n\tvar m_entity = {}; // object with id to html dom element of ships\n\n\tvar m_test = 0;\n\n\tvar m_ocean = void 0;\n\n\tfunction transform(data, scale, OPTION) {\n\t\tconsole.log(\"transform() \", data);\n\t\tvar result = data.map(function (entry) {\n\t\t\tif (entry.hasOwnProperty(\"atX\") && entry.hasOwnProperty(\"atY\")) {\n\t\t\t\tentry.atX = scale * entry.atX;\n\t\t\t\tentry.atZ = scale * entry.atY; // 3D uses the xz plane as part of the ground\n\t\t\t\tentry.atY = OPTION.ShipYOffset; // vertical offset with respect to the ground and user in VR mode\n\t\t\t}\n\t\t\tentry.x = scale * entry.x;\n\t\t\tentry.z = scale * entry.y; // 3D uses the xz plane as part of the ground\n\t\t\tentry.y = OPTION.ShipYOffset;\n\t\t\treturn entry;\n\t\t});\n\t\treturn result;\n\t};\n\n\tfunction reducer(tree, action, OPTION) {\n\t\tconsole.log(tree);\n\t\tvar structure = {\n\t\t\tstates: tree.states,\n\t\t\tnext: action\n\t\t};\n\n\t\tstructure.states = tree.states.map(function (ship) {\n\t\t\tif (action.id === ship.id) {\n\t\t\t\tswitch (action.type) {\n\t\t\t\t\tcase 'MOVE':\n\t\t\t\t\t\t// iterate over all the chained actions and apply it the the state\n\t\t\t\t\t\t// function would need to check validity in movement, which not checked in the data\n\t\t\t\t\t\t// action.actions.forEach((a) => {\n\t\t\t\t\t\t// \tif (a.direction === \"North\") {\n\t\t\t\t\t\t// \t\tif (ship.z > 0)\n\t\t\t\t\t\t// \t\t\tship.z -= OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"South\") {\n\t\t\t\t\t\t// \t\tship.z += OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"West\") {\n\t\t\t\t\t\t// \t\tif (ship.x > 0)\n\t\t\t\t\t\t// \t\t\tship.x -= OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"East\") {\n\t\t\t\t\t\t// \t\tship.x += OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// });\n\n\t\t\t\t\t\t// shortcut, update state from the result of the last action list\n\t\t\t\t\t\tvar last = action.actions[action.actions.length - 1];\n\t\t\t\t\t\tship.z = last.z;\n\t\t\t\t\t\tship.x = last.x;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tcase 'Sunk':\n\t\t\t\t\t\tship.sunk = true;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn ship;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn ship;\n\t\t\t}\n\t\t});\n\t\treturn structure;\n\t}\n\n\t// Map a sequence of actions that are considered atomic into a chain-able list of actions for smooth animation and movements \n\tfunction actionChain(data) {\n\t\tvar result = [];\n\t\tdata.map(function (entry) {\n\t\t\tif (result && result.length > 0) {\n\t\t\t\t// result[i] will always have at least one item in its action attribute list\n\t\t\t\tvar last = result[result.length - 1].actions;\n\t\t\t\t// action can be chained if they are of the same type from the same ship id\n\t\t\t\t// console.log(\"Comparing: \", result[result.length-1], last, entry);\n\t\t\t\tif (last[0].id === entry.id && last[0].type === entry.type && (last[0].type === \"MOVE\" || last[0].type === \"FIRE\" && last[0].atX === entry.atX && last[0].atY === entry.atY)) {\n\t\t\t\t\t// Movement can be chained and firing at the same location can be chained\n\t\t\t\t\tlast.push(entry);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push({\n\t\t\t\t\t\ttype: entry.type,\n\t\t\t\t\t\tactions: [entry]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// if result is empty, initial case\n\t\t\t\tresult.push({\n\t\t\t\t\ttype: entry.type,\n\t\t\t\t\tactions: [entry]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tconsole.log(result);\n\t\treturn result;\n\t}\n\n\tfunction preprocess(data, OPTION) {\n\t\tvar result = {};\n\t\tconsole.log(\"preprocess() \", data, OPTION);\n\n\t\t// defines the ocean/map configuration\n\t\tresult.map = {\n\t\t\tx: OPTION.GridScale * Math.floor(data.ocean.x / 2) - 2,\n\t\t\ty: OPTION.OceanYOffset,\n\t\t\tz: OPTION.GridScale * Math.floor(data.ocean.y / 2),\n\t\t\twidth: 200,\n\t\t\tdepth: 200,\n\t\t\tdensity: 120\n\n\t\t\t// scale up ship's initial locations\n\t\t};result.ships = transform(data.ships, OPTION.GridScale, OPTION);\n\n\t\t// add sunk property into the initial state of the ships\n\t\tresult.ships.forEach(function (ship) {\n\t\t\tship.sunk = false;\n\t\t});\n\n\t\t// scale up coordinates in the action list, then call the actionChain to group sequences of action into a unit\n\t\tresult.turns = actionChain(transform(data.turns, OPTION.GridScale, OPTION));\n\t\tresult.turns.push({ type: 'END', actions: undefined }); // add end of simulation marker\n\n\t\tconsole.log(result);\n\n\t\tresult.snapshots = {\n\t\t\tpast: [],\n\t\t\tpresent: {},\n\t\t\tfuture: []\n\t\t};\n\n\t\tconsole.log('init states: ', result.ships);\n\n\t\tvar currentState = { states: result.ships, next: result.turns[0] };\n\t\tresult.turns.forEach(function (turn) {\n\t\t\tresult.snapshots.future.unshift(currentState);\n\t\t\tcurrentState = reducer(currentState, turn, OPTION);\n\t\t});\n\t\t// result.snapshots.future.reverse();\n\t\tresult.snapshots.present = result.snapshots.future.pop(0);\n\n\t\tconsole.log(result);\n\t\treturn result;\n\t}\n\n\tfunction render(data, OPTION) {\n\t\tvar htmlElement = {};\n\t\tvar doc = document.getElementById('scene'); // <a-scene> reference\n\n\t\t// reposition camera - camera must be already present when html loads\n\t\tvar camera = document.getElementById('camera');\n\t\t//camera.setAttribute('position', data.ocean.x + \" \" + data.ocean.y + \" \" + data.ocean.z);\n\t\tcamera.setAttribute('position', data.map.x + \" \" + data.map.y + \" \" + (data.map.z + 1.5 * data.map.x));\n\t\tcamera.setAttribute('camera', 'userHeight: ' + OPTION.CameraYOffset);\n\t\tcamera.setAttribute('rotation', -Math.atan(OPTION.CameraYOffset / (data.map.z + data.map.x)));\n\n\t\t// Generate Map\n\t\t// TODO: Possible edge cases with the map edge not being big enough\n\t\tvar map = document.createElement('a-ocean');\n\t\tmap.setAttribute('position', data.map.x + \" \" + data.map.y + \" \" + data.map.z);\n\t\tmap.setAttribute('width', String(data.map.width));\n\t\tmap.setAttribute('depth', String(data.map.depth));\n\t\tmap.setAttribute('density', String(data.map.density));\n\t\tdoc.appendChild(map);\n\n\t\t// Spawn Ships\n\t\tdata.ships.forEach(function (entry) {\n\t\t\thtmlElement[entry.id] = battleship.render(entry);\n\t\t});\n\t}\n\n\tfunction initScene(inputs) {\n\t\tvar doc = document.getElementById('scene');\n\t\tvar track = document.createElement('a-curve');\n\t\ttrack.setAttribute('id', 'track');\n\t\ttrack.setAttribute('type', 'Line');\n\t\tdoc.appendChild(track);\n\n\t\tconsole.log(\"initScene() \", inputs);\n\t\tvar data = preprocess(inputs, Constants);\n\n\t\tvar htmlElements = render(data, Constants);\n\t\tconsole.log(data);\n\n\t\tvar slide = document.getElementById('slider');\n\t\tslide.setAttribute('min', 0);\n\t\tslide.setAttribute('max', data.snapshots.future.length);\n\t\tslide.value = 0;\n\n\t\tvar model = {\n\t\t\thtml: htmlElements,\n\t\t\tsnapshots: data.snapshots\n\t\t};\n\t\ttest = model;\n\n\t\t// begin simulation\n\t\tsetTimeout(function () {\n\t\t\tsimulate(model, Constants);\n\t\t}, 10000);\n\t}\n\n\tfunction simulate() {\n\t\t//console.log(\"chain: \", m_chain);\n\t\tvar notStop = true;\n\t\tif (m_chain.length == 0) {\n\t\t\tnotStop = false;\n\t\t}\n\t\tvar current = m_chain.shift(); // don't shift when length is zero\n\t\tif (current && notStop) {\n\t\t\t//console.log(\"current: \", current);\n\t\t\tswitch (current.type) {\n\t\t\t\tcase \"MOVE\":\n\t\t\t\t\tbattleship.moveShip(current.actions).then(function (done) {\n\t\t\t\t\t\t//alert(\"Moved \" + m_chain.length + \" actions left\");\n\t\t\t\t\t\tsimulate();\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"FIRE\":\n\t\t\t\t\t/*** Exclusive Or functions ***/\n\n\t\t\t\t\t/* Fire without aiming */\n\t\t\t\t\tbattleship.fireShip(current.actions).then(function (done) {\n\t\t\t\t\t\tsimulate();\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(\"error: \", err);\n\t\t\t\t\t});\n\n\t\t\t\t\t// /* Aim then fire (currently buggy)*/\n\t\t\t\t\t// battleship.aimShip(current.actions).then((done) => {\n\t\t\t\t\t// \tbattleship.fireShip(current.actions).then((done) => {\n\t\t\t\t\t// \t\tsimulate();\n\t\t\t\t\t// \t}).catch((err) => {\n\t\t\t\t\t// \t\tconsole.error(\"error: \", err);\t\n\t\t\t\t\t// \t});\n\t\t\t\t\t// }).catch((err) => {\n\t\t\t\t\t// \tconsole.error(\"error: \", err);\n\t\t\t\t\t// });\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"HIT\":\n\t\t\t\t\tbattleship.hitShip(current.actions).then(function (done) {\n\t\t\t\t\t\tsimulate();\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"SINK\":\n\t\t\t\t\tbattleship.sinkShip(current.actions).then(function (done) {\n\t\t\t\t\t\t//alert(\"Sunk \"+ m_chain.length + \" actions left\");\n\t\t\t\t\t\tsimulate();\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn(\"Unknown Action type \" + current.type + \" in simulate function, skipping.\");\n\t\t\t\t\tsimulate();\n\t\t\t}\n\t\t} else {\n\t\t\tsetTimeout(function () {\n\t\t\t\t//alert(\"Simulation Done\");\n\t\t\t\tvex.dialog.alert(\"Simulation Completed.\");\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\t// public\n\tvar app = {\n\n\t\tinit: function init() {\n\t\t\tvar inputs = {};\n\t\t\tvar code = getParameterByName('code');\n\n\t\t\tif (code) {\n\t\t\t\tvar ref = database.ref('davy-jones-locker').child(code);\n\t\t\t\tref.once('value', function (res) {\n\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\"ids\": res.val().init.ships.map(function (s) {\n\t\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"ships\": res.val().init.ships,\n\t\t\t\t\t\t\"turns\": res.val().turns,\n\t\t\t\t\t\t\"ocean\": res.val().init.map\n\t\t\t\t\t};\n\t\t\t\t}, function (err) {\n\t\t\t\t\tconsole.warn(\"Unknown URL Code \" + code + \", using default offline input\");\n\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\"ids\": input.init.ships.map(function (s) {\n\t\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"ships\": input.init.ships,\n\t\t\t\t\t\t\"turns\": input.turns,\n\t\t\t\t\t\t\"ocean\": input.init.map\n\t\t\t\t\t};\n\t\t\t\t}).then(function () {\n\t\t\t\t\tconsole.log(\"init() \", inputs);\n\t\t\t\t\tinitScene(inputs);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.log('Missing URL parameter code, using default offline input');\n\t\t\t\tinputs = {\n\t\t\t\t\t\"ids\": input.init.ships.map(function (s) {\n\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t}),\n\t\t\t\t\t\"ships\": input.init.ships,\n\t\t\t\t\t\"turns\": input.turns,\n\t\t\t\t\t\"ocean\": input.init.map\n\t\t\t\t};\n\t\t\t\tconsole.log(\"init() \", inputs);\n\t\t\t\tinitScene(inputs);\n\t\t\t}\n\t\t}\n\t};\n\n\treturn app;\n}\n\nvar app = Simulation();\napp.init();\n\n//let params = getParameterByName(document.location.search);\n\n// let getDataFromCode = (code) => {\n// \tdatabase.ref('davy-jones-locker/' + code).once('value', (snapshot) => {\n// \t\tvar gameData = snapshot.val();\n// \t\tif (gameData) {\n// \t\t\tinput = gameData;\n// \t\t\tapp.init();\n// \t\t} else {\n// \t\t\tgetCode(`No data for code ${code}. Enter another code:`);\n// \t\t\t//app.init();\n// \t\t}\n// \t}).catch((err) => {\n// \t\tgetCode(`There was an error. Enter another code:`);\n// \t\t//app.init();\n// \t});\n// }\n\n// let getCode = (message) => {\n// \tvex.dialog.prompt({\n// \t\tmessage: message,\n// \t\tcallback: (value) => {\n// \t\t\tif (value) {\n// \t\t\t\tvar code = value;\n// \t\t\t\tgetDataFromCode(code);\n// \t\t\t} else {\n// \t\t\t\tgetCode(\"No code entered. Enter your code:\");\n// \t\t\t}\n// \t\t}\n// \t});\n// }\n\n// if (params.code) {\n// \tgetDataFromCode(params.code);\n// } else {\n// \tgetCode(\"Enter Your Code\");\n// }\n\n\n// var BATTLE_SERVER_URL = 'https://battleship-vingkan.c9users.io/1v1?p1=esi17.cs.DestroyerShip&p2=esi17.hli109.Floater';// + Math.ceil(Math.random() * 100);\n\n// $.get(BATTLE_SERVER_URL).then(data => {\n// \tinput = data;\n// \tapp.init();\n// }).done(() => {\n// \tconsole.log(\"Data successfully retrieved from server\");\n// }).fail(() => {\n// \tconsole.log(\"Unable to retrieve data, starting with local data\");\n// \tapp.init();\n// });\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7QUFDQSxJQUFJLFNBQVM7QUFDWixTQUFRLHlDQURJO0FBRVosYUFBWSwwQkFGQTtBQUdaLGNBQWEsaUNBSEQ7QUFJWixZQUFXLFVBSkM7QUFLWixnQkFBZSxzQkFMSDtBQU1aLG9CQUFtQjtBQU5QLENBQWI7QUFRQSxTQUFTLGFBQVQsQ0FBdUIsTUFBdkI7O0FBRUEsSUFBSSxXQUFXLFNBQVMsUUFBVCxFQUFmO0FBQ0EsSUFBSSxhQUFhLE1BQWpCOztBQUVBLElBQUksYUFBSjs7QUFFQSxTQUFTLGtCQUFULENBQTRCLElBQTVCLEVBQWtDLEdBQWxDLEVBQXVDO0FBQ3RDLEtBQUksQ0FBQyxHQUFMLEVBQVUsTUFBTSxPQUFPLFFBQVAsQ0FBZ0IsSUFBdEI7QUFDVixRQUFPLEtBQUssT0FBTCxDQUFhLFNBQWIsRUFBd0IsTUFBeEIsQ0FBUDtBQUNBLEtBQUksUUFBUSxJQUFJLE1BQUosQ0FBVyxTQUFTLElBQVQsR0FBZ0IsbUJBQTNCLENBQVo7QUFDQSxLQUFJLFVBQVUsTUFBTSxJQUFOLENBQVcsR0FBWCxDQUFkO0FBQ0EsS0FBSSxDQUFDLE9BQUwsRUFBYyxPQUFPLElBQVA7QUFDZCxLQUFJLENBQUMsUUFBUSxDQUFSLENBQUwsRUFBaUIsT0FBTyxFQUFQO0FBQ2pCLFFBQU8sbUJBQW1CLFFBQVEsQ0FBUixFQUFXLE9BQVgsQ0FBbUIsS0FBbkIsRUFBMEIsR0FBMUIsQ0FBbkIsQ0FBUDtBQUNBOztBQUVELFNBQVMsVUFBVCxHQUFzQjs7QUFFckI7QUFDQSxLQUFJLFlBQVk7QUFDZixhQUFXLENBREk7QUFFZixpQkFBZSxFQUZBO0FBR2YsZ0JBQWMsQ0FIQztBQUlmLGdCQUFjLEVBSkM7QUFLZixlQUFhLENBTEU7QUFNZixnQkFBYyxDQU5DO0FBT2YsYUFBVyxDQVBJO0FBUWYsd0JBQXNCLEdBUlA7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Y0FBUyxNQUFNLEtBSFA7QUFJUixjQUFTLE1BQU0sSUFBTixDQUFXO0FBSlosS0FBVDtBQU1BLFlBQVEsR0FBUixDQUFZLFNBQVosRUFBdUIsTUFBdkI7QUFDQSxjQUFVLE1BQVY7QUFDQTtBQUNEO0FBeENRLEVBQVY7O0FBMkNBLFFBQU8sR0FBUDtBQUNBOztBQUVELElBQUksTUFBTSxZQUFWO0FBQ0EsSUFBSSxJQUFKOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gSW5pdGlhbGl6ZSBGaXJlYmFzZVxubGV0IGNvbmZpZyA9IHtcblx0YXBpS2V5OiBcIkFJemFTeUE5RVlVWFZMNVdBaDZBYW0xcVhsV3l2aTNiN0hMY1oxVVwiLFxuXHRhdXRoRG9tYWluOiBcImVzaWdhbW1hLmZpcmViYXNlYXBwLmNvbVwiLFxuXHRkYXRhYmFzZVVSTDogXCJodHRwczovL2VzaWdhbW1hLmZpcmViYXNlaW8uY29tXCIsXG5cdHByb2plY3RJZDogXCJlc2lnYW1tYVwiLFxuXHRzdG9yYWdlQnVja2V0OiBcImVzaWdhbW1hLmFwcHNwb3QuY29tXCIsXG5cdG1lc3NhZ2luZ1NlbmRlcklkOiBcIjczNDE2MzYzNjAzOVwiXG59O1xuZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChjb25maWcpO1xuXG5sZXQgZGF0YWJhc2UgPSBmaXJlYmFzZS5kYXRhYmFzZSgpO1xubGV0IGJhdHRsZXNoaXAgPSBTaGlwKCk7XG5cbmxldCB0ZXN0O1xuXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSwgdXJsKSB7XG5cdGlmICghdXJsKSB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcblx0bmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgXCJcXFxcJCZcIik7XG5cdGxldCByZWdleCA9IG5ldyBSZWdFeHAoXCJbPyZdXCIgKyBuYW1lICsgXCIoPShbXiYjXSopfCZ8I3wkKVwiKTtcblx0bGV0IHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG5cdGlmICghcmVzdWx0cykgcmV0dXJuIG51bGw7XG5cdGlmICghcmVzdWx0c1syXSkgcmV0dXJuICcnO1xuXHRyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csIFwiIFwiKSk7XG59XG5cbmZ1bmN0aW9uIFNpbXVsYXRpb24oKSB7XG5cdFxuXHQvLyBwcml2YXRlXG5cdGxldCBDb25zdGFudHMgPSB7XG5cdFx0R3JpZFNjYWxlOiA0LFxuXHRcdENhbWVyYVlPZmZzZXQ6IDI1LFxuXHRcdE9jZWFuWU9mZnNldDogMCxcblx0XHRPY2VhblBhZGRpbmc6IDEwLFxuXHRcdFNoaXBZT2Zmc2V0OiAwLFxuXHRcdFNpbmtEaXN0YW5jZTogNSxcblx0XHRCdWxsZXRBcmM6IDIsXG5cdFx0V2FpdFRpbWVQZXJUaWxlTW92ZWQ6IDMwMCxcblx0XHRXYWl0VGltZUJldHdlZW5BY3Rpb246IDUwIC8vIGluIG1pbGlzZWNvbmRzXG5cdH07XG5cblx0bGV0IG1faW5wdXQgPSB7fTtcblx0XG5cdGxldCBtX3NoaXBzID0gW107IC8vIHN0b3JlcyBmb3JtYXR0ZWQganNvbiBvZiBzaGlwIGluaXRpYWxpemF0aW9uXG5cdGxldCBtX2NoYWluID0gW107IC8vIHN0b3JlcyBjaGFpbmFibGUgYWN0aW9ucyBpbiBhIHR1cm5cblx0bGV0IG1fZW50aXR5ID0ge307IC8vIG9iamVjdCB3aXRoIGlkIHRvIGh0bWwgZG9tIGVsZW1lbnQgb2Ygc2hpcHNcblxuXHRsZXQgbV90ZXN0ID0gMDtcblxuXHRsZXQgbV9vY2VhbjsgXG5cblx0ZnVuY3Rpb24gdHJhbnNmb3JtKGRhdGEsIHNjYWxlLCBPUFRJT04pIHtcblx0XHRjb25zb2xlLmxvZyhcInRyYW5zZm9ybSgpIFwiLCBkYXRhKTtcblx0XHRsZXQgcmVzdWx0ID0gZGF0YS5tYXAoKGVudHJ5KSA9PiB7XG5cdFx0XHRpZiAoZW50cnkuaGFzT3duUHJvcGVydHkoXCJhdFhcIikgJiYgZW50cnkuaGFzT3duUHJvcGVydHkoXCJhdFlcIikpIHtcblx0XHRcdFx0ZW50cnkuYXRYID0gc2NhbGUgKiBlbnRyeS5hdFg7XG5cdFx0XHRcdGVudHJ5LmF0WiA9IHNjYWxlICogZW50cnkuYXRZOyAvLyAzRCB1c2VzIHRoZSB4eiBwbGFuZSBhcyBwYXJ0IG9mIHRoZSBncm91bmRcblx0XHRcdFx0ZW50cnkuYXRZID0gT1BUSU9OLlNoaXBZT2Zmc2V0OyAvLyB2ZXJ0aWNhbCBvZmZzZXQgd2l0aCByZXNwZWN0IHRvIHRoZSBncm91bmQgYW5kIHVzZXIgaW4gVlIgbW9kZVxuXHRcdFx0fVxuXHRcdFx0ZW50cnkueCA9IHNjYWxlICogZW50cnkueDtcblx0XHRcdGVudHJ5LnogPSBzY2FsZSAqIGVudHJ5Lnk7IC8vIDNEIHVzZXMgdGhlIHh6IHBsYW5lIGFzIHBhcnQgb2YgdGhlIGdyb3VuZFxuXHRcdFx0ZW50cnkueSA9IE9QVElPTi5TaGlwWU9mZnNldDtcblx0XHRcdHJldHVybiBlbnRyeTtcblx0XHR9KTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9O1xuXG5cdGZ1bmN0aW9uIHJlZHVjZXIodHJlZSwgYWN0aW9uLCBPUFRJT04pIHtcblx0XHRjb25zb2xlLmxvZyh0cmVlKTtcblx0XHRsZXQgc3RydWN0dXJlID0ge1xuXHRcdFx0c3RhdGVzOiB0cmVlLnN0YXRlcyxcblx0XHRcdG5leHQ6IGFjdGlvblxuXHRcdH07XG5cblx0XHRzdHJ1Y3R1cmUuc3RhdGVzID0gdHJlZS5zdGF0ZXMubWFwKChzaGlwKSA9PiB7XG5cdFx0XHRpZiAoYWN0aW9uLmlkID09PSBzaGlwLmlkKSB7XG5cdFx0XHRcdHN3aXRjaChhY3Rpb24udHlwZSkge1xuXHRcdFx0XHRcdGNhc2UgJ01PVkUnOlxuXHRcdFx0XHRcdFx0Ly8gaXRlcmF0ZSBvdmVyIGFsbCB0aGUgY2hhaW5lZCBhY3Rpb25zIGFuZCBhcHBseSBpdCB0aGUgdGhlIHN0YXRlXG5cdFx0XHRcdFx0XHQvLyBmdW5jdGlvbiB3b3VsZCBuZWVkIHRvIGNoZWNrIHZhbGlkaXR5IGluIG1vdmVtZW50LCB3aGljaCBub3QgY2hlY2tlZCBpbiB0aGUgZGF0YVxuXHRcdFx0XHRcdFx0Ly8gYWN0aW9uLmFjdGlvbnMuZm9yRWFjaCgoYSkgPT4ge1xuXHRcdFx0XHRcdFx0Ly8gXHRpZiAoYS5kaXJlY3Rpb24gPT09IFwiTm9ydGhcIikge1xuXHRcdFx0XHRcdFx0Ly8gXHRcdGlmIChzaGlwLnogPiAwKVxuXHRcdFx0XHRcdFx0Ly8gXHRcdFx0c2hpcC56IC09IE9QVElPTi5HcmlkU2NhbGU7XG5cdFx0XHRcdFx0XHQvLyBcdH1cblx0XHRcdFx0XHRcdC8vIFx0ZWxzZSBpZiAoYS5kaXJlY3Rpb24gPT09IFwiU291dGhcIikge1xuXHRcdFx0XHRcdFx0Ly8gXHRcdHNoaXAueiArPSBPUFRJT04uR3JpZFNjYWxlO1xuXHRcdFx0XHRcdFx0Ly8gXHR9XG5cdFx0XHRcdFx0XHQvLyBcdGVsc2UgaWYgKGEuZGlyZWN0aW9uID09PSBcIldlc3RcIikge1xuXHRcdFx0XHRcdFx0Ly8gXHRcdGlmIChzaGlwLnggPiAwKVxuXHRcdFx0XHRcdFx0Ly8gXHRcdFx0c2hpcC54IC09IE9QVElPTi5HcmlkU2NhbGU7XG5cdFx0XHRcdFx0XHQvLyBcdH1cblx0XHRcdFx0XHRcdC8vIFx0ZWxzZSBpZiAoYS5kaXJlY3Rpb24gPT09IFwiRWFzdFwiKSB7XG5cdFx0XHRcdFx0XHQvLyBcdFx0c2hpcC54ICs9IE9QVElPTi5HcmlkU2NhbGU7XG5cdFx0XHRcdFx0XHQvLyBcdH1cblx0XHRcdFx0XHRcdC8vIH0pO1xuXG5cdFx0XHRcdFx0XHQvLyBzaG9ydGN1dCwgdXBkYXRlIHN0YXRlIGZyb20gdGhlIHJlc3VsdCBvZiB0aGUgbGFzdCBhY3Rpb24gbGlzdFxuXHRcdFx0XHRcdFx0bGV0IGxhc3QgPSBhY3Rpb24uYWN0aW9uc1thY3Rpb24uYWN0aW9ucy5sZW5ndGgtMV07XG5cdFx0XHRcdFx0XHRzaGlwLnogPSBsYXN0Lno7XG5cdFx0XHRcdFx0XHRzaGlwLnggPSBsYXN0Lng7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2hpcDtcblx0XHRcdFx0XHRjYXNlICdTdW5rJzpcblx0XHRcdFx0XHRcdHNoaXAuc3VuayA9IHRydWU7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2hpcDtcblx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0cmV0dXJuIHNoaXA7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gc2hpcDtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRyZXR1cm4gc3RydWN0dXJlO1xuXHR9XG5cblx0Ly8gTWFwIGEgc2VxdWVuY2Ugb2YgYWN0aW9ucyB0aGF0IGFyZSBjb25zaWRlcmVkIGF0b21pYyBpbnRvIGEgY2hhaW4tYWJsZSBsaXN0IG9mIGFjdGlvbnMgZm9yIHNtb290aCBhbmltYXRpb24gYW5kIG1vdmVtZW50cyBcblx0ZnVuY3Rpb24gYWN0aW9uQ2hhaW4oZGF0YSkge1xuXHRcdGxldCByZXN1bHQgPSBbXTtcblx0XHRkYXRhLm1hcCgoZW50cnkpID0+IHtcblx0XHRcdGlmIChyZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCA+IDApIHsgXG5cdFx0XHRcdC8vIHJlc3VsdFtpXSB3aWxsIGFsd2F5cyBoYXZlIGF0IGxlYXN0IG9uZSBpdGVtIGluIGl0cyBhY3Rpb24gYXR0cmlidXRlIGxpc3Rcblx0XHRcdFx0bGV0IGxhc3QgPSByZXN1bHRbcmVzdWx0Lmxlbmd0aC0xXS5hY3Rpb25zO1xuXHRcdFx0XHQvLyBhY3Rpb24gY2FuIGJlIGNoYWluZWQgaWYgdGhleSBhcmUgb2YgdGhlIHNhbWUgdHlwZSBmcm9tIHRoZSBzYW1lIHNoaXAgaWRcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coXCJDb21wYXJpbmc6IFwiLCByZXN1bHRbcmVzdWx0Lmxlbmd0aC0xXSwgbGFzdCwgZW50cnkpO1xuXHRcdFx0XHRpZiAobGFzdFswXS5pZCA9PT0gZW50cnkuaWQgJiYgbGFzdFswXS50eXBlID09PSBlbnRyeS50eXBlICYmIFxuXHRcdFx0XHRcdCgobGFzdFswXS50eXBlID09PSBcIk1PVkVcIikgfHwgXG5cdFx0XHRcdFx0IChsYXN0WzBdLnR5cGUgPT09IFwiRklSRVwiICYmIGxhc3RbMF0uYXRYID09PSBlbnRyeS5hdFggJiYgbGFzdFswXS5hdFkgPT09IGVudHJ5LmF0WSkgKSkge1xuXHRcdFx0XHRcdC8vIE1vdmVtZW50IGNhbiBiZSBjaGFpbmVkIGFuZCBmaXJpbmcgYXQgdGhlIHNhbWUgbG9jYXRpb24gY2FuIGJlIGNoYWluZWRcblx0XHRcdFx0XHRsYXN0LnB1c2goZW50cnkpO1xuXHRcdFx0XHR9IFxuXHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRyZXN1bHQucHVzaCh7XG5cdFx0XHRcdFx0XHR0eXBlOiBlbnRyeS50eXBlLFxuXHRcdFx0XHRcdFx0YWN0aW9uczogW2VudHJ5XVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IFxuXHRcdFx0ZWxzZSB7IC8vIGlmIHJlc3VsdCBpcyBlbXB0eSwgaW5pdGlhbCBjYXNlXG5cdFx0XHRcdHJlc3VsdC5wdXNoKHtcblx0XHRcdFx0XHR0eXBlOiBlbnRyeS50eXBlLFxuXHRcdFx0XHRcdGFjdGlvbnM6IFtlbnRyeV1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0Y29uc29sZS5sb2cocmVzdWx0KTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJlcHJvY2VzcyhkYXRhLCBPUFRJT04pIHtcblx0XHRsZXQgcmVzdWx0ID0ge307XG5cdFx0Y29uc29sZS5sb2coXCJwcmVwcm9jZXNzKCkgXCIsIGRhdGEsIE9QVElPTik7XG5cblx0XHQvLyBkZWZpbmVzIHRoZSBvY2Vhbi9tYXAgY29uZmlndXJhdGlvblxuXHRcdHJlc3VsdC5tYXAgPSB7XG5cdFx0XHR4OiAoKE9QVElPTi5HcmlkU2NhbGUqTWF0aC5mbG9vcihkYXRhLm9jZWFuLngvMikpLTIpLFxuXHRcdFx0eTogT1BUSU9OLk9jZWFuWU9mZnNldCwgXG5cdFx0XHR6OiAoKE9QVElPTi5HcmlkU2NhbGUqTWF0aC5mbG9vcihkYXRhLm9jZWFuLnkvMikpKSxcblx0XHRcdHdpZHRoOiAyMDAsIFxuXHRcdFx0ZGVwdGg6IDIwMCxcblx0XHRcdGRlbnNpdHk6IDEyMFxuXHRcdH1cblxuXHRcdC8vIHNjYWxlIHVwIHNoaXAncyBpbml0aWFsIGxvY2F0aW9uc1xuXHRcdHJlc3VsdC5zaGlwcyA9IHRyYW5zZm9ybShkYXRhLnNoaXBzLCBPUFRJT04uR3JpZFNjYWxlLCBPUFRJT04pO1xuXG5cdFx0Ly8gYWRkIHN1bmsgcHJvcGVydHkgaW50byB0aGUgaW5pdGlhbCBzdGF0ZSBvZiB0aGUgc2hpcHNcblx0XHRyZXN1bHQuc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuXHRcdFx0c2hpcC5zdW5rID0gZmFsc2U7XG5cdFx0fSk7XG5cblx0XHQvLyBzY2FsZSB1cCBjb29yZGluYXRlcyBpbiB0aGUgYWN0aW9uIGxpc3QsIHRoZW4gY2FsbCB0aGUgYWN0aW9uQ2hhaW4gdG8gZ3JvdXAgc2VxdWVuY2VzIG9mIGFjdGlvbiBpbnRvIGEgdW5pdFxuXHRcdHJlc3VsdC50dXJucyA9IGFjdGlvbkNoYWluKCB0cmFuc2Zvcm0oZGF0YS50dXJucywgT1BUSU9OLkdyaWRTY2FsZSwgT1BUSU9OKSApO1xuXHRcdHJlc3VsdC50dXJucy5wdXNoKHt0eXBlOiAnRU5EJywgYWN0aW9uczogdW5kZWZpbmVkfSk7IC8vIGFkZCBlbmQgb2Ygc2ltdWxhdGlvbiBtYXJrZXJcblxuXHRcdGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cblx0XHRyZXN1bHQuc25hcHNob3RzID0ge1xuXHRcdFx0cGFzdDogW10sXG5cdFx0XHRwcmVzZW50OiB7fSxcblx0XHRcdGZ1dHVyZTogW11cblx0XHR9O1xuXG5cdFx0Y29uc29sZS5sb2coJ2luaXQgc3RhdGVzOiAnLCByZXN1bHQuc2hpcHMpO1xuXG5cdFx0bGV0IGN1cnJlbnRTdGF0ZSA9IHtzdGF0ZXM6IHJlc3VsdC5zaGlwcywgbmV4dDogcmVzdWx0LnR1cm5zWzBdfTtcblx0XHRyZXN1bHQudHVybnMuZm9yRWFjaCgodHVybikgPT4ge1xuXHRcdFx0cmVzdWx0LnNuYXBzaG90cy5mdXR1cmUudW5zaGlmdChjdXJyZW50U3RhdGUpO1xuXHRcdFx0Y3VycmVudFN0YXRlID0gcmVkdWNlcihjdXJyZW50U3RhdGUsIHR1cm4sIE9QVElPTik7XG5cdFx0fSk7XG5cdFx0Ly8gcmVzdWx0LnNuYXBzaG90cy5mdXR1cmUucmV2ZXJzZSgpO1xuXHRcdHJlc3VsdC5zbmFwc2hvdHMucHJlc2VudCA9IHJlc3VsdC5zbmFwc2hvdHMuZnV0dXJlLnBvcCgwKTtcblxuXHRcdGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdGZ1bmN0aW9uIHJlbmRlcihkYXRhLCBPUFRJT04pIHtcblx0XHRsZXQgaHRtbEVsZW1lbnQgPSB7fTtcblx0XHRsZXQgZG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjZW5lJyk7IC8vIDxhLXNjZW5lPiByZWZlcmVuY2VcblxuXHRcdC8vIHJlcG9zaXRpb24gY2FtZXJhIC0gY2FtZXJhIG11c3QgYmUgYWxyZWFkeSBwcmVzZW50IHdoZW4gaHRtbCBsb2Fkc1xuXHRcdGxldCBjYW1lcmEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FtZXJhJyk7XG5cdFx0Ly9jYW1lcmEuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGRhdGEub2NlYW4ueCArIFwiIFwiICsgZGF0YS5vY2Vhbi55ICsgXCIgXCIgKyBkYXRhLm9jZWFuLnopO1xuXHRcdGNhbWVyYS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgZGF0YS5tYXAueCArIFwiIFwiICsgZGF0YS5tYXAueSArIFwiIFwiICsgKGRhdGEubWFwLnorKDEuNSpkYXRhLm1hcC54KSkpO1xuXHRcdGNhbWVyYS5zZXRBdHRyaWJ1dGUoJ2NhbWVyYScsICd1c2VySGVpZ2h0OiAnICsgT1BUSU9OLkNhbWVyYVlPZmZzZXQpO1xuXHRcdGNhbWVyYS5zZXRBdHRyaWJ1dGUoJ3JvdGF0aW9uJywgLU1hdGguYXRhbihPUFRJT04uQ2FtZXJhWU9mZnNldC8oZGF0YS5tYXAueitkYXRhLm1hcC54KSkpO1xuXG5cdFx0Ly8gR2VuZXJhdGUgTWFwXG5cdFx0Ly8gVE9ETzogUG9zc2libGUgZWRnZSBjYXNlcyB3aXRoIHRoZSBtYXAgZWRnZSBub3QgYmVpbmcgYmlnIGVub3VnaFxuXHRcdGxldCBtYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLW9jZWFuJyk7XG5cdFx0bWFwLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBkYXRhLm1hcC54ICsgXCIgXCIgKyBkYXRhLm1hcC55ICsgXCIgXCIgKyBkYXRhLm1hcC56KTtcblx0XHRtYXAuc2V0QXR0cmlidXRlKCd3aWR0aCcsIFN0cmluZyhkYXRhLm1hcC53aWR0aCkpO1xuXHRcdG1hcC5zZXRBdHRyaWJ1dGUoJ2RlcHRoJywgU3RyaW5nKGRhdGEubWFwLmRlcHRoKSk7XG5cdFx0bWFwLnNldEF0dHJpYnV0ZSgnZGVuc2l0eScsIFN0cmluZyhkYXRhLm1hcC5kZW5zaXR5KSk7XG5cdFx0ZG9jLmFwcGVuZENoaWxkKG1hcCk7XG5cblx0XHQvLyBTcGF3biBTaGlwc1xuXHRcdGRhdGEuc2hpcHMuZm9yRWFjaCgoZW50cnkpID0+IHtcblx0XHRcdGh0bWxFbGVtZW50W2VudHJ5LmlkXSA9IGJhdHRsZXNoaXAucmVuZGVyKGVudHJ5KTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIGluaXRTY2VuZShpbnB1dHMpIHtcblx0XHRsZXQgZG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjZW5lJyk7XG5cdFx0bGV0IHRyYWNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYS1jdXJ2ZScpO1xuXHRcdHRyYWNrLnNldEF0dHJpYnV0ZSgnaWQnLCAndHJhY2snKTtcblx0XHR0cmFjay5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnTGluZScpO1xuXHRcdGRvYy5hcHBlbmRDaGlsZCh0cmFjayk7XG5cblx0XHRjb25zb2xlLmxvZyhcImluaXRTY2VuZSgpIFwiLCBpbnB1dHMpO1xuXHRcdGxldCBkYXRhID0gcHJlcHJvY2VzcyhpbnB1dHMsIENvbnN0YW50cyk7XG5cblx0XHRsZXQgaHRtbEVsZW1lbnRzID0gcmVuZGVyKGRhdGEsIENvbnN0YW50cyk7XG5cdFx0Y29uc29sZS5sb2coZGF0YSk7XG5cblx0XHRsZXQgc2xpZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2xpZGVyJyk7XG5cdFx0c2xpZGUuc2V0QXR0cmlidXRlKCdtaW4nLCAwKTtcblx0XHRzbGlkZS5zZXRBdHRyaWJ1dGUoJ21heCcsIGRhdGEuc25hcHNob3RzLmZ1dHVyZS5sZW5ndGgpO1xuXHRcdHNsaWRlLnZhbHVlID0gMDtcblxuXHRcdGxldCBtb2RlbCA9IHtcblx0XHRcdGh0bWw6IGh0bWxFbGVtZW50cyxcblx0XHRcdHNuYXBzaG90czpkYXRhLnNuYXBzaG90c1xuXHRcdH07XG5cdFx0dGVzdCA9IG1vZGVsO1xuXG5cdFx0Ly8gYmVnaW4gc2ltdWxhdGlvblxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0c2ltdWxhdGUobW9kZWwsIENvbnN0YW50cyk7XG5cdFx0fSwgMTAwMDApXG5cdH1cblxuXHRmdW5jdGlvbiBzaW11bGF0ZSgpIHtcblx0XHQvL2NvbnNvbGUubG9nKFwiY2hhaW46IFwiLCBtX2NoYWluKTtcblx0XHR2YXIgbm90U3RvcCA9IHRydWU7XG5cdFx0aWYgKG1fY2hhaW4ubGVuZ3RoID09IDApIHtcblx0XHRcdG5vdFN0b3AgPSBmYWxzZTtcblx0XHR9XG5cdFx0dmFyIGN1cnJlbnQgPSBtX2NoYWluLnNoaWZ0KCk7IC8vIGRvbid0IHNoaWZ0IHdoZW4gbGVuZ3RoIGlzIHplcm9cblx0XHRpZiAoY3VycmVudCAmJiBub3RTdG9wKSB7XG5cdFx0XHQvL2NvbnNvbGUubG9nKFwiY3VycmVudDogXCIsIGN1cnJlbnQpO1xuXHRcdFx0c3dpdGNoKGN1cnJlbnQudHlwZSkge1xuXHRcdFx0XHRjYXNlIFwiTU9WRVwiOlxuXHRcdFx0XHRcdGJhdHRsZXNoaXAubW92ZVNoaXAoY3VycmVudC5hY3Rpb25zKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHQvL2FsZXJ0KFwiTW92ZWQgXCIgKyBtX2NoYWluLmxlbmd0aCArIFwiIGFjdGlvbnMgbGVmdFwiKTtcblx0XHRcdFx0XHRcdHNpbXVsYXRlKCk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goKGVycikgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiRklSRVwiOlxuXHRcdFx0XHRcdC8qKiogRXhjbHVzaXZlIE9yIGZ1bmN0aW9ucyAqKiovXG5cblx0XHRcdFx0XHQvKiBGaXJlIHdpdGhvdXQgYWltaW5nICovXG5cdFx0XHRcdFx0YmF0dGxlc2hpcC5maXJlU2hpcChjdXJyZW50LmFjdGlvbnMpLnRoZW4oKGRvbmUpID0+IHtcblx0XHRcdFx0XHRcdHNpbXVsYXRlKCk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goKGVycikgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcImVycm9yOiBcIiwgZXJyKTtcdFxuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Ly8gLyogQWltIHRoZW4gZmlyZSAoY3VycmVudGx5IGJ1Z2d5KSovXG5cdFx0XHRcdFx0Ly8gYmF0dGxlc2hpcC5haW1TaGlwKGN1cnJlbnQuYWN0aW9ucykudGhlbigoZG9uZSkgPT4ge1xuXHRcdFx0XHRcdC8vIFx0YmF0dGxlc2hpcC5maXJlU2hpcChjdXJyZW50LmFjdGlvbnMpLnRoZW4oKGRvbmUpID0+IHtcblx0XHRcdFx0XHQvLyBcdFx0c2ltdWxhdGUoKTtcblx0XHRcdFx0XHQvLyBcdH0pLmNhdGNoKChlcnIpID0+IHtcblx0XHRcdFx0XHQvLyBcdFx0Y29uc29sZS5lcnJvcihcImVycm9yOiBcIiwgZXJyKTtcdFxuXHRcdFx0XHRcdC8vIFx0fSk7XG5cdFx0XHRcdFx0Ly8gfSkuY2F0Y2goKGVycikgPT4ge1xuXHRcdFx0XHRcdC8vIFx0Y29uc29sZS5lcnJvcihcImVycm9yOiBcIiwgZXJyKTtcblx0XHRcdFx0XHQvLyB9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcIkhJVFwiOlxuXHRcdFx0XHRcdGJhdHRsZXNoaXAuaGl0U2hpcChjdXJyZW50LmFjdGlvbnMpLnRoZW4oKGRvbmUpID0+IHtcblx0XHRcdFx0XHRcdHNpbXVsYXRlKCk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goKGVycikgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5sb2coZXJyKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcIlNJTktcIjpcblx0XHRcdFx0XHRiYXR0bGVzaGlwLnNpbmtTaGlwKGN1cnJlbnQuYWN0aW9ucykudGhlbigoZG9uZSkgPT4ge1xuXHRcdFx0XHRcdFx0Ly9hbGVydChcIlN1bmsgXCIrIG1fY2hhaW4ubGVuZ3RoICsgXCIgYWN0aW9ucyBsZWZ0XCIpO1xuXHRcdFx0XHRcdFx0c2ltdWxhdGUoKTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKGBVbmtub3duIEFjdGlvbiB0eXBlICR7Y3VycmVudC50eXBlfSBpbiBzaW11bGF0ZSBmdW5jdGlvbiwgc2tpcHBpbmcuYCk7XG5cdFx0XHRcdFx0c2ltdWxhdGUoKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdC8vYWxlcnQoXCJTaW11bGF0aW9uIERvbmVcIik7XG5cdFx0XHRcdHZleC5kaWFsb2cuYWxlcnQoXCJTaW11bGF0aW9uIENvbXBsZXRlZC5cIik7XG5cdFx0XHR9LCAxMDAwKTtcblx0XHR9XG5cdH1cblxuXHQvLyBwdWJsaWNcblx0dmFyIGFwcCA9IHtcblxuXHRcdGluaXQ6ICgpID0+IHtcblx0XHRcdGxldCBpbnB1dHMgPSB7fTtcblx0XHRcdGxldCBjb2RlID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdjb2RlJyk7XG5cblx0XHRcdGlmIChjb2RlKSB7XG5cdFx0XHRcdGxldCByZWYgPSBkYXRhYmFzZS5yZWYoJ2Rhdnktam9uZXMtbG9ja2VyJykuY2hpbGQoY29kZSk7XG5cdFx0XHRcdHJlZi5vbmNlKCd2YWx1ZScsIChyZXMpID0+IHtcblx0XHRcdFx0XHRpbnB1dHMgPSB7XG5cdFx0XHRcdFx0XHRcImlkc1wiOiByZXMudmFsKCkuaW5pdC5zaGlwcy5tYXAoKHMpID0+IHsgcmV0dXJuIHMuaWQgfSksXG5cdFx0XHRcdFx0XHRcInNoaXBzXCI6IHJlcy52YWwoKS5pbml0LnNoaXBzLFxuXHRcdFx0XHRcdFx0XCJ0dXJuc1wiOiByZXMudmFsKCkudHVybnMsXG5cdFx0XHRcdFx0XHRcIm9jZWFuXCI6IHJlcy52YWwoKS5pbml0Lm1hcFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0sIChlcnIpID0+IHsgXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKGBVbmtub3duIFVSTCBDb2RlICR7Y29kZX0sIHVzaW5nIGRlZmF1bHQgb2ZmbGluZSBpbnB1dGApO1xuXHRcdFx0XHRcdGlucHV0cyA9IHtcblx0XHRcdFx0XHRcdFwiaWRzXCI6IGlucHV0LmluaXQuc2hpcHMubWFwKChzKSA9PiB7IHJldHVybiBzLmlkIH0pLFxuXHRcdFx0XHRcdFx0XCJzaGlwc1wiOiBpbnB1dC5pbml0LnNoaXBzLCBcblx0XHRcdFx0XHRcdFwidHVybnNcIjogaW5wdXQudHVybnMsIFxuXHRcdFx0XHRcdFx0XCJvY2VhblwiOiBpbnB1dC5pbml0Lm1hcFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcImluaXQoKSBcIiwgaW5wdXRzKTtcblx0XHRcdFx0XHRpbml0U2NlbmUoaW5wdXRzKTtcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnTWlzc2luZyBVUkwgcGFyYW1ldGVyIGNvZGUsIHVzaW5nIGRlZmF1bHQgb2ZmbGluZSBpbnB1dCcpO1xuXHRcdFx0XHRpbnB1dHMgPSB7XG5cdFx0XHRcdFx0XCJpZHNcIjogaW5wdXQuaW5pdC5zaGlwcy5tYXAoKHMpID0+IHsgcmV0dXJuIHMuaWQgfSksXG5cdFx0XHRcdFx0XCJzaGlwc1wiOiBpbnB1dC5pbml0LnNoaXBzLCBcblx0XHRcdFx0XHRcInR1cm5zXCI6IGlucHV0LnR1cm5zLCBcblx0XHRcdFx0XHRcIm9jZWFuXCI6IGlucHV0LmluaXQubWFwXG5cdFx0XHRcdH1cblx0XHRcdFx0Y29uc29sZS5sb2coXCJpbml0KCkgXCIsIGlucHV0cyk7XG5cdFx0XHRcdGluaXRTY2VuZShpbnB1dHMpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRyZXR1cm4gYXBwO1xufVxuXG5sZXQgYXBwID0gU2ltdWxhdGlvbigpO1xuYXBwLmluaXQoKTtcblxuLy9sZXQgcGFyYW1zID0gZ2V0UGFyYW1ldGVyQnlOYW1lKGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaCk7XG5cbi8vIGxldCBnZXREYXRhRnJvbUNvZGUgPSAoY29kZSkgPT4ge1xuLy8gXHRkYXRhYmFzZS5yZWYoJ2Rhdnktam9uZXMtbG9ja2VyLycgKyBjb2RlKS5vbmNlKCd2YWx1ZScsIChzbmFwc2hvdCkgPT4ge1xuLy8gXHRcdHZhciBnYW1lRGF0YSA9IHNuYXBzaG90LnZhbCgpO1xuLy8gXHRcdGlmIChnYW1lRGF0YSkge1xuLy8gXHRcdFx0aW5wdXQgPSBnYW1lRGF0YTtcbi8vIFx0XHRcdGFwcC5pbml0KCk7XG4vLyBcdFx0fSBlbHNlIHtcbi8vIFx0XHRcdGdldENvZGUoYE5vIGRhdGEgZm9yIGNvZGUgJHtjb2RlfS4gRW50ZXIgYW5vdGhlciBjb2RlOmApO1xuLy8gXHRcdFx0Ly9hcHAuaW5pdCgpO1xuLy8gXHRcdH1cbi8vIFx0fSkuY2F0Y2goKGVycikgPT4ge1xuLy8gXHRcdGdldENvZGUoYFRoZXJlIHdhcyBhbiBlcnJvci4gRW50ZXIgYW5vdGhlciBjb2RlOmApO1xuLy8gXHRcdC8vYXBwLmluaXQoKTtcbi8vIFx0fSk7XG4vLyB9XG5cbi8vIGxldCBnZXRDb2RlID0gKG1lc3NhZ2UpID0+IHtcbi8vIFx0dmV4LmRpYWxvZy5wcm9tcHQoe1xuLy8gXHRcdG1lc3NhZ2U6IG1lc3NhZ2UsXG4vLyBcdFx0Y2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuLy8gXHRcdFx0aWYgKHZhbHVlKSB7XG4vLyBcdFx0XHRcdHZhciBjb2RlID0gdmFsdWU7XG4vLyBcdFx0XHRcdGdldERhdGFGcm9tQ29kZShjb2RlKTtcbi8vIFx0XHRcdH0gZWxzZSB7XG4vLyBcdFx0XHRcdGdldENvZGUoXCJObyBjb2RlIGVudGVyZWQuIEVudGVyIHlvdXIgY29kZTpcIik7XG4vLyBcdFx0XHR9XG4vLyBcdFx0fVxuLy8gXHR9KTtcbi8vIH1cblxuLy8gaWYgKHBhcmFtcy5jb2RlKSB7XG4vLyBcdGdldERhdGFGcm9tQ29kZShwYXJhbXMuY29kZSk7XG4vLyB9IGVsc2Uge1xuLy8gXHRnZXRDb2RlKFwiRW50ZXIgWW91ciBDb2RlXCIpO1xuLy8gfVxuXG5cbi8vIHZhciBCQVRUTEVfU0VSVkVSX1VSTCA9ICdodHRwczovL2JhdHRsZXNoaXAtdmluZ2thbi5jOXVzZXJzLmlvLzF2MT9wMT1lc2kxNy5jcy5EZXN0cm95ZXJTaGlwJnAyPWVzaTE3LmhsaTEwOS5GbG9hdGVyJzsvLyArIE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMTAwKTtcblxuLy8gJC5nZXQoQkFUVExFX1NFUlZFUl9VUkwpLnRoZW4oZGF0YSA9PiB7XG4vLyBcdGlucHV0ID0gZGF0YTtcbi8vIFx0YXBwLmluaXQoKTtcbi8vIH0pLmRvbmUoKCkgPT4ge1xuLy8gXHRjb25zb2xlLmxvZyhcIkRhdGEgc3VjY2Vzc2Z1bGx5IHJldHJpZXZlZCBmcm9tIHNlcnZlclwiKTtcbi8vIH0pLmZhaWwoKCkgPT4ge1xuLy8gXHRjb25zb2xlLmxvZyhcIlVuYWJsZSB0byByZXRyaWV2ZSBkYXRhLCBzdGFydGluZyB3aXRoIGxvY2FsIGRhdGFcIik7XG4vLyBcdGFwcC5pbml0KCk7XG4vLyB9KTtcblxuXG5cbiJdfQ==\n"]}