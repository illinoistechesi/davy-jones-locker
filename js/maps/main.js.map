{"version":3,"sources":["main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","Simulation","transform","data","scale","OPTION","console","log","map","entry","hasOwnProperty","atX","atZ","atY","ShipYOffset","x","z","y","preprocess","result","GridScale","Math","floor","ocean","OceanYOffset","width","depth","density","ships","forEach","ship","sunk","turns","actionChain","push","type","actions","undefined","snapshots","past","present","future","currentState","states","next","resutl","turn","append","tree","action","structure","id","last","reducer","pop","initScene","inputs","doc","document","getElementById","track","createElement","setAttribute","appendChild","Constants","htmlElements","htmlElement","camera","CameraYOffset","atan","String","battleship","render","slide","value","model","html","test","setTimeout","simulate","notStop","m_chain","current","shift","moveShip","then","done","catch","err","error","fireShip","hitShip","sinkShip","warn","vex","dialog","alert","OceanPadding","SinkDistance","BulletArc","WaitTimePerTileMoved","WaitTimeBetweenAction","init","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","getParameterByName","database","ref","child","once","res","ids","val","input","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","Ship"],"mappings":"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","file":"../main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\n// Initialize Firebase\nvar config = {\n\tapiKey: \"AIzaSyA9EYUXVL5WAh6Aam1qXlWyvi3b7HLcZ1U\",\n\tauthDomain: \"esigamma.firebaseapp.com\",\n\tdatabaseURL: \"https://esigamma.firebaseio.com\",\n\tprojectId: \"esigamma\",\n\tstorageBucket: \"esigamma.appspot.com\",\n\tmessagingSenderId: \"734163636039\"\n};\nfirebase.initializeApp(config);\n\nvar database = firebase.database();\nvar battleship = Ship();\n\nvar test = void 0;\n\nfunction getParameterByName(name, url) {\n\tif (!url) url = window.location.href;\n\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n\tvar results = regex.exec(url);\n\tif (!results) return null;\n\tif (!results[2]) return '';\n\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nfunction Simulation() {\n\n\t// private\n\tvar Constants = {\n\t\tGridScale: 4,\n\t\tCameraYOffset: 25,\n\t\tOceanYOffset: 0,\n\t\tOceanPadding: 10,\n\t\tShipYOffset: 0,\n\t\tSinkDistance: 5,\n\t\tBulletArc: 2,\n\t\tWaitTimePerTileMoved: 300,\n\t\tWaitTimeBetweenAction: 50 // in miliseconds\n\t};\n\n\tvar m_input = {};\n\n\tvar m_ships = []; // stores formatted json of ship initialization\n\tvar m_chain = []; // stores chainable actions in a turn\n\tvar m_entity = {}; // object with id to html dom element of ships\n\n\tvar m_test = 0;\n\n\tvar m_ocean = void 0;\n\n\tfunction transform(data, scale, OPTION) {\n\t\tconsole.log(\"transform() \", data);\n\t\tvar result = data.map(function (entry) {\n\t\t\tif (entry.hasOwnProperty(\"atX\") && entry.hasOwnProperty(\"atY\")) {\n\t\t\t\tentry.atX = scale * entry.atX;\n\t\t\t\tentry.atZ = scale * entry.atY; // 3D uses the xz plane as part of the ground\n\t\t\t\tentry.atY = OPTION.ShipYOffset; // vertical offset with respect to the ground and user in VR mode\n\t\t\t}\n\t\t\tentry.x = scale * entry.x;\n\t\t\tentry.z = scale * entry.y; // 3D uses the xz plane as part of the ground\n\t\t\tentry.y = OPTION.ShipYOffset;\n\t\t\treturn entry;\n\t\t});\n\t\treturn result;\n\t};\n\n\tfunction reducer(tree, action, OPTION) {\n\t\tconsole.log(tree);\n\t\tvar structure = {\n\t\t\tstates: tree.states,\n\t\t\tnext: action\n\t\t};\n\n\t\tstructure.states = tree.states.map(function (ship) {\n\t\t\tif (action.id === ship.id) {\n\t\t\t\tswitch (action.type) {\n\t\t\t\t\tcase 'MOVE':\n\t\t\t\t\t\t// iterate over all the chained actions and apply it the the state\n\t\t\t\t\t\t// function would need to check validity in movement, which not checked in the data\n\t\t\t\t\t\t// action.actions.forEach((a) => {\n\t\t\t\t\t\t// \tif (a.direction === \"North\") {\n\t\t\t\t\t\t// \t\tif (ship.z > 0)\n\t\t\t\t\t\t// \t\t\tship.z -= OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"South\") {\n\t\t\t\t\t\t// \t\tship.z += OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"West\") {\n\t\t\t\t\t\t// \t\tif (ship.x > 0)\n\t\t\t\t\t\t// \t\t\tship.x -= OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"East\") {\n\t\t\t\t\t\t// \t\tship.x += OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// });\n\n\t\t\t\t\t\t// shortcut, update state from the result of the last action list\n\t\t\t\t\t\tvar last = action.actions[action.actions.length - 1];\n\t\t\t\t\t\tship.z = last.z;\n\t\t\t\t\t\tship.x = last.x;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tcase 'Sunk':\n\t\t\t\t\t\tship.sunk = true;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn ship;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn ship;\n\t\t\t}\n\t\t});\n\t\treturn structure;\n\t}\n\n\tfunction preprocess(data, OPTION) {\n\t\tvar result = {};\n\t\tconsole.log(\"preprocess() \", data);\n\n\t\t// defines the ocean/map configuration\n\t\tresult.map = {\n\t\t\tx: OPTION.GridScale * Math.floor(data.ocean.x / 2) - 2,\n\t\t\ty: OPTION.OceanYOffset,\n\t\t\tz: OPTION.GridScale * Math.floor(data.ocean.y / 2),\n\t\t\twidth: 200,\n\t\t\tdepth: 200,\n\t\t\tdensity: 120\n\n\t\t\t// scale up ship's initial locations\n\t\t};result.ships = transform(data.ships, OPTION.GridScale);\n\n\t\t// add sunk property into the initial state of the ships\n\t\tresult.ships.forEach(function (ship) {\n\t\t\tship.sunk = false;\n\t\t});\n\n\t\t// scale up coordinates in the action list, then call the actionChain to group sequences of action into a unit\n\t\tresult.turns = actionChain(transform(data.turns, OPTION.GridScale, OPTION));\n\t\tresult.turns.push({ type: 'END', actions: undefined }); // add end of simulation marker\n\n\t\tconsole.log(result);\n\n\t\tresult.snapshots = {\n\t\t\tpast: [],\n\t\t\tpresent: {},\n\t\t\tfuture: []\n\t\t};\n\n\t\tconsole.log('init states: ', result.ships);\n\n\t\tvar currentState = { states: result.ships, next: resutl.turns[0] };\n\t\tresult.turns.forEach(function (turn) {\n\t\t\tresult.snapshots.future.append(currentState);\n\t\t\tcurrentState = reducer(currentState, turn, OPTION);\n\t\t});\n\t\t// result.snapshots.future.reverse();\n\t\tresult.snapshots.present = result.snapshots.future.pop(0);\n\n\t\tconsole.log(result);\n\t\treturn result;\n\t}\n\n\tfunction render(data, OPTION) {\n\t\tvar htmlElement = {};\n\t\tvar doc = document.getElementById('scene'); // <a-scene> reference\n\n\t\t// reposition camera - camera must be already present when html loads\n\t\tvar camera = document.getElementById('camera');\n\t\t//camera.setAttribute('position', data.ocean.x + \" \" + data.ocean.y + \" \" + data.ocean.z);\n\t\tcamera.setAttribute('position', data.map.x + \" \" + data.map.y + \" \" + (data.map.z + 1.5 * data.map.x));\n\t\tcamera.setAttribute('camera', 'userHeight: ' + OPTION.CameraYOffset);\n\t\tcamera.setAttribute('rotation', -Math.atan(OPTION.CameraYOffset / (data.map.z + data.map.x)));\n\n\t\t// Generate Map\n\t\t// TODO: Possible edge cases with the map edge not being big enough\n\t\tvar map = document.createElement('a-ocean');\n\t\tmap.setAttribute('position', data.map.x + \" \" + data.map.y + \" \" + data.map.z);\n\t\tmap.setAttribute('width', String(data.map.width));\n\t\tmap.setAttribute('depth', String(data.map.depth));\n\t\tmap.setAttribute('density', String(data.map.density));\n\t\tdoc.appendChild(map);\n\n\t\t// Spawn Ships\n\t\tdata.ships.forEach(function (entry) {\n\t\t\thtmlElement[entry.id] = battleship.render(entry);\n\t\t});\n\t}\n\n\tfunction initScene(inputs) {\n\t\tvar doc = document.getElementById('scene');\n\t\tvar track = document.createElement('a-curve');\n\t\ttrack.setAttribute('id', 'track');\n\t\ttrack.setAttribute('type', 'Line');\n\t\tdoc.appendChild(track);\n\n\t\tconsole.log(\"initScene() \", inputs);\n\t\tvar data = preprocess(inputs, Constants);\n\n\t\tvar htmlElements = render(data, Constants);\n\t\tconsole.log(data);\n\n\t\tvar slide = document.getElementById('slider');\n\t\tslide.setAttribute('min', 0);\n\t\tslide.setAttribute('max', data.snapshots.future.length);\n\t\tslide.value = 0;\n\n\t\tvar model = {\n\t\t\thtml: htmlElements,\n\t\t\tsnapshots: data.snapshots\n\t\t};\n\t\ttest = model;\n\n\t\t// begin simulation\n\t\tsetTimeout(function () {\n\t\t\tsimulate(model, Constants);\n\t\t}, 10000);\n\t}\n\n\tfunction simulate() {\n\t\t//console.log(\"chain: \", m_chain);\n\t\tvar notStop = true;\n\t\tif (m_chain.length == 0) {\n\t\t\tnotStop = false;\n\t\t}\n\t\tvar current = m_chain.shift(); // don't shift when length is zero\n\t\tif (current && notStop) {\n\t\t\t//console.log(\"current: \", current);\n\t\t\tswitch (current.type) {\n\t\t\t\tcase \"MOVE\":\n\t\t\t\t\tbattleship.moveShip(current.actions).then(function (done) {\n\t\t\t\t\t\t//alert(\"Moved \" + m_chain.length + \" actions left\");\n\t\t\t\t\t\tsimulate();\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"FIRE\":\n\t\t\t\t\t/*** Exclusive Or functions ***/\n\n\t\t\t\t\t/* Fire without aiming */\n\t\t\t\t\tbattleship.fireShip(current.actions).then(function (done) {\n\t\t\t\t\t\tsimulate();\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(\"error: \", err);\n\t\t\t\t\t});\n\n\t\t\t\t\t// /* Aim then fire (currently buggy)*/\n\t\t\t\t\t// battleship.aimShip(current.actions).then((done) => {\n\t\t\t\t\t// \tbattleship.fireShip(current.actions).then((done) => {\n\t\t\t\t\t// \t\tsimulate();\n\t\t\t\t\t// \t}).catch((err) => {\n\t\t\t\t\t// \t\tconsole.error(\"error: \", err);\t\n\t\t\t\t\t// \t});\n\t\t\t\t\t// }).catch((err) => {\n\t\t\t\t\t// \tconsole.error(\"error: \", err);\n\t\t\t\t\t// });\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"HIT\":\n\t\t\t\t\tbattleship.hitShip(current.actions).then(function (done) {\n\t\t\t\t\t\tsimulate();\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.log(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"SINK\":\n\t\t\t\t\tbattleship.sinkShip(current.actions).then(function (done) {\n\t\t\t\t\t\t//alert(\"Sunk \"+ m_chain.length + \" actions left\");\n\t\t\t\t\t\tsimulate();\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.warn(\"Unknown Action type \" + current.type + \" in simulate function, skipping.\");\n\t\t\t\t\tsimulate();\n\t\t\t}\n\t\t} else {\n\t\t\tsetTimeout(function () {\n\t\t\t\t//alert(\"Simulation Done\");\n\t\t\t\tvex.dialog.alert(\"Simulation Completed.\");\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\t// public\n\tvar app = {\n\n\t\tinit: function init() {\n\t\t\tvar inputs = {};\n\t\t\tvar code = getParameterByName('code');\n\n\t\t\tif (code) {\n\t\t\t\tvar ref = database.ref('davy-jones-locker').child(code);\n\t\t\t\tref.once('value', function (res) {\n\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\"ids\": res.val().init.ships.map(function (s) {\n\t\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"ships\": res.val().init.ships,\n\t\t\t\t\t\t\"turns\": res.val().turns,\n\t\t\t\t\t\t\"ocean\": res.val().init.map\n\t\t\t\t\t};\n\t\t\t\t}, function (err) {\n\t\t\t\t\tconsole.warn(\"Unknown URL Code \" + code + \", using default offline input\");\n\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\"ids\": input.init.ships.map(function (s) {\n\t\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"ships\": input.init.ships,\n\t\t\t\t\t\t\"turns\": input.turns,\n\t\t\t\t\t\t\"ocean\": input.init.map\n\t\t\t\t\t};\n\t\t\t\t}).then(function () {\n\t\t\t\t\tconsole.log(\"init() \", inputs);\n\t\t\t\t\tinitScene(inputs);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.log('Missing URL parameter code, using default offline input');\n\t\t\t\tinputs = {\n\t\t\t\t\t\"ids\": input.init.ships.map(function (s) {\n\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t}),\n\t\t\t\t\t\"ships\": input.init.ships,\n\t\t\t\t\t\"turns\": input.turns,\n\t\t\t\t\t\"ocean\": input.init.map\n\t\t\t\t};\n\t\t\t\tconsole.log(\"init() \", inputs);\n\t\t\t\tinitScene(inputs);\n\t\t\t}\n\t\t}\n\t};\n\n\treturn app;\n}\n\nvar app = Simulation();\napp.init();\n\n//let params = getParameterByName(document.location.search);\n\n// let getDataFromCode = (code) => {\n// \tdatabase.ref('davy-jones-locker/' + code).once('value', (snapshot) => {\n// \t\tvar gameData = snapshot.val();\n// \t\tif (gameData) {\n// \t\t\tinput = gameData;\n// \t\t\tapp.init();\n// \t\t} else {\n// \t\t\tgetCode(`No data for code ${code}. Enter another code:`);\n// \t\t\t//app.init();\n// \t\t}\n// \t}).catch((err) => {\n// \t\tgetCode(`There was an error. Enter another code:`);\n// \t\t//app.init();\n// \t});\n// }\n\n// let getCode = (message) => {\n// \tvex.dialog.prompt({\n// \t\tmessage: message,\n// \t\tcallback: (value) => {\n// \t\t\tif (value) {\n// \t\t\t\tvar code = value;\n// \t\t\t\tgetDataFromCode(code);\n// \t\t\t} else {\n// \t\t\t\tgetCode(\"No code entered. Enter your code:\");\n// \t\t\t}\n// \t\t}\n// \t});\n// }\n\n// if (params.code) {\n// \tgetDataFromCode(params.code);\n// } else {\n// \tgetCode(\"Enter Your Code\");\n// }\n\n\n// var BATTLE_SERVER_URL = 'https://battleship-vingkan.c9users.io/1v1?p1=esi17.cs.DestroyerShip&p2=esi17.hli109.Floater';// + Math.ceil(Math.random() * 100);\n\n// $.get(BATTLE_SERVER_URL).then(data => {\n// \tinput = data;\n// \tapp.init();\n// }).done(() => {\n// \tconsole.log(\"Data successfully retrieved from server\");\n// }).fail(() => {\n// \tconsole.log(\"Unable to retrieve data, starting with local data\");\n// \tapp.init();\n// });\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7QUFDQSxJQUFJLFNBQVM7QUFDWixTQUFRLHlDQURJO0FBRVosYUFBWSwwQkFGQTtBQUdaLGNBQWEsaUNBSEQ7QUFJWixZQUFXLFVBSkM7QUFLWixnQkFBZSxzQkFMSDtBQU1aLG9CQUFtQjtBQU5QLENBQWI7QUFRQSxTQUFTLGFBQVQsQ0FBdUIsTUFBdkI7O0FBRUEsSUFBSSxXQUFXLFNBQVMsUUFBVCxFQUFmO0FBQ0EsSUFBSSxhQUFhLE1BQWpCOztBQUVBLElBQUksYUFBSjs7QUFFQSxTQUFTLGtCQUFULENBQTRCLElBQTVCLEVBQWtDLEdBQWxDLEVBQXVDO0FBQ3RDLEtBQUksQ0FBQyxHQUFMLEVBQVUsTUFBTSxPQUFPLFFBQVAsQ0FBZ0IsSUFBdEI7QUFDVixRQUFPLEtBQUssT0FBTCxDQUFhLFNBQWIsRUFBd0IsTUFBeEIsQ0FBUDtBQUNBLEtBQUksUUFBUSxJQUFJLE1BQUosQ0FBVyxTQUFTLElBQVQsR0FBZ0IsbUJBQTNCLENBQVo7QUFDQSxLQUFJLFVBQVUsTUFBTSxJQUFOLENBQVcsR0FBWCxDQUFkO0FBQ0EsS0FBSSxDQUFDLE9BQUwsRUFBYyxPQUFPLElBQVA7QUFDZCxLQUFJLENBQUMsUUFBUSxDQUFSLENBQUwsRUFBaUIsT0FBTyxFQUFQO0FBQ2pCLFFBQU8sbUJBQW1CLFFBQVEsQ0FBUixFQUFXLE9BQVgsQ0FBbUIsS0FBbkIsRUFBMEIsR0FBMUIsQ0FBbkIsQ0FBUDtBQUNBOztBQUVELFNBQVMsVUFBVCxHQUFzQjs7QUFFckI7QUFDQSxLQUFJLFlBQVk7QUFDZixhQUFXLENBREk7QUFFZixpQkFBZSxFQUZBO0FBR2YsZ0JBQWMsQ0FIQztBQUlmLGdCQUFjLEVBSkM7QUFLZixlQUFhLENBTEU7QUFNZixnQkFBYyxDQU5DO0FBT2YsYUFBVyxDQVBJO0FBUWYsd0JBQXNCLEdBUlA7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QUNSLFlBQU8sTUFBTSxJQUFOLENBQVcsS0FBWCxDQUFpQixHQUFqQixDQUFxQixVQUFDLENBQUQsRUFBTztBQUFFLGFBQU8sRUFBRSxFQUFUO0FBQWEsTUFBM0MsQ0FEQztBQUVSLGNBQVMsTUFBTSxJQUFOLENBQVcsS0FGWjtBQUdSLGNBQVMsTUFBTSxLQUhQO0FBSVIsY0FBUyxNQUFNLElBQU4sQ0FBVztBQUpaLEtBQVQ7QUFNQSxZQUFRLEdBQVIsQ0FBWSxTQUFaLEVBQXVCLE1BQXZCO0FBQ0EsY0FBVSxNQUFWO0FBQ0E7QUFDRDtBQXhDUSxFQUFWOztBQTJDQSxRQUFPLEdBQVA7QUFDQTs7QUFFRCxJQUFJLE1BQU0sWUFBVjtBQUNBLElBQUksSUFBSjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIEluaXRpYWxpemUgRmlyZWJhc2VcbmxldCBjb25maWcgPSB7XG5cdGFwaUtleTogXCJBSXphU3lBOUVZVVhWTDVXQWg2QWFtMXFYbFd5dmkzYjdITGNaMVVcIixcblx0YXV0aERvbWFpbjogXCJlc2lnYW1tYS5maXJlYmFzZWFwcC5jb21cIixcblx0ZGF0YWJhc2VVUkw6IFwiaHR0cHM6Ly9lc2lnYW1tYS5maXJlYmFzZWlvLmNvbVwiLFxuXHRwcm9qZWN0SWQ6IFwiZXNpZ2FtbWFcIixcblx0c3RvcmFnZUJ1Y2tldDogXCJlc2lnYW1tYS5hcHBzcG90LmNvbVwiLFxuXHRtZXNzYWdpbmdTZW5kZXJJZDogXCI3MzQxNjM2MzYwMzlcIlxufTtcbmZpcmViYXNlLmluaXRpYWxpemVBcHAoY29uZmlnKTtcblxubGV0IGRhdGFiYXNlID0gZmlyZWJhc2UuZGF0YWJhc2UoKTtcbmxldCBiYXR0bGVzaGlwID0gU2hpcCgpO1xuXG5sZXQgdGVzdDtcblxuZnVuY3Rpb24gZ2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUsIHVybCkge1xuXHRpZiAoIXVybCkgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG5cdG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csIFwiXFxcXCQmXCIpO1xuXHRsZXQgcmVnZXggPSBuZXcgUmVnRXhwKFwiWz8mXVwiICsgbmFtZSArIFwiKD0oW14mI10qKXwmfCN8JClcIik7XG5cdGxldCByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuXHRpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuXHRpZiAoIXJlc3VsdHNbMl0pIHJldHVybiAnJztcblx0cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCBcIiBcIikpO1xufVxuXG5mdW5jdGlvbiBTaW11bGF0aW9uKCkge1xuXHRcblx0Ly8gcHJpdmF0ZVxuXHRsZXQgQ29uc3RhbnRzID0ge1xuXHRcdEdyaWRTY2FsZTogNCxcblx0XHRDYW1lcmFZT2Zmc2V0OiAyNSxcblx0XHRPY2VhbllPZmZzZXQ6IDAsXG5cdFx0T2NlYW5QYWRkaW5nOiAxMCxcblx0XHRTaGlwWU9mZnNldDogMCxcblx0XHRTaW5rRGlzdGFuY2U6IDUsXG5cdFx0QnVsbGV0QXJjOiAyLFxuXHRcdFdhaXRUaW1lUGVyVGlsZU1vdmVkOiAzMDAsXG5cdFx0V2FpdFRpbWVCZXR3ZWVuQWN0aW9uOiA1MCAvLyBpbiBtaWxpc2Vjb25kc1xuXHR9O1xuXG5cdGxldCBtX2lucHV0ID0ge307XG5cdFxuXHRsZXQgbV9zaGlwcyA9IFtdOyAvLyBzdG9yZXMgZm9ybWF0dGVkIGpzb24gb2Ygc2hpcCBpbml0aWFsaXphdGlvblxuXHRsZXQgbV9jaGFpbiA9IFtdOyAvLyBzdG9yZXMgY2hhaW5hYmxlIGFjdGlvbnMgaW4gYSB0dXJuXG5cdGxldCBtX2VudGl0eSA9IHt9OyAvLyBvYmplY3Qgd2l0aCBpZCB0byBodG1sIGRvbSBlbGVtZW50IG9mIHNoaXBzXG5cblx0bGV0IG1fdGVzdCA9IDA7XG5cblx0bGV0IG1fb2NlYW47IFxuXG5cdGZ1bmN0aW9uIHRyYW5zZm9ybShkYXRhLCBzY2FsZSwgT1BUSU9OKSB7XG5cdFx0Y29uc29sZS5sb2coXCJ0cmFuc2Zvcm0oKSBcIiwgZGF0YSk7XG5cdFx0bGV0IHJlc3VsdCA9IGRhdGEubWFwKChlbnRyeSkgPT4ge1xuXHRcdFx0aWYgKGVudHJ5Lmhhc093blByb3BlcnR5KFwiYXRYXCIpICYmIGVudHJ5Lmhhc093blByb3BlcnR5KFwiYXRZXCIpKSB7XG5cdFx0XHRcdGVudHJ5LmF0WCA9IHNjYWxlICogZW50cnkuYXRYO1xuXHRcdFx0XHRlbnRyeS5hdFogPSBzY2FsZSAqIGVudHJ5LmF0WTsgLy8gM0QgdXNlcyB0aGUgeHogcGxhbmUgYXMgcGFydCBvZiB0aGUgZ3JvdW5kXG5cdFx0XHRcdGVudHJ5LmF0WSA9IE9QVElPTi5TaGlwWU9mZnNldDsgLy8gdmVydGljYWwgb2Zmc2V0IHdpdGggcmVzcGVjdCB0byB0aGUgZ3JvdW5kIGFuZCB1c2VyIGluIFZSIG1vZGVcblx0XHRcdH1cblx0XHRcdGVudHJ5LnggPSBzY2FsZSAqIGVudHJ5Lng7XG5cdFx0XHRlbnRyeS56ID0gc2NhbGUgKiBlbnRyeS55OyAvLyAzRCB1c2VzIHRoZSB4eiBwbGFuZSBhcyBwYXJ0IG9mIHRoZSBncm91bmRcblx0XHRcdGVudHJ5LnkgPSBPUFRJT04uU2hpcFlPZmZzZXQ7XG5cdFx0XHRyZXR1cm4gZW50cnk7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fTtcblxuXHRmdW5jdGlvbiByZWR1Y2VyKHRyZWUsIGFjdGlvbiwgT1BUSU9OKSB7XG5cdFx0Y29uc29sZS5sb2codHJlZSk7XG5cdFx0bGV0IHN0cnVjdHVyZSA9IHtcblx0XHRcdHN0YXRlczogdHJlZS5zdGF0ZXMsXG5cdFx0XHRuZXh0OiBhY3Rpb25cblx0XHR9O1xuXG5cdFx0c3RydWN0dXJlLnN0YXRlcyA9IHRyZWUuc3RhdGVzLm1hcCgoc2hpcCkgPT4ge1xuXHRcdFx0aWYgKGFjdGlvbi5pZCA9PT0gc2hpcC5pZCkge1xuXHRcdFx0XHRzd2l0Y2goYWN0aW9uLnR5cGUpIHtcblx0XHRcdFx0XHRjYXNlICdNT1ZFJzpcblx0XHRcdFx0XHRcdC8vIGl0ZXJhdGUgb3ZlciBhbGwgdGhlIGNoYWluZWQgYWN0aW9ucyBhbmQgYXBwbHkgaXQgdGhlIHRoZSBzdGF0ZVxuXHRcdFx0XHRcdFx0Ly8gZnVuY3Rpb24gd291bGQgbmVlZCB0byBjaGVjayB2YWxpZGl0eSBpbiBtb3ZlbWVudCwgd2hpY2ggbm90IGNoZWNrZWQgaW4gdGhlIGRhdGFcblx0XHRcdFx0XHRcdC8vIGFjdGlvbi5hY3Rpb25zLmZvckVhY2goKGEpID0+IHtcblx0XHRcdFx0XHRcdC8vIFx0aWYgKGEuZGlyZWN0aW9uID09PSBcIk5vcnRoXCIpIHtcblx0XHRcdFx0XHRcdC8vIFx0XHRpZiAoc2hpcC56ID4gMClcblx0XHRcdFx0XHRcdC8vIFx0XHRcdHNoaXAueiAtPSBPUFRJT04uR3JpZFNjYWxlO1xuXHRcdFx0XHRcdFx0Ly8gXHR9XG5cdFx0XHRcdFx0XHQvLyBcdGVsc2UgaWYgKGEuZGlyZWN0aW9uID09PSBcIlNvdXRoXCIpIHtcblx0XHRcdFx0XHRcdC8vIFx0XHRzaGlwLnogKz0gT1BUSU9OLkdyaWRTY2FsZTtcblx0XHRcdFx0XHRcdC8vIFx0fVxuXHRcdFx0XHRcdFx0Ly8gXHRlbHNlIGlmIChhLmRpcmVjdGlvbiA9PT0gXCJXZXN0XCIpIHtcblx0XHRcdFx0XHRcdC8vIFx0XHRpZiAoc2hpcC54ID4gMClcblx0XHRcdFx0XHRcdC8vIFx0XHRcdHNoaXAueCAtPSBPUFRJT04uR3JpZFNjYWxlO1xuXHRcdFx0XHRcdFx0Ly8gXHR9XG5cdFx0XHRcdFx0XHQvLyBcdGVsc2UgaWYgKGEuZGlyZWN0aW9uID09PSBcIkVhc3RcIikge1xuXHRcdFx0XHRcdFx0Ly8gXHRcdHNoaXAueCArPSBPUFRJT04uR3JpZFNjYWxlO1xuXHRcdFx0XHRcdFx0Ly8gXHR9XG5cdFx0XHRcdFx0XHQvLyB9KTtcblxuXHRcdFx0XHRcdFx0Ly8gc2hvcnRjdXQsIHVwZGF0ZSBzdGF0ZSBmcm9tIHRoZSByZXN1bHQgb2YgdGhlIGxhc3QgYWN0aW9uIGxpc3Rcblx0XHRcdFx0XHRcdGxldCBsYXN0ID0gYWN0aW9uLmFjdGlvbnNbYWN0aW9uLmFjdGlvbnMubGVuZ3RoLTFdO1xuXHRcdFx0XHRcdFx0c2hpcC56ID0gbGFzdC56O1xuXHRcdFx0XHRcdFx0c2hpcC54ID0gbGFzdC54O1xuXHRcdFx0XHRcdFx0cmV0dXJuIHNoaXA7XG5cdFx0XHRcdFx0Y2FzZSAnU3Vuayc6XG5cdFx0XHRcdFx0XHRzaGlwLnN1bmsgPSB0cnVlO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHNoaXA7XG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdHJldHVybiBzaGlwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHNoaXA7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHN0cnVjdHVyZTtcblx0fVxuXG5cdGZ1bmN0aW9uIHByZXByb2Nlc3MoZGF0YSwgT1BUSU9OKSB7XG5cdFx0bGV0IHJlc3VsdCA9IHt9O1xuXHRcdGNvbnNvbGUubG9nKFwicHJlcHJvY2VzcygpIFwiLCBkYXRhKTtcblxuXHRcdC8vIGRlZmluZXMgdGhlIG9jZWFuL21hcCBjb25maWd1cmF0aW9uXG5cdFx0cmVzdWx0Lm1hcCA9IHtcblx0XHRcdHg6ICgoT1BUSU9OLkdyaWRTY2FsZSpNYXRoLmZsb29yKGRhdGEub2NlYW4ueC8yKSktMiksXG5cdFx0XHR5OiBPUFRJT04uT2NlYW5ZT2Zmc2V0LCBcblx0XHRcdHo6ICgoT1BUSU9OLkdyaWRTY2FsZSpNYXRoLmZsb29yKGRhdGEub2NlYW4ueS8yKSkpLFxuXHRcdFx0d2lkdGg6IDIwMCwgXG5cdFx0XHRkZXB0aDogMjAwLFxuXHRcdFx0ZGVuc2l0eTogMTIwXG5cdFx0fVxuXG5cdFx0Ly8gc2NhbGUgdXAgc2hpcCdzIGluaXRpYWwgbG9jYXRpb25zXG5cdFx0cmVzdWx0LnNoaXBzID0gdHJhbnNmb3JtKGRhdGEuc2hpcHMsIE9QVElPTi5HcmlkU2NhbGUpO1xuXG5cdFx0Ly8gYWRkIHN1bmsgcHJvcGVydHkgaW50byB0aGUgaW5pdGlhbCBzdGF0ZSBvZiB0aGUgc2hpcHNcblx0XHRyZXN1bHQuc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuXHRcdFx0c2hpcC5zdW5rID0gZmFsc2U7XG5cdFx0fSk7XG5cblx0XHQvLyBzY2FsZSB1cCBjb29yZGluYXRlcyBpbiB0aGUgYWN0aW9uIGxpc3QsIHRoZW4gY2FsbCB0aGUgYWN0aW9uQ2hhaW4gdG8gZ3JvdXAgc2VxdWVuY2VzIG9mIGFjdGlvbiBpbnRvIGEgdW5pdFxuXHRcdHJlc3VsdC50dXJucyA9IGFjdGlvbkNoYWluKCB0cmFuc2Zvcm0oZGF0YS50dXJucywgT1BUSU9OLkdyaWRTY2FsZSwgT1BUSU9OKSApO1xuXHRcdHJlc3VsdC50dXJucy5wdXNoKHt0eXBlOiAnRU5EJywgYWN0aW9uczogdW5kZWZpbmVkfSk7IC8vIGFkZCBlbmQgb2Ygc2ltdWxhdGlvbiBtYXJrZXJcblxuXHRcdGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cblx0XHRyZXN1bHQuc25hcHNob3RzID0ge1xuXHRcdFx0cGFzdDogW10sXG5cdFx0XHRwcmVzZW50OiB7fSxcblx0XHRcdGZ1dHVyZTogW11cblx0XHR9O1xuXG5cdFx0Y29uc29sZS5sb2coJ2luaXQgc3RhdGVzOiAnLCByZXN1bHQuc2hpcHMpO1xuXG5cdFx0bGV0IGN1cnJlbnRTdGF0ZSA9IHtzdGF0ZXM6IHJlc3VsdC5zaGlwcywgbmV4dDogcmVzdXRsLnR1cm5zWzBdfTtcblx0XHRyZXN1bHQudHVybnMuZm9yRWFjaCgodHVybikgPT4ge1xuXHRcdFx0cmVzdWx0LnNuYXBzaG90cy5mdXR1cmUuYXBwZW5kKGN1cnJlbnRTdGF0ZSk7XG5cdFx0XHRjdXJyZW50U3RhdGUgPSByZWR1Y2VyKGN1cnJlbnRTdGF0ZSwgdHVybiwgT1BUSU9OKTtcblx0XHR9KTtcblx0XHQvLyByZXN1bHQuc25hcHNob3RzLmZ1dHVyZS5yZXZlcnNlKCk7XG5cdFx0cmVzdWx0LnNuYXBzaG90cy5wcmVzZW50ID0gcmVzdWx0LnNuYXBzaG90cy5mdXR1cmUucG9wKDApO1xuXG5cdFx0Y29uc29sZS5sb2cocmVzdWx0KTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9XG5cblx0ZnVuY3Rpb24gcmVuZGVyKGRhdGEsIE9QVElPTikge1xuXHRcdGxldCBodG1sRWxlbWVudCA9IHt9O1xuXHRcdGxldCBkb2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NlbmUnKTsgLy8gPGEtc2NlbmU+IHJlZmVyZW5jZVxuXG5cdFx0Ly8gcmVwb3NpdGlvbiBjYW1lcmEgLSBjYW1lcmEgbXVzdCBiZSBhbHJlYWR5IHByZXNlbnQgd2hlbiBodG1sIGxvYWRzXG5cdFx0bGV0IGNhbWVyYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW1lcmEnKTtcblx0XHQvL2NhbWVyYS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgZGF0YS5vY2Vhbi54ICsgXCIgXCIgKyBkYXRhLm9jZWFuLnkgKyBcIiBcIiArIGRhdGEub2NlYW4ueik7XG5cdFx0Y2FtZXJhLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBkYXRhLm1hcC54ICsgXCIgXCIgKyBkYXRhLm1hcC55ICsgXCIgXCIgKyAoZGF0YS5tYXAueisoMS41KmRhdGEubWFwLngpKSk7XG5cdFx0Y2FtZXJhLnNldEF0dHJpYnV0ZSgnY2FtZXJhJywgJ3VzZXJIZWlnaHQ6ICcgKyBPUFRJT04uQ2FtZXJhWU9mZnNldCk7XG5cdFx0Y2FtZXJhLnNldEF0dHJpYnV0ZSgncm90YXRpb24nLCAtTWF0aC5hdGFuKE9QVElPTi5DYW1lcmFZT2Zmc2V0LyhkYXRhLm1hcC56K2RhdGEubWFwLngpKSk7XG5cblx0XHQvLyBHZW5lcmF0ZSBNYXBcblx0XHQvLyBUT0RPOiBQb3NzaWJsZSBlZGdlIGNhc2VzIHdpdGggdGhlIG1hcCBlZGdlIG5vdCBiZWluZyBiaWcgZW5vdWdoXG5cdFx0bGV0IG1hcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Etb2NlYW4nKTtcblx0XHRtYXAuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGRhdGEubWFwLnggKyBcIiBcIiArIGRhdGEubWFwLnkgKyBcIiBcIiArIGRhdGEubWFwLnopO1xuXHRcdG1hcC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgU3RyaW5nKGRhdGEubWFwLndpZHRoKSk7XG5cdFx0bWFwLnNldEF0dHJpYnV0ZSgnZGVwdGgnLCBTdHJpbmcoZGF0YS5tYXAuZGVwdGgpKTtcblx0XHRtYXAuc2V0QXR0cmlidXRlKCdkZW5zaXR5JywgU3RyaW5nKGRhdGEubWFwLmRlbnNpdHkpKTtcblx0XHRkb2MuYXBwZW5kQ2hpbGQobWFwKTtcblxuXHRcdC8vIFNwYXduIFNoaXBzXG5cdFx0ZGF0YS5zaGlwcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuXHRcdFx0aHRtbEVsZW1lbnRbZW50cnkuaWRdID0gYmF0dGxlc2hpcC5yZW5kZXIoZW50cnkpO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gaW5pdFNjZW5lKGlucHV0cykge1xuXHRcdGxldCBkb2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NlbmUnKTtcblx0XHRsZXQgdHJhY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWN1cnZlJyk7XG5cdFx0dHJhY2suc2V0QXR0cmlidXRlKCdpZCcsICd0cmFjaycpO1xuXHRcdHRyYWNrLnNldEF0dHJpYnV0ZSgndHlwZScsICdMaW5lJyk7XG5cdFx0ZG9jLmFwcGVuZENoaWxkKHRyYWNrKTtcblxuXHRcdGNvbnNvbGUubG9nKFwiaW5pdFNjZW5lKCkgXCIsIGlucHV0cyk7XG5cdFx0bGV0IGRhdGEgPSBwcmVwcm9jZXNzKGlucHV0cywgQ29uc3RhbnRzKTtcblxuXHRcdGxldCBodG1sRWxlbWVudHMgPSByZW5kZXIoZGF0YSwgQ29uc3RhbnRzKTtcblx0XHRjb25zb2xlLmxvZyhkYXRhKTtcblxuXHRcdGxldCBzbGlkZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzbGlkZXInKTtcblx0XHRzbGlkZS5zZXRBdHRyaWJ1dGUoJ21pbicsIDApO1xuXHRcdHNsaWRlLnNldEF0dHJpYnV0ZSgnbWF4JywgZGF0YS5zbmFwc2hvdHMuZnV0dXJlLmxlbmd0aCk7XG5cdFx0c2xpZGUudmFsdWUgPSAwO1xuXG5cdFx0bGV0IG1vZGVsID0ge1xuXHRcdFx0aHRtbDogaHRtbEVsZW1lbnRzLFxuXHRcdFx0c25hcHNob3RzOmRhdGEuc25hcHNob3RzXG5cdFx0fTtcblx0XHR0ZXN0ID0gbW9kZWw7XG5cblx0XHQvLyBiZWdpbiBzaW11bGF0aW9uXG5cdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRzaW11bGF0ZShtb2RlbCwgQ29uc3RhbnRzKTtcblx0XHR9LCAxMDAwMClcblx0fVxuXG5cdGZ1bmN0aW9uIHNpbXVsYXRlKCkge1xuXHRcdC8vY29uc29sZS5sb2coXCJjaGFpbjogXCIsIG1fY2hhaW4pO1xuXHRcdHZhciBub3RTdG9wID0gdHJ1ZTtcblx0XHRpZiAobV9jaGFpbi5sZW5ndGggPT0gMCkge1xuXHRcdFx0bm90U3RvcCA9IGZhbHNlO1xuXHRcdH1cblx0XHR2YXIgY3VycmVudCA9IG1fY2hhaW4uc2hpZnQoKTsgLy8gZG9uJ3Qgc2hpZnQgd2hlbiBsZW5ndGggaXMgemVyb1xuXHRcdGlmIChjdXJyZW50ICYmIG5vdFN0b3ApIHtcblx0XHRcdC8vY29uc29sZS5sb2coXCJjdXJyZW50OiBcIiwgY3VycmVudCk7XG5cdFx0XHRzd2l0Y2goY3VycmVudC50eXBlKSB7XG5cdFx0XHRcdGNhc2UgXCJNT1ZFXCI6XG5cdFx0XHRcdFx0YmF0dGxlc2hpcC5tb3ZlU2hpcChjdXJyZW50LmFjdGlvbnMpLnRoZW4oKGRvbmUpID0+IHtcblx0XHRcdFx0XHRcdC8vYWxlcnQoXCJNb3ZlZCBcIiArIG1fY2hhaW4ubGVuZ3RoICsgXCIgYWN0aW9ucyBsZWZ0XCIpO1xuXHRcdFx0XHRcdFx0c2ltdWxhdGUoKTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJGSVJFXCI6XG5cdFx0XHRcdFx0LyoqKiBFeGNsdXNpdmUgT3IgZnVuY3Rpb25zICoqKi9cblxuXHRcdFx0XHRcdC8qIEZpcmUgd2l0aG91dCBhaW1pbmcgKi9cblx0XHRcdFx0XHRiYXR0bGVzaGlwLmZpcmVTaGlwKGN1cnJlbnQuYWN0aW9ucykudGhlbigoZG9uZSkgPT4ge1xuXHRcdFx0XHRcdFx0c2ltdWxhdGUoKTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFwiZXJyb3I6IFwiLCBlcnIpO1x0XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHQvLyAvKiBBaW0gdGhlbiBmaXJlIChjdXJyZW50bHkgYnVnZ3kpKi9cblx0XHRcdFx0XHQvLyBiYXR0bGVzaGlwLmFpbVNoaXAoY3VycmVudC5hY3Rpb25zKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0Ly8gXHRiYXR0bGVzaGlwLmZpcmVTaGlwKGN1cnJlbnQuYWN0aW9ucykudGhlbigoZG9uZSkgPT4ge1xuXHRcdFx0XHRcdC8vIFx0XHRzaW11bGF0ZSgpO1xuXHRcdFx0XHRcdC8vIFx0fSkuY2F0Y2goKGVycikgPT4ge1xuXHRcdFx0XHRcdC8vIFx0XHRjb25zb2xlLmVycm9yKFwiZXJyb3I6IFwiLCBlcnIpO1x0XG5cdFx0XHRcdFx0Ly8gXHR9KTtcblx0XHRcdFx0XHQvLyB9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0Ly8gXHRjb25zb2xlLmVycm9yKFwiZXJyb3I6IFwiLCBlcnIpO1xuXHRcdFx0XHRcdC8vIH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiSElUXCI6XG5cdFx0XHRcdFx0YmF0dGxlc2hpcC5oaXRTaGlwKGN1cnJlbnQuYWN0aW9ucykudGhlbigoZG9uZSkgPT4ge1xuXHRcdFx0XHRcdFx0c2ltdWxhdGUoKTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhlcnIpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiU0lOS1wiOlxuXHRcdFx0XHRcdGJhdHRsZXNoaXAuc2lua1NoaXAoY3VycmVudC5hY3Rpb25zKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHQvL2FsZXJ0KFwiU3VuayBcIisgbV9jaGFpbi5sZW5ndGggKyBcIiBhY3Rpb25zIGxlZnRcIik7XG5cdFx0XHRcdFx0XHRzaW11bGF0ZSgpO1xuXHRcdFx0XHRcdH0pLmNhdGNoKChlcnIpID0+IHtcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oYFVua25vd24gQWN0aW9uIHR5cGUgJHtjdXJyZW50LnR5cGV9IGluIHNpbXVsYXRlIGZ1bmN0aW9uLCBza2lwcGluZy5gKTtcblx0XHRcdFx0XHRzaW11bGF0ZSgpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0Ly9hbGVydChcIlNpbXVsYXRpb24gRG9uZVwiKTtcblx0XHRcdFx0dmV4LmRpYWxvZy5hbGVydChcIlNpbXVsYXRpb24gQ29tcGxldGVkLlwiKTtcblx0XHRcdH0sIDEwMDApO1xuXHRcdH1cblx0fVxuXG5cdC8vIHB1YmxpY1xuXHR2YXIgYXBwID0ge1xuXG5cdFx0aW5pdDogKCkgPT4ge1xuXHRcdFx0bGV0IGlucHV0cyA9IHt9O1xuXHRcdFx0bGV0IGNvZGUgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2NvZGUnKTtcblxuXHRcdFx0aWYgKGNvZGUpIHtcblx0XHRcdFx0bGV0IHJlZiA9IGRhdGFiYXNlLnJlZignZGF2eS1qb25lcy1sb2NrZXInKS5jaGlsZChjb2RlKTtcblx0XHRcdFx0cmVmLm9uY2UoJ3ZhbHVlJywgKHJlcykgPT4ge1xuXHRcdFx0XHRcdGlucHV0cyA9IHtcblx0XHRcdFx0XHRcdFwiaWRzXCI6IHJlcy52YWwoKS5pbml0LnNoaXBzLm1hcCgocykgPT4geyByZXR1cm4gcy5pZCB9KSxcblx0XHRcdFx0XHRcdFwic2hpcHNcIjogcmVzLnZhbCgpLmluaXQuc2hpcHMsXG5cdFx0XHRcdFx0XHRcInR1cm5zXCI6IHJlcy52YWwoKS50dXJucyxcblx0XHRcdFx0XHRcdFwib2NlYW5cIjogcmVzLnZhbCgpLmluaXQubWFwXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fSwgKGVycikgPT4geyBcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oYFVua25vd24gVVJMIENvZGUgJHtjb2RlfSwgdXNpbmcgZGVmYXVsdCBvZmZsaW5lIGlucHV0YCk7XG5cdFx0XHRcdFx0aW5wdXRzID0ge1xuXHRcdFx0XHRcdFx0XCJpZHNcIjogaW5wdXQuaW5pdC5zaGlwcy5tYXAoKHMpID0+IHsgcmV0dXJuIHMuaWQgfSksXG5cdFx0XHRcdFx0XHRcInNoaXBzXCI6IGlucHV0LmluaXQuc2hpcHMsIFxuXHRcdFx0XHRcdFx0XCJ0dXJuc1wiOiBpbnB1dC50dXJucywgXG5cdFx0XHRcdFx0XHRcIm9jZWFuXCI6IGlucHV0LmluaXQubWFwXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fSlcblx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdGNvbnNvbGUubG9nKFwiaW5pdCgpIFwiLCBpbnB1dHMpO1xuXHRcdFx0XHRcdGluaXRTY2VuZShpbnB1dHMpO1xuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdNaXNzaW5nIFVSTCBwYXJhbWV0ZXIgY29kZSwgdXNpbmcgZGVmYXVsdCBvZmZsaW5lIGlucHV0Jyk7XG5cdFx0XHRcdGlucHV0cyA9IHtcblx0XHRcdFx0XHRcImlkc1wiOiBpbnB1dC5pbml0LnNoaXBzLm1hcCgocykgPT4geyByZXR1cm4gcy5pZCB9KSxcblx0XHRcdFx0XHRcInNoaXBzXCI6IGlucHV0LmluaXQuc2hpcHMsIFxuXHRcdFx0XHRcdFwidHVybnNcIjogaW5wdXQudHVybnMsIFxuXHRcdFx0XHRcdFwib2NlYW5cIjogaW5wdXQuaW5pdC5tYXBcblx0XHRcdFx0fVxuXHRcdFx0XHRjb25zb2xlLmxvZyhcImluaXQoKSBcIiwgaW5wdXRzKTtcblx0XHRcdFx0aW5pdFNjZW5lKGlucHV0cyk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXG5cdHJldHVybiBhcHA7XG59XG5cbmxldCBhcHAgPSBTaW11bGF0aW9uKCk7XG5hcHAuaW5pdCgpO1xuXG4vL2xldCBwYXJhbXMgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoKTtcblxuLy8gbGV0IGdldERhdGFGcm9tQ29kZSA9IChjb2RlKSA9PiB7XG4vLyBcdGRhdGFiYXNlLnJlZignZGF2eS1qb25lcy1sb2NrZXIvJyArIGNvZGUpLm9uY2UoJ3ZhbHVlJywgKHNuYXBzaG90KSA9PiB7XG4vLyBcdFx0dmFyIGdhbWVEYXRhID0gc25hcHNob3QudmFsKCk7XG4vLyBcdFx0aWYgKGdhbWVEYXRhKSB7XG4vLyBcdFx0XHRpbnB1dCA9IGdhbWVEYXRhO1xuLy8gXHRcdFx0YXBwLmluaXQoKTtcbi8vIFx0XHR9IGVsc2Uge1xuLy8gXHRcdFx0Z2V0Q29kZShgTm8gZGF0YSBmb3IgY29kZSAke2NvZGV9LiBFbnRlciBhbm90aGVyIGNvZGU6YCk7XG4vLyBcdFx0XHQvL2FwcC5pbml0KCk7XG4vLyBcdFx0fVxuLy8gXHR9KS5jYXRjaCgoZXJyKSA9PiB7XG4vLyBcdFx0Z2V0Q29kZShgVGhlcmUgd2FzIGFuIGVycm9yLiBFbnRlciBhbm90aGVyIGNvZGU6YCk7XG4vLyBcdFx0Ly9hcHAuaW5pdCgpO1xuLy8gXHR9KTtcbi8vIH1cblxuLy8gbGV0IGdldENvZGUgPSAobWVzc2FnZSkgPT4ge1xuLy8gXHR2ZXguZGlhbG9nLnByb21wdCh7XG4vLyBcdFx0bWVzc2FnZTogbWVzc2FnZSxcbi8vIFx0XHRjYWxsYmFjazogKHZhbHVlKSA9PiB7XG4vLyBcdFx0XHRpZiAodmFsdWUpIHtcbi8vIFx0XHRcdFx0dmFyIGNvZGUgPSB2YWx1ZTtcbi8vIFx0XHRcdFx0Z2V0RGF0YUZyb21Db2RlKGNvZGUpO1xuLy8gXHRcdFx0fSBlbHNlIHtcbi8vIFx0XHRcdFx0Z2V0Q29kZShcIk5vIGNvZGUgZW50ZXJlZC4gRW50ZXIgeW91ciBjb2RlOlwiKTtcbi8vIFx0XHRcdH1cbi8vIFx0XHR9XG4vLyBcdH0pO1xuLy8gfVxuXG4vLyBpZiAocGFyYW1zLmNvZGUpIHtcbi8vIFx0Z2V0RGF0YUZyb21Db2RlKHBhcmFtcy5jb2RlKTtcbi8vIH0gZWxzZSB7XG4vLyBcdGdldENvZGUoXCJFbnRlciBZb3VyIENvZGVcIik7XG4vLyB9XG5cblxuLy8gdmFyIEJBVFRMRV9TRVJWRVJfVVJMID0gJ2h0dHBzOi8vYmF0dGxlc2hpcC12aW5na2FuLmM5dXNlcnMuaW8vMXYxP3AxPWVzaTE3LmNzLkRlc3Ryb3llclNoaXAmcDI9ZXNpMTcuaGxpMTA5LkZsb2F0ZXInOy8vICsgTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkgKiAxMDApO1xuXG4vLyAkLmdldChCQVRUTEVfU0VSVkVSX1VSTCkudGhlbihkYXRhID0+IHtcbi8vIFx0aW5wdXQgPSBkYXRhO1xuLy8gXHRhcHAuaW5pdCgpO1xuLy8gfSkuZG9uZSgoKSA9PiB7XG4vLyBcdGNvbnNvbGUubG9nKFwiRGF0YSBzdWNjZXNzZnVsbHkgcmV0cmlldmVkIGZyb20gc2VydmVyXCIpO1xuLy8gfSkuZmFpbCgoKSA9PiB7XG4vLyBcdGNvbnNvbGUubG9nKFwiVW5hYmxlIHRvIHJldHJpZXZlIGRhdGEsIHN0YXJ0aW5nIHdpdGggbG9jYWwgZGF0YVwiKTtcbi8vIFx0YXBwLmluaXQoKTtcbi8vIH0pO1xuXG5cblxuIl19\n"]}