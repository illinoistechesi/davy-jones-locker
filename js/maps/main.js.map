{"version":3,"sources":["main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","Simulation","transform","data","scale","OPTION","console","log","map","entry","hasOwnProperty","atX","atZ","atY","ShipYOffset","x","z","y","preprocess","result","GridScale","Math","floor","ocean","OceanYOffset","width","depth","density","ships","forEach","ship","sunk","turns","last","actions","id","type","push","actionChain","undefined","snapshots","past","present","future","currentState","states","next","turn","unshift","tree","action","structure","reducer","pop","initScene","inputs","doc","document","getElementById","track","createElement","setAttribute","appendChild","Constants","htmlElements","htmlElement","camera","CameraYOffset","atan","String","battleship","render","slide","value","model","html","test","setTimeout","simulate","isDone","current","moveShip","then","done","catch","err","error","fireShip","sinkShip","alert","OceanPadding","SinkDistance","BulletArc","WaitTimePerTileMoved","WaitTimeBetweenAction","init","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","getParameterByName","database","ref","child","once","res","ids","val","warn","input","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","Ship"],"mappings":"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","file":"../main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\n// Initialize Firebase\nvar config = {\n\tapiKey: \"AIzaSyA9EYUXVL5WAh6Aam1qXlWyvi3b7HLcZ1U\",\n\tauthDomain: \"esigamma.firebaseapp.com\",\n\tdatabaseURL: \"https://esigamma.firebaseio.com\",\n\tprojectId: \"esigamma\",\n\tstorageBucket: \"esigamma.appspot.com\",\n\tmessagingSenderId: \"734163636039\"\n};\nfirebase.initializeApp(config);\n\nvar database = firebase.database();\nvar battleship = Ship();\n\nvar test = void 0;\n\nfunction getParameterByName(name, url) {\n\tif (!url) url = window.location.href;\n\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n\tvar results = regex.exec(url);\n\tif (!results) return null;\n\tif (!results[2]) return '';\n\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nfunction Simulation() {\n\n\t// private\n\tvar Constants = {\n\t\tGridScale: 4,\n\t\tCameraYOffset: 15,\n\t\tOceanYOffset: 0,\n\t\tOceanPadding: 10,\n\t\tShipYOffset: 0,\n\t\tSinkDistance: 5,\n\t\tBulletArc: 2,\n\t\tWaitTimePerTileMoved: 300,\n\t\tWaitTimeBetweenAction: 50 // in miliseconds\n\t};\n\n\tvar m_input = {};\n\n\tvar m_ships = []; // stores formatted json of ship initialization\n\tvar m_chain = []; // stores chainable actions in a turn\n\tvar m_entity = {}; // object with id to html dom element of ships\n\n\tvar m_test = 0;\n\n\tvar m_ocean = void 0;\n\n\tfunction transform(data, scale, OPTION) {\n\t\tconsole.log(\"transform() \", data);\n\t\tvar result = data.map(function (entry) {\n\t\t\tif (entry.hasOwnProperty(\"atX\") && entry.hasOwnProperty(\"atY\")) {\n\t\t\t\tentry.atX = scale * entry.atX;\n\t\t\t\tentry.atZ = scale * entry.atY; // 3D uses the xz plane as part of the ground\n\t\t\t\tentry.atY = OPTION.ShipYOffset; // vertical offset with respect to the ground and user in VR mode\n\t\t\t}\n\t\t\tentry.x = scale * entry.x;\n\t\t\tentry.z = scale * entry.y; // 3D uses the xz plane as part of the ground\n\t\t\tentry.y = OPTION.ShipYOffset;\n\t\t\treturn entry;\n\t\t});\n\t\treturn result;\n\t};\n\n\tfunction reducer(tree, action, OPTION) {\n\t\tconsole.log(tree);\n\t\tvar structure = {\n\t\t\tstates: tree.states,\n\t\t\tnext: action\n\t\t};\n\n\t\tstructure.states = tree.states.map(function (ship) {\n\t\t\tif (action.id === ship.id) {\n\t\t\t\tswitch (action.type) {\n\t\t\t\t\tcase 'MOVE':\n\t\t\t\t\t\t// iterate over all the chained actions and apply it the the state\n\t\t\t\t\t\t// function would need to check validity in movement, which not checked in the data\n\t\t\t\t\t\t// action.actions.forEach((a) => {\n\t\t\t\t\t\t// \tif (a.direction === \"North\") {\n\t\t\t\t\t\t// \t\tif (ship.z > 0)\n\t\t\t\t\t\t// \t\t\tship.z -= OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"South\") {\n\t\t\t\t\t\t// \t\tship.z += OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"West\") {\n\t\t\t\t\t\t// \t\tif (ship.x > 0)\n\t\t\t\t\t\t// \t\t\tship.x -= OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// \telse if (a.direction === \"East\") {\n\t\t\t\t\t\t// \t\tship.x += OPTION.GridScale;\n\t\t\t\t\t\t// \t}\n\t\t\t\t\t\t// });\n\n\t\t\t\t\t\t// shortcut, update state from the result of the last action list\n\t\t\t\t\t\tvar last = action.actions[action.actions.length - 1];\n\t\t\t\t\t\tship.z = last.z;\n\t\t\t\t\t\tship.x = last.x;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tcase 'Sunk':\n\t\t\t\t\t\tship.sunk = true;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn ship;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn ship;\n\t\t\t}\n\t\t});\n\t\treturn structure;\n\t}\n\n\t// Map a sequence of actions that are considered atomic into a chain-able list of actions for smooth animation and movements \n\tfunction actionChain(data) {\n\t\tvar result = [];\n\t\tdata.map(function (entry) {\n\t\t\tif (result && result.length > 0) {\n\t\t\t\t// result[i] will always have at least one item in its action attribute list\n\t\t\t\tvar last = result[result.length - 1].actions;\n\t\t\t\t// action can be chained if they are of the same type from the same ship id\n\t\t\t\t// console.log(\"Comparing: \", result[result.length-1], last, entry);\n\t\t\t\tif (last[0].id === entry.id && last[0].type === entry.type && (last[0].type === \"MOVE\" || last[0].type === \"FIRE\" && last[0].atX === entry.atX && last[0].atY === entry.atY)) {\n\t\t\t\t\t// Movement can be chained and firing at the same location can be chained\n\t\t\t\t\tlast.push(entry);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push({\n\t\t\t\t\t\ttype: entry.type,\n\t\t\t\t\t\tactions: [entry]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// if result is empty, initial case\n\t\t\t\tresult.push({\n\t\t\t\t\ttype: entry.type,\n\t\t\t\t\tactions: [entry]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tconsole.log(result);\n\t\treturn result;\n\t}\n\n\tfunction preprocess(data, OPTION) {\n\t\tvar result = {};\n\t\tconsole.log(\"preprocess() \", data, OPTION);\n\n\t\t// defines the ocean/map configuration\n\t\tresult.map = {\n\t\t\tx: OPTION.GridScale * Math.floor(data.ocean.x / 2) - 2,\n\t\t\ty: OPTION.OceanYOffset,\n\t\t\tz: OPTION.GridScale * Math.floor(data.ocean.y / 2),\n\t\t\twidth: 200,\n\t\t\tdepth: 200,\n\t\t\tdensity: 120\n\n\t\t\t// scale up ship's initial locations\n\t\t};result.ships = transform(data.ships, OPTION.GridScale, OPTION);\n\n\t\t// add sunk property into the initial state of the ships\n\t\tresult.ships.forEach(function (ship) {\n\t\t\tship.sunk = false;\n\t\t});\n\n\t\t// scale up coordinates in the action list, then call the actionChain to group sequences of action into a unit\n\t\tresult.turns = actionChain(transform(data.turns, OPTION.GridScale, OPTION));\n\t\tresult.turns.push({ type: 'END', actions: undefined }); // add end of simulation marker\n\n\t\tconsole.log(result);\n\n\t\tresult.snapshots = {\n\t\t\tpast: [],\n\t\t\tpresent: {},\n\t\t\tfuture: []\n\t\t};\n\n\t\tconsole.log('init states: ', result.ships);\n\n\t\tvar currentState = { states: result.ships, next: result.turns[0] };\n\t\tresult.turns.forEach(function (turn) {\n\t\t\tresult.snapshots.future.unshift(currentState);\n\t\t\tcurrentState = reducer(currentState, turn, OPTION);\n\t\t});\n\t\t// result.snapshots.future.reverse();\n\t\tresult.snapshots.present = result.snapshots.future.pop(0);\n\n\t\tconsole.log(result);\n\t\treturn result;\n\t}\n\n\tfunction render(data, OPTION) {\n\t\tvar htmlElement = {};\n\t\tvar doc = document.getElementById('scene'); // <a-scene> reference\n\n\t\t// reposition camera - camera must be already present when html loads\n\t\tvar camera = document.getElementById('camera');\n\t\t//camera.setAttribute('position', data.ocean.x + \" \" + data.ocean.y + \" \" + data.ocean.z);\n\t\tcamera.setAttribute('position', data.map.x + \" \" + data.map.y + \" \" + (data.map.z + 1.5 * data.map.x));\n\t\tcamera.setAttribute('camera', 'userHeight: ' + OPTION.CameraYOffset);\n\t\tcamera.setAttribute('rotation', -Math.atan(OPTION.CameraYOffset / (data.map.z + data.map.x)));\n\n\t\t// Generate Map\n\t\t// TODO: Possible edge cases with the map edge not being big enough\n\t\tvar map = document.createElement('a-ocean');\n\t\tmap.setAttribute('position', data.map.x + \" \" + data.map.y + \" \" + data.map.z);\n\t\tmap.setAttribute('width', String(data.map.width));\n\t\tmap.setAttribute('depth', String(data.map.depth));\n\t\tmap.setAttribute('density', String(data.map.density));\n\t\tdoc.appendChild(map);\n\n\t\t// Spawn Ships\n\t\tdata.ships.forEach(function (entry) {\n\t\t\thtmlElement[entry.id] = battleship.render(entry);\n\t\t});\n\n\t\treturn htmlElement;\n\t}\n\n\tfunction initScene(inputs) {\n\t\tvar doc = document.getElementById('scene');\n\t\tvar track = document.createElement('a-curve');\n\t\ttrack.setAttribute('id', 'track');\n\t\ttrack.setAttribute('type', 'Line');\n\t\tdoc.appendChild(track);\n\n\t\tconsole.log(\"initScene() preprocess() \", inputs);\n\t\tvar data = preprocess(inputs, Constants);\n\n\t\tvar htmlElements = render(data, Constants);\n\t\tconsole.log(\"initScene() render() \", htmlElements);\n\n\t\tvar slide = document.getElementById('slider');\n\t\tslide.setAttribute('min', 0);\n\t\tslide.setAttribute('max', data.snapshots.future.length);\n\t\tslide.value = 0;\n\n\t\tvar model = {\n\t\t\thtml: htmlElements,\n\t\t\tsnapshots: data.snapshots\n\t\t};\n\t\ttest = model;\n\n\t\t// begin simulation\n\t\tsetTimeout(function () {\n\t\t\tsimulate(model, Constants);\n\t\t}, 1000);\n\t}\n\n\tfunction simulate(data, OPTION) {\n\t\tconsole.log(\"simulate: \", data);\n\t\tvar slider = document.getElementById(\"slider\");\n\t\tslider.value = data.snapshots.past.length;\n\t\t// app.interrupt().then((done) => {\n\t\t// \tconsole.log(done);\n\t\t// });\n\t\tvar isDone = false;\n\t\tif (data.snapshots.future.length == 0) {\n\t\t\tisDone = true;\n\t\t}\n\t\tvar current = data.snapshots.future.pop();\n\t\tvar model = data.html;\n\t\tif (current && !isDone) {\n\t\t\tconsole.log(\"current: \", current);\n\t\t\tswitch (current.next.type) {\n\t\t\t\tcase \"MOVE\":\n\t\t\t\t\tbattleship.moveShip(model, current.next.actions, OPTION).then(function (done) {\n\t\t\t\t\t\t//alert(\"Moved \" + data.turns.length + \" actions left\");\n\t\t\t\t\t\tdata.snapshots.past.push(data.snapshots.present);\n\t\t\t\t\t\tdata.snapshots.present = current;\n\t\t\t\t\t\t// app.interrupt().then((done) => {\n\t\t\t\t\t\tsimulate(data, OPTION);\n\t\t\t\t\t\t//app.interrupt(data, OPTION);\n\t\t\t\t\t\t// });\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"FIRE\":\n\t\t\t\t\tbattleship.fireShip(current.next.actions, OPTION).then(function (done) {\n\t\t\t\t\t\t//alert(\"Fired \" + data.turns.length + \" actions left\");\n\t\t\t\t\t\tdata.snapshots.past.push(data.snapshots.present);\n\t\t\t\t\t\tdata.snapshots.present = current;\n\t\t\t\t\t\t// app.interrupt().then((done) => {\n\t\t\t\t\t\tsimulate(data, OPTION);\n\t\t\t\t\t\t//app.interrupt(data, OPTION);\n\t\t\t\t\t\t// });\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"SINK\":\n\t\t\t\t\tbattleship.sinkShip({ html: data.html, present: current }, OPTION).then(function (done) {\n\t\t\t\t\t\t//alert(\"Sunk \"+ data.turns.length + \" actions left\");\n\t\t\t\t\t\tdata.snapshots.past.push(data.snapshots.present);\n\t\t\t\t\t\tdata.snapshots.present = current;\n\t\t\t\t\t\t// app.interrupt().then((done) => {\n\t\t\t\t\t\tsimulate(data, OPTION);\n\t\t\t\t\t\t//app.interrupt(data, OPTION);\n\t\t\t\t\t\t// });\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"HIT\":\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"END\":\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\talert(\"Simulation Done\");\n\t\t\t\t\t}, 10000);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log(\"Unknown Action Type \" + current.type + \" in simulate function, skipping.\");\n\t\t\t\t// comment below during development to catch bugs, production code should continue along with simulation\n\t\t\t\t//simulate(data, OPTION);\n\t\t\t}\n\t\t} else {\n\t\t\tsetTimeout(function () {\n\t\t\t\talert(\"Simulation Done\");\n\t\t\t}, 10000);\n\t\t}\n\t}\n\n\t// public\n\tvar app = {\n\n\t\tinit: function init() {\n\t\t\tvar inputs = {};\n\t\t\tvar code = getParameterByName('code');\n\n\t\t\tif (code) {\n\t\t\t\tvar ref = database.ref('davy-jones-locker').child(code);\n\t\t\t\tref.once('value', function (res) {\n\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\"ids\": res.val().init.ships.map(function (s) {\n\t\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"ships\": res.val().init.ships,\n\t\t\t\t\t\t\"turns\": res.val().turns,\n\t\t\t\t\t\t\"ocean\": res.val().init.map\n\t\t\t\t\t};\n\t\t\t\t}, function (err) {\n\t\t\t\t\tconsole.warn(\"Unknown URL Code \" + code + \", using default offline input\");\n\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\"ids\": input.init.ships.map(function (s) {\n\t\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"ships\": input.init.ships,\n\t\t\t\t\t\t\"turns\": input.turns,\n\t\t\t\t\t\t\"ocean\": input.init.map\n\t\t\t\t\t};\n\t\t\t\t}).then(function () {\n\t\t\t\t\tconsole.log(\"init() \", inputs);\n\t\t\t\t\tinitScene(inputs);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.log('Missing URL parameter code, using default offline input');\n\t\t\t\tinputs = {\n\t\t\t\t\t\"ids\": input.init.ships.map(function (s) {\n\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t}),\n\t\t\t\t\t\"ships\": input.init.ships,\n\t\t\t\t\t\"turns\": input.turns,\n\t\t\t\t\t\"ocean\": input.init.map\n\t\t\t\t};\n\t\t\t\tconsole.log(\"init() \", inputs);\n\t\t\t\tinitScene(inputs);\n\t\t\t}\n\t\t}\n\t};\n\n\treturn app;\n}\n\nvar app = Simulation();\napp.init();\n\n//let params = getParameterByName(document.location.search);\n\n// let getDataFromCode = (code) => {\n// \tdatabase.ref('davy-jones-locker/' + code).once('value', (snapshot) => {\n// \t\tvar gameData = snapshot.val();\n// \t\tif (gameData) {\n// \t\t\tinput = gameData;\n// \t\t\tapp.init();\n// \t\t} else {\n// \t\t\tgetCode(`No data for code ${code}. Enter another code:`);\n// \t\t\t//app.init();\n// \t\t}\n// \t}).catch((err) => {\n// \t\tgetCode(`There was an error. Enter another code:`);\n// \t\t//app.init();\n// \t});\n// }\n\n// let getCode = (message) => {\n// \tvex.dialog.prompt({\n// \t\tmessage: message,\n// \t\tcallback: (value) => {\n// \t\t\tif (value) {\n// \t\t\t\tvar code = value;\n// \t\t\t\tgetDataFromCode(code);\n// \t\t\t} else {\n// \t\t\t\tgetCode(\"No code entered. Enter your code:\");\n// \t\t\t}\n// \t\t}\n// \t});\n// }\n\n// if (params.code) {\n// \tgetDataFromCode(params.code);\n// } else {\n// \tgetCode(\"Enter Your Code\");\n// }\n\n\n// var BATTLE_SERVER_URL = 'https://battleship-vingkan.c9users.io/1v1?p1=esi17.cs.DestroyerShip&p2=esi17.hli109.Floater';// + Math.ceil(Math.random() * 100);\n\n// $.get(BATTLE_SERVER_URL).then(data => {\n// \tinput = data;\n// \tapp.init();\n// }).done(() => {\n// \tconsole.log(\"Data successfully retrieved from server\");\n// }).fail(() => {\n// \tconsole.log(\"Unable to retrieve data, starting with local data\");\n// \tapp.init();\n// });\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7QUFDQSxJQUFJLFNBQVM7QUFDWixTQUFRLHlDQURJO0FBRVosYUFBWSwwQkFGQTtBQUdaLGNBQWEsaUNBSEQ7QUFJWixZQUFXLFVBSkM7QUFLWixnQkFBZSxzQkFMSDtBQU1aLG9CQUFtQjtBQU5QLENBQWI7QUFRQSxTQUFTLGFBQVQsQ0FBdUIsTUFBdkI7O0FBRUEsSUFBSSxXQUFXLFNBQVMsUUFBVCxFQUFmO0FBQ0EsSUFBSSxhQUFhLE1BQWpCOztBQUVBLElBQUksYUFBSjs7QUFFQSxTQUFTLGtCQUFULENBQTRCLElBQTVCLEVBQWtDLEdBQWxDLEVBQXVDO0FBQ3RDLEtBQUksQ0FBQyxHQUFMLEVBQVUsTUFBTSxPQUFPLFFBQVAsQ0FBZ0IsSUFBdEI7QUFDVixRQUFPLEtBQUssT0FBTCxDQUFhLFNBQWIsRUFBd0IsTUFBeEIsQ0FBUDtBQUNBLEtBQUksUUFBUSxJQUFJLE1BQUosQ0FBVyxTQUFTLElBQVQsR0FBZ0IsbUJBQTNCLENBQVo7QUFDQSxLQUFJLFVBQVUsTUFBTSxJQUFOLENBQVcsR0FBWCxDQUFkO0FBQ0EsS0FBSSxDQUFDLE9BQUwsRUFBYyxPQUFPLElBQVA7QUFDZCxLQUFJLENBQUMsUUFBUSxDQUFSLENBQUwsRUFBaUIsT0FBTyxFQUFQO0FBQ2pCLFFBQU8sbUJBQW1CLFFBQVEsQ0FBUixFQUFXLE9BQVgsQ0FBbUIsS0FBbkIsRUFBMEIsR0FBMUIsQ0FBbkIsQ0FBUDtBQUNBOztBQUVELFNBQVMsVUFBVCxHQUFzQjs7QUFFckI7QUFDQSxLQUFJLFlBQVk7QUFDZixhQUFXLENBREk7QUFFZixpQkFBZSxFQUZBO0FBR2YsZ0JBQWMsQ0FIQztBQUlmLGdCQUFjLEVBSkM7QUFLZixlQUFhLENBTEU7QUFNZixnQkFBYyxDQU5DO0FBT2YsYUFBVyxDQVBJO0FBUWYsd0JBQXNCLEdBUlA7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Q0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gSW5pdGlhbGl6ZSBGaXJlYmFzZVxubGV0IGNvbmZpZyA9IHtcblx0YXBpS2V5OiBcIkFJemFTeUE5RVlVWFZMNVdBaDZBYW0xcVhsV3l2aTNiN0hMY1oxVVwiLFxuXHRhdXRoRG9tYWluOiBcImVzaWdhbW1hLmZpcmViYXNlYXBwLmNvbVwiLFxuXHRkYXRhYmFzZVVSTDogXCJodHRwczovL2VzaWdhbW1hLmZpcmViYXNlaW8uY29tXCIsXG5cdHByb2plY3RJZDogXCJlc2lnYW1tYVwiLFxuXHRzdG9yYWdlQnVja2V0OiBcImVzaWdhbW1hLmFwcHNwb3QuY29tXCIsXG5cdG1lc3NhZ2luZ1NlbmRlcklkOiBcIjczNDE2MzYzNjAzOVwiXG59O1xuZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChjb25maWcpO1xuXG5sZXQgZGF0YWJhc2UgPSBmaXJlYmFzZS5kYXRhYmFzZSgpO1xubGV0IGJhdHRsZXNoaXAgPSBTaGlwKCk7XG5cbmxldCB0ZXN0O1xuXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSwgdXJsKSB7XG5cdGlmICghdXJsKSB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcblx0bmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgXCJcXFxcJCZcIik7XG5cdGxldCByZWdleCA9IG5ldyBSZWdFeHAoXCJbPyZdXCIgKyBuYW1lICsgXCIoPShbXiYjXSopfCZ8I3wkKVwiKTtcblx0bGV0IHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG5cdGlmICghcmVzdWx0cykgcmV0dXJuIG51bGw7XG5cdGlmICghcmVzdWx0c1syXSkgcmV0dXJuICcnO1xuXHRyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csIFwiIFwiKSk7XG59XG5cbmZ1bmN0aW9uIFNpbXVsYXRpb24oKSB7XG5cdFxuXHQvLyBwcml2YXRlXG5cdGxldCBDb25zdGFudHMgPSB7XG5cdFx0R3JpZFNjYWxlOiA0LFxuXHRcdENhbWVyYVlPZmZzZXQ6IDE1LFxuXHRcdE9jZWFuWU9mZnNldDogMCxcblx0XHRPY2VhblBhZGRpbmc6IDEwLFxuXHRcdFNoaXBZT2Zmc2V0OiAwLFxuXHRcdFNpbmtEaXN0YW5jZTogNSxcblx0XHRCdWxsZXRBcmM6IDIsXG5cdFx0V2FpdFRpbWVQZXJUaWxlTW92ZWQ6IDMwMCxcblx0XHRXYWl0VGltZUJldHdlZW5BY3Rpb246IDUwIC8vIGluIG1pbGlzZWNvbmRzXG5cdH07XG5cblx0bGV0IG1faW5wdXQgPSB7fTtcblx0XG5cdGxldCBtX3NoaXBzID0gW107IC8vIHN0b3JlcyBmb3JtYXR0ZWQganNvbiBvZiBzaGlwIGluaXRpYWxpemF0aW9uXG5cdGxldCBtX2NoYWluID0gW107IC8vIHN0b3JlcyBjaGFpbmFibGUgYWN0aW9ucyBpbiBhIHR1cm5cblx0bGV0IG1fZW50aXR5ID0ge307IC8vIG9iamVjdCB3aXRoIGlkIHRvIGh0bWwgZG9tIGVsZW1lbnQgb2Ygc2hpcHNcblxuXHRsZXQgbV90ZXN0ID0gMDtcblxuXHRsZXQgbV9vY2VhbjsgXG5cblx0ZnVuY3Rpb24gdHJhbnNmb3JtKGRhdGEsIHNjYWxlLCBPUFRJT04pIHtcblx0XHRjb25zb2xlLmxvZyhcInRyYW5zZm9ybSgpIFwiLCBkYXRhKTtcblx0XHRsZXQgcmVzdWx0ID0gZGF0YS5tYXAoKGVudHJ5KSA9PiB7XG5cdFx0XHRpZiAoZW50cnkuaGFzT3duUHJvcGVydHkoXCJhdFhcIikgJiYgZW50cnkuaGFzT3duUHJvcGVydHkoXCJhdFlcIikpIHtcblx0XHRcdFx0ZW50cnkuYXRYID0gc2NhbGUgKiBlbnRyeS5hdFg7XG5cdFx0XHRcdGVudHJ5LmF0WiA9IHNjYWxlICogZW50cnkuYXRZOyAvLyAzRCB1c2VzIHRoZSB4eiBwbGFuZSBhcyBwYXJ0IG9mIHRoZSBncm91bmRcblx0XHRcdFx0ZW50cnkuYXRZID0gT1BUSU9OLlNoaXBZT2Zmc2V0OyAvLyB2ZXJ0aWNhbCBvZmZzZXQgd2l0aCByZXNwZWN0IHRvIHRoZSBncm91bmQgYW5kIHVzZXIgaW4gVlIgbW9kZVxuXHRcdFx0fVxuXHRcdFx0ZW50cnkueCA9IHNjYWxlICogZW50cnkueDtcblx0XHRcdGVudHJ5LnogPSBzY2FsZSAqIGVudHJ5Lnk7IC8vIDNEIHVzZXMgdGhlIHh6IHBsYW5lIGFzIHBhcnQgb2YgdGhlIGdyb3VuZFxuXHRcdFx0ZW50cnkueSA9IE9QVElPTi5TaGlwWU9mZnNldDtcblx0XHRcdHJldHVybiBlbnRyeTtcblx0XHR9KTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9O1xuXG5cdGZ1bmN0aW9uIHJlZHVjZXIodHJlZSwgYWN0aW9uLCBPUFRJT04pIHtcblx0XHRjb25zb2xlLmxvZyh0cmVlKTtcblx0XHRsZXQgc3RydWN0dXJlID0ge1xuXHRcdFx0c3RhdGVzOiB0cmVlLnN0YXRlcyxcblx0XHRcdG5leHQ6IGFjdGlvblxuXHRcdH07XG5cblx0XHRzdHJ1Y3R1cmUuc3RhdGVzID0gdHJlZS5zdGF0ZXMubWFwKChzaGlwKSA9PiB7XG5cdFx0XHRpZiAoYWN0aW9uLmlkID09PSBzaGlwLmlkKSB7XG5cdFx0XHRcdHN3aXRjaChhY3Rpb24udHlwZSkge1xuXHRcdFx0XHRcdGNhc2UgJ01PVkUnOlxuXHRcdFx0XHRcdFx0Ly8gaXRlcmF0ZSBvdmVyIGFsbCB0aGUgY2hhaW5lZCBhY3Rpb25zIGFuZCBhcHBseSBpdCB0aGUgdGhlIHN0YXRlXG5cdFx0XHRcdFx0XHQvLyBmdW5jdGlvbiB3b3VsZCBuZWVkIHRvIGNoZWNrIHZhbGlkaXR5IGluIG1vdmVtZW50LCB3aGljaCBub3QgY2hlY2tlZCBpbiB0aGUgZGF0YVxuXHRcdFx0XHRcdFx0Ly8gYWN0aW9uLmFjdGlvbnMuZm9yRWFjaCgoYSkgPT4ge1xuXHRcdFx0XHRcdFx0Ly8gXHRpZiAoYS5kaXJlY3Rpb24gPT09IFwiTm9ydGhcIikge1xuXHRcdFx0XHRcdFx0Ly8gXHRcdGlmIChzaGlwLnogPiAwKVxuXHRcdFx0XHRcdFx0Ly8gXHRcdFx0c2hpcC56IC09IE9QVElPTi5HcmlkU2NhbGU7XG5cdFx0XHRcdFx0XHQvLyBcdH1cblx0XHRcdFx0XHRcdC8vIFx0ZWxzZSBpZiAoYS5kaXJlY3Rpb24gPT09IFwiU291dGhcIikge1xuXHRcdFx0XHRcdFx0Ly8gXHRcdHNoaXAueiArPSBPUFRJT04uR3JpZFNjYWxlO1xuXHRcdFx0XHRcdFx0Ly8gXHR9XG5cdFx0XHRcdFx0XHQvLyBcdGVsc2UgaWYgKGEuZGlyZWN0aW9uID09PSBcIldlc3RcIikge1xuXHRcdFx0XHRcdFx0Ly8gXHRcdGlmIChzaGlwLnggPiAwKVxuXHRcdFx0XHRcdFx0Ly8gXHRcdFx0c2hpcC54IC09IE9QVElPTi5HcmlkU2NhbGU7XG5cdFx0XHRcdFx0XHQvLyBcdH1cblx0XHRcdFx0XHRcdC8vIFx0ZWxzZSBpZiAoYS5kaXJlY3Rpb24gPT09IFwiRWFzdFwiKSB7XG5cdFx0XHRcdFx0XHQvLyBcdFx0c2hpcC54ICs9IE9QVElPTi5HcmlkU2NhbGU7XG5cdFx0XHRcdFx0XHQvLyBcdH1cblx0XHRcdFx0XHRcdC8vIH0pO1xuXG5cdFx0XHRcdFx0XHQvLyBzaG9ydGN1dCwgdXBkYXRlIHN0YXRlIGZyb20gdGhlIHJlc3VsdCBvZiB0aGUgbGFzdCBhY3Rpb24gbGlzdFxuXHRcdFx0XHRcdFx0bGV0IGxhc3QgPSBhY3Rpb24uYWN0aW9uc1thY3Rpb24uYWN0aW9ucy5sZW5ndGgtMV07XG5cdFx0XHRcdFx0XHRzaGlwLnogPSBsYXN0Lno7XG5cdFx0XHRcdFx0XHRzaGlwLnggPSBsYXN0Lng7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2hpcDtcblx0XHRcdFx0XHRjYXNlICdTdW5rJzpcblx0XHRcdFx0XHRcdHNoaXAuc3VuayA9IHRydWU7XG5cdFx0XHRcdFx0XHRyZXR1cm4gc2hpcDtcblx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0cmV0dXJuIHNoaXA7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gc2hpcDtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRyZXR1cm4gc3RydWN0dXJlO1xuXHR9XG5cblx0Ly8gTWFwIGEgc2VxdWVuY2Ugb2YgYWN0aW9ucyB0aGF0IGFyZSBjb25zaWRlcmVkIGF0b21pYyBpbnRvIGEgY2hhaW4tYWJsZSBsaXN0IG9mIGFjdGlvbnMgZm9yIHNtb290aCBhbmltYXRpb24gYW5kIG1vdmVtZW50cyBcblx0ZnVuY3Rpb24gYWN0aW9uQ2hhaW4oZGF0YSkge1xuXHRcdGxldCByZXN1bHQgPSBbXTtcblx0XHRkYXRhLm1hcCgoZW50cnkpID0+IHtcblx0XHRcdGlmIChyZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCA+IDApIHsgXG5cdFx0XHRcdC8vIHJlc3VsdFtpXSB3aWxsIGFsd2F5cyBoYXZlIGF0IGxlYXN0IG9uZSBpdGVtIGluIGl0cyBhY3Rpb24gYXR0cmlidXRlIGxpc3Rcblx0XHRcdFx0bGV0IGxhc3QgPSByZXN1bHRbcmVzdWx0Lmxlbmd0aC0xXS5hY3Rpb25zO1xuXHRcdFx0XHQvLyBhY3Rpb24gY2FuIGJlIGNoYWluZWQgaWYgdGhleSBhcmUgb2YgdGhlIHNhbWUgdHlwZSBmcm9tIHRoZSBzYW1lIHNoaXAgaWRcblx0XHRcdFx0Ly8gY29uc29sZS5sb2coXCJDb21wYXJpbmc6IFwiLCByZXN1bHRbcmVzdWx0Lmxlbmd0aC0xXSwgbGFzdCwgZW50cnkpO1xuXHRcdFx0XHRpZiAobGFzdFswXS5pZCA9PT0gZW50cnkuaWQgJiYgbGFzdFswXS50eXBlID09PSBlbnRyeS50eXBlICYmIFxuXHRcdFx0XHRcdCgobGFzdFswXS50eXBlID09PSBcIk1PVkVcIikgfHwgXG5cdFx0XHRcdFx0IChsYXN0WzBdLnR5cGUgPT09IFwiRklSRVwiICYmIGxhc3RbMF0uYXRYID09PSBlbnRyeS5hdFggJiYgbGFzdFswXS5hdFkgPT09IGVudHJ5LmF0WSkgKSkge1xuXHRcdFx0XHRcdC8vIE1vdmVtZW50IGNhbiBiZSBjaGFpbmVkIGFuZCBmaXJpbmcgYXQgdGhlIHNhbWUgbG9jYXRpb24gY2FuIGJlIGNoYWluZWRcblx0XHRcdFx0XHRsYXN0LnB1c2goZW50cnkpO1xuXHRcdFx0XHR9IFxuXHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRyZXN1bHQucHVzaCh7XG5cdFx0XHRcdFx0XHR0eXBlOiBlbnRyeS50eXBlLFxuXHRcdFx0XHRcdFx0YWN0aW9uczogW2VudHJ5XVxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9IFxuXHRcdFx0ZWxzZSB7IC8vIGlmIHJlc3VsdCBpcyBlbXB0eSwgaW5pdGlhbCBjYXNlXG5cdFx0XHRcdHJlc3VsdC5wdXNoKHtcblx0XHRcdFx0XHR0eXBlOiBlbnRyeS50eXBlLFxuXHRcdFx0XHRcdGFjdGlvbnM6IFtlbnRyeV1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0Y29uc29sZS5sb2cocmVzdWx0KTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9XG5cblx0ZnVuY3Rpb24gcHJlcHJvY2VzcyhkYXRhLCBPUFRJT04pIHtcblx0XHRsZXQgcmVzdWx0ID0ge307XG5cdFx0Y29uc29sZS5sb2coXCJwcmVwcm9jZXNzKCkgXCIsIGRhdGEsIE9QVElPTik7XG5cblx0XHQvLyBkZWZpbmVzIHRoZSBvY2Vhbi9tYXAgY29uZmlndXJhdGlvblxuXHRcdHJlc3VsdC5tYXAgPSB7XG5cdFx0XHR4OiAoKE9QVElPTi5HcmlkU2NhbGUqTWF0aC5mbG9vcihkYXRhLm9jZWFuLngvMikpLTIpLFxuXHRcdFx0eTogT1BUSU9OLk9jZWFuWU9mZnNldCwgXG5cdFx0XHR6OiAoKE9QVElPTi5HcmlkU2NhbGUqTWF0aC5mbG9vcihkYXRhLm9jZWFuLnkvMikpKSxcblx0XHRcdHdpZHRoOiAyMDAsIFxuXHRcdFx0ZGVwdGg6IDIwMCxcblx0XHRcdGRlbnNpdHk6IDEyMFxuXHRcdH1cblxuXHRcdC8vIHNjYWxlIHVwIHNoaXAncyBpbml0aWFsIGxvY2F0aW9uc1xuXHRcdHJlc3VsdC5zaGlwcyA9IHRyYW5zZm9ybShkYXRhLnNoaXBzLCBPUFRJT04uR3JpZFNjYWxlLCBPUFRJT04pO1xuXG5cdFx0Ly8gYWRkIHN1bmsgcHJvcGVydHkgaW50byB0aGUgaW5pdGlhbCBzdGF0ZSBvZiB0aGUgc2hpcHNcblx0XHRyZXN1bHQuc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuXHRcdFx0c2hpcC5zdW5rID0gZmFsc2U7XG5cdFx0fSk7XG5cblx0XHQvLyBzY2FsZSB1cCBjb29yZGluYXRlcyBpbiB0aGUgYWN0aW9uIGxpc3QsIHRoZW4gY2FsbCB0aGUgYWN0aW9uQ2hhaW4gdG8gZ3JvdXAgc2VxdWVuY2VzIG9mIGFjdGlvbiBpbnRvIGEgdW5pdFxuXHRcdHJlc3VsdC50dXJucyA9IGFjdGlvbkNoYWluKCB0cmFuc2Zvcm0oZGF0YS50dXJucywgT1BUSU9OLkdyaWRTY2FsZSwgT1BUSU9OKSApO1xuXHRcdHJlc3VsdC50dXJucy5wdXNoKHt0eXBlOiAnRU5EJywgYWN0aW9uczogdW5kZWZpbmVkfSk7IC8vIGFkZCBlbmQgb2Ygc2ltdWxhdGlvbiBtYXJrZXJcblxuXHRcdGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cblx0XHRyZXN1bHQuc25hcHNob3RzID0ge1xuXHRcdFx0cGFzdDogW10sXG5cdFx0XHRwcmVzZW50OiB7fSxcblx0XHRcdGZ1dHVyZTogW11cblx0XHR9O1xuXG5cdFx0Y29uc29sZS5sb2coJ2luaXQgc3RhdGVzOiAnLCByZXN1bHQuc2hpcHMpO1xuXG5cdFx0bGV0IGN1cnJlbnRTdGF0ZSA9IHtzdGF0ZXM6IHJlc3VsdC5zaGlwcywgbmV4dDogcmVzdWx0LnR1cm5zWzBdfTtcblx0XHRyZXN1bHQudHVybnMuZm9yRWFjaCgodHVybikgPT4ge1xuXHRcdFx0cmVzdWx0LnNuYXBzaG90cy5mdXR1cmUudW5zaGlmdChjdXJyZW50U3RhdGUpO1xuXHRcdFx0Y3VycmVudFN0YXRlID0gcmVkdWNlcihjdXJyZW50U3RhdGUsIHR1cm4sIE9QVElPTik7XG5cdFx0fSk7XG5cdFx0Ly8gcmVzdWx0LnNuYXBzaG90cy5mdXR1cmUucmV2ZXJzZSgpO1xuXHRcdHJlc3VsdC5zbmFwc2hvdHMucHJlc2VudCA9IHJlc3VsdC5zbmFwc2hvdHMuZnV0dXJlLnBvcCgwKTtcblxuXHRcdGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdGZ1bmN0aW9uIHJlbmRlcihkYXRhLCBPUFRJT04pIHtcblx0XHRsZXQgaHRtbEVsZW1lbnQgPSB7fTtcblx0XHRsZXQgZG9jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjZW5lJyk7IC8vIDxhLXNjZW5lPiByZWZlcmVuY2VcblxuXHRcdC8vIHJlcG9zaXRpb24gY2FtZXJhIC0gY2FtZXJhIG11c3QgYmUgYWxyZWFkeSBwcmVzZW50IHdoZW4gaHRtbCBsb2Fkc1xuXHRcdGxldCBjYW1lcmEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FtZXJhJyk7XG5cdFx0Ly9jYW1lcmEuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGRhdGEub2NlYW4ueCArIFwiIFwiICsgZGF0YS5vY2Vhbi55ICsgXCIgXCIgKyBkYXRhLm9jZWFuLnopO1xuXHRcdGNhbWVyYS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgZGF0YS5tYXAueCArIFwiIFwiICsgZGF0YS5tYXAueSArIFwiIFwiICsgKGRhdGEubWFwLnorKDEuNSpkYXRhLm1hcC54KSkpO1xuXHRcdGNhbWVyYS5zZXRBdHRyaWJ1dGUoJ2NhbWVyYScsICd1c2VySGVpZ2h0OiAnICsgT1BUSU9OLkNhbWVyYVlPZmZzZXQpO1xuXHRcdGNhbWVyYS5zZXRBdHRyaWJ1dGUoJ3JvdGF0aW9uJywgLU1hdGguYXRhbihPUFRJT04uQ2FtZXJhWU9mZnNldC8oZGF0YS5tYXAueitkYXRhLm1hcC54KSkpO1xuXG5cdFx0Ly8gR2VuZXJhdGUgTWFwXG5cdFx0Ly8gVE9ETzogUG9zc2libGUgZWRnZSBjYXNlcyB3aXRoIHRoZSBtYXAgZWRnZSBub3QgYmVpbmcgYmlnIGVub3VnaFxuXHRcdGxldCBtYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLW9jZWFuJyk7XG5cdFx0bWFwLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBkYXRhLm1hcC54ICsgXCIgXCIgKyBkYXRhLm1hcC55ICsgXCIgXCIgKyBkYXRhLm1hcC56KTtcblx0XHRtYXAuc2V0QXR0cmlidXRlKCd3aWR0aCcsIFN0cmluZyhkYXRhLm1hcC53aWR0aCkpO1xuXHRcdG1hcC5zZXRBdHRyaWJ1dGUoJ2RlcHRoJywgU3RyaW5nKGRhdGEubWFwLmRlcHRoKSk7XG5cdFx0bWFwLnNldEF0dHJpYnV0ZSgnZGVuc2l0eScsIFN0cmluZyhkYXRhLm1hcC5kZW5zaXR5KSk7XG5cdFx0ZG9jLmFwcGVuZENoaWxkKG1hcCk7XG5cblx0XHQvLyBTcGF3biBTaGlwc1xuXHRcdGRhdGEuc2hpcHMuZm9yRWFjaCgoZW50cnkpID0+IHtcblx0XHRcdGh0bWxFbGVtZW50W2VudHJ5LmlkXSA9IGJhdHRsZXNoaXAucmVuZGVyKGVudHJ5KTtcblx0XHR9KTtcblx0XHRcblx0XHRyZXR1cm4gaHRtbEVsZW1lbnQ7XG5cdH1cblxuXHRmdW5jdGlvbiBpbml0U2NlbmUoaW5wdXRzKSB7XG5cdFx0bGV0IGRvYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2VuZScpO1xuXHRcdGxldCB0cmFjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EtY3VydmUnKTtcblx0XHR0cmFjay5zZXRBdHRyaWJ1dGUoJ2lkJywgJ3RyYWNrJyk7XG5cdFx0dHJhY2suc2V0QXR0cmlidXRlKCd0eXBlJywgJ0xpbmUnKTtcblx0XHRkb2MuYXBwZW5kQ2hpbGQodHJhY2spO1xuXG5cdFx0Y29uc29sZS5sb2coXCJpbml0U2NlbmUoKSBwcmVwcm9jZXNzKCkgXCIsIGlucHV0cyk7XG5cdFx0bGV0IGRhdGEgPSBwcmVwcm9jZXNzKGlucHV0cywgQ29uc3RhbnRzKTtcblxuXHRcdGxldCBodG1sRWxlbWVudHMgPSByZW5kZXIoZGF0YSwgQ29uc3RhbnRzKTtcblx0XHRjb25zb2xlLmxvZyhcImluaXRTY2VuZSgpIHJlbmRlcigpIFwiLCBodG1sRWxlbWVudHMpO1xuXG5cdFx0bGV0IHNsaWRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NsaWRlcicpO1xuXHRcdHNsaWRlLnNldEF0dHJpYnV0ZSgnbWluJywgMCk7XG5cdFx0c2xpZGUuc2V0QXR0cmlidXRlKCdtYXgnLCBkYXRhLnNuYXBzaG90cy5mdXR1cmUubGVuZ3RoKTtcblx0XHRzbGlkZS52YWx1ZSA9IDA7XG5cblx0XHRsZXQgbW9kZWwgPSB7XG5cdFx0XHRodG1sOiBodG1sRWxlbWVudHMsXG5cdFx0XHRzbmFwc2hvdHM6ZGF0YS5zbmFwc2hvdHNcblx0XHR9O1xuXHRcdHRlc3QgPSBtb2RlbDtcblxuXHRcdC8vIGJlZ2luIHNpbXVsYXRpb25cblx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdHNpbXVsYXRlKG1vZGVsLCBDb25zdGFudHMpO1xuXHRcdH0sIDEwMDApXG5cdH1cblxuXHRmdW5jdGlvbiBzaW11bGF0ZShkYXRhLCBPUFRJT04pIHtcblx0XHRjb25zb2xlLmxvZyhcInNpbXVsYXRlOiBcIiwgZGF0YSk7XG5cdFx0bGV0IHNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2xpZGVyXCIpO1xuXHRcdHNsaWRlci52YWx1ZSA9IGRhdGEuc25hcHNob3RzLnBhc3QubGVuZ3RoO1xuXHRcdC8vIGFwcC5pbnRlcnJ1cHQoKS50aGVuKChkb25lKSA9PiB7XG5cdFx0Ly8gXHRjb25zb2xlLmxvZyhkb25lKTtcblx0XHQvLyB9KTtcblx0XHRsZXQgaXNEb25lID0gZmFsc2U7XG5cdFx0aWYgKGRhdGEuc25hcHNob3RzLmZ1dHVyZS5sZW5ndGggPT0gMCkge1xuXHRcdFx0aXNEb25lID0gdHJ1ZVxuXHRcdH1cblx0XHRsZXQgY3VycmVudCA9IGRhdGEuc25hcHNob3RzLmZ1dHVyZS5wb3AoKTtcblx0XHRsZXQgbW9kZWwgPSBkYXRhLmh0bWw7XG5cdFx0aWYgKGN1cnJlbnQgJiYgIWlzRG9uZSkge1xuXHRcdFx0Y29uc29sZS5sb2coXCJjdXJyZW50OiBcIiwgY3VycmVudCk7XG5cdFx0XHRzd2l0Y2goY3VycmVudC5uZXh0LnR5cGUpIHtcblx0XHRcdFx0Y2FzZSBcIk1PVkVcIjpcblx0XHRcdFx0XHRiYXR0bGVzaGlwLm1vdmVTaGlwKG1vZGVsLCBjdXJyZW50Lm5leHQuYWN0aW9ucywgT1BUSU9OKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHQvL2FsZXJ0KFwiTW92ZWQgXCIgKyBkYXRhLnR1cm5zLmxlbmd0aCArIFwiIGFjdGlvbnMgbGVmdFwiKTtcblx0XHRcdFx0XHRcdGRhdGEuc25hcHNob3RzLnBhc3QucHVzaChkYXRhLnNuYXBzaG90cy5wcmVzZW50KTtcblx0XHRcdFx0XHRcdGRhdGEuc25hcHNob3RzLnByZXNlbnQgPSBjdXJyZW50O1xuXHRcdFx0XHRcdFx0Ly8gYXBwLmludGVycnVwdCgpLnRoZW4oKGRvbmUpID0+IHtcblx0XHRcdFx0XHRcdFx0c2ltdWxhdGUoZGF0YSwgT1BUSU9OKTtcblx0XHRcdFx0XHRcdFx0Ly9hcHAuaW50ZXJydXB0KGRhdGEsIE9QVElPTik7XG5cdFx0XHRcdFx0XHQvLyB9KTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJGSVJFXCI6XG5cdFx0XHRcdFx0YmF0dGxlc2hpcC5maXJlU2hpcChjdXJyZW50Lm5leHQuYWN0aW9ucywgT1BUSU9OKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHQvL2FsZXJ0KFwiRmlyZWQgXCIgKyBkYXRhLnR1cm5zLmxlbmd0aCArIFwiIGFjdGlvbnMgbGVmdFwiKTtcblx0XHRcdFx0XHRcdGRhdGEuc25hcHNob3RzLnBhc3QucHVzaChkYXRhLnNuYXBzaG90cy5wcmVzZW50KTtcblx0XHRcdFx0XHRcdGRhdGEuc25hcHNob3RzLnByZXNlbnQgPSBjdXJyZW50O1xuXHRcdFx0XHRcdFx0Ly8gYXBwLmludGVycnVwdCgpLnRoZW4oKGRvbmUpID0+IHtcblx0XHRcdFx0XHRcdFx0c2ltdWxhdGUoZGF0YSwgT1BUSU9OKTtcblx0XHRcdFx0XHRcdFx0Ly9hcHAuaW50ZXJydXB0KGRhdGEsIE9QVElPTik7XG5cdFx0XHRcdFx0XHQvLyB9KTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJTSU5LXCI6XG5cdFx0XHRcdFx0YmF0dGxlc2hpcC5zaW5rU2hpcCh7aHRtbDogZGF0YS5odG1sLCBwcmVzZW50OiBjdXJyZW50fSwgT1BUSU9OKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHQvL2FsZXJ0KFwiU3VuayBcIisgZGF0YS50dXJucy5sZW5ndGggKyBcIiBhY3Rpb25zIGxlZnRcIik7XG5cdFx0XHRcdFx0XHRkYXRhLnNuYXBzaG90cy5wYXN0LnB1c2goZGF0YS5zbmFwc2hvdHMucHJlc2VudCk7XG5cdFx0XHRcdFx0XHRkYXRhLnNuYXBzaG90cy5wcmVzZW50ID0gY3VycmVudDtcblx0XHRcdFx0XHRcdC8vIGFwcC5pbnRlcnJ1cHQoKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHRcdHNpbXVsYXRlKGRhdGEsIE9QVElPTik7XG5cdFx0XHRcdFx0XHRcdC8vYXBwLmludGVycnVwdChkYXRhLCBPUFRJT04pO1xuXHRcdFx0XHRcdFx0Ly8gfSk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goKGVycikgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiSElUXCI6XG5cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcIkVORFwiOlxuXHRcdFx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRcdFx0YWxlcnQoXCJTaW11bGF0aW9uIERvbmVcIik7XG5cdFx0XHRcdFx0fSwgMTAwMDApO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdGNvbnNvbGUubG9nKGBVbmtub3duIEFjdGlvbiBUeXBlICR7Y3VycmVudC50eXBlfSBpbiBzaW11bGF0ZSBmdW5jdGlvbiwgc2tpcHBpbmcuYCk7XG5cdFx0XHRcdFx0Ly8gY29tbWVudCBiZWxvdyBkdXJpbmcgZGV2ZWxvcG1lbnQgdG8gY2F0Y2ggYnVncywgcHJvZHVjdGlvbiBjb2RlIHNob3VsZCBjb250aW51ZSBhbG9uZyB3aXRoIHNpbXVsYXRpb25cblx0XHRcdFx0XHQvL3NpbXVsYXRlKGRhdGEsIE9QVElPTik7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRhbGVydChcIlNpbXVsYXRpb24gRG9uZVwiKTtcblx0XHRcdH0sIDEwMDAwKTtcblx0XHR9XG5cdH1cblxuXHQvLyBwdWJsaWNcblx0dmFyIGFwcCA9IHtcblxuXHRcdGluaXQ6ICgpID0+IHtcblx0XHRcdGxldCBpbnB1dHMgPSB7fTtcblx0XHRcdGxldCBjb2RlID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdjb2RlJyk7XG5cblx0XHRcdGlmIChjb2RlKSB7XG5cdFx0XHRcdGxldCByZWYgPSBkYXRhYmFzZS5yZWYoJ2Rhdnktam9uZXMtbG9ja2VyJykuY2hpbGQoY29kZSk7XG5cdFx0XHRcdHJlZi5vbmNlKCd2YWx1ZScsIChyZXMpID0+IHtcblx0XHRcdFx0XHRpbnB1dHMgPSB7XG5cdFx0XHRcdFx0XHRcImlkc1wiOiByZXMudmFsKCkuaW5pdC5zaGlwcy5tYXAoKHMpID0+IHsgcmV0dXJuIHMuaWQgfSksXG5cdFx0XHRcdFx0XHRcInNoaXBzXCI6IHJlcy52YWwoKS5pbml0LnNoaXBzLFxuXHRcdFx0XHRcdFx0XCJ0dXJuc1wiOiByZXMudmFsKCkudHVybnMsXG5cdFx0XHRcdFx0XHRcIm9jZWFuXCI6IHJlcy52YWwoKS5pbml0Lm1hcFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0sIChlcnIpID0+IHsgXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKGBVbmtub3duIFVSTCBDb2RlICR7Y29kZX0sIHVzaW5nIGRlZmF1bHQgb2ZmbGluZSBpbnB1dGApO1xuXHRcdFx0XHRcdGlucHV0cyA9IHtcblx0XHRcdFx0XHRcdFwiaWRzXCI6IGlucHV0LmluaXQuc2hpcHMubWFwKChzKSA9PiB7IHJldHVybiBzLmlkIH0pLFxuXHRcdFx0XHRcdFx0XCJzaGlwc1wiOiBpbnB1dC5pbml0LnNoaXBzLCBcblx0XHRcdFx0XHRcdFwidHVybnNcIjogaW5wdXQudHVybnMsIFxuXHRcdFx0XHRcdFx0XCJvY2VhblwiOiBpbnB1dC5pbml0Lm1hcFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcImluaXQoKSBcIiwgaW5wdXRzKTtcblx0XHRcdFx0XHRpbml0U2NlbmUoaW5wdXRzKTtcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnTWlzc2luZyBVUkwgcGFyYW1ldGVyIGNvZGUsIHVzaW5nIGRlZmF1bHQgb2ZmbGluZSBpbnB1dCcpO1xuXHRcdFx0XHRpbnB1dHMgPSB7XG5cdFx0XHRcdFx0XCJpZHNcIjogaW5wdXQuaW5pdC5zaGlwcy5tYXAoKHMpID0+IHsgcmV0dXJuIHMuaWQgfSksXG5cdFx0XHRcdFx0XCJzaGlwc1wiOiBpbnB1dC5pbml0LnNoaXBzLCBcblx0XHRcdFx0XHRcInR1cm5zXCI6IGlucHV0LnR1cm5zLCBcblx0XHRcdFx0XHRcIm9jZWFuXCI6IGlucHV0LmluaXQubWFwXG5cdFx0XHRcdH1cblx0XHRcdFx0Y29uc29sZS5sb2coXCJpbml0KCkgXCIsIGlucHV0cyk7XG5cdFx0XHRcdGluaXRTY2VuZShpbnB1dHMpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRyZXR1cm4gYXBwO1xufVxuXG5sZXQgYXBwID0gU2ltdWxhdGlvbigpO1xuYXBwLmluaXQoKTtcblxuLy9sZXQgcGFyYW1zID0gZ2V0UGFyYW1ldGVyQnlOYW1lKGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaCk7XG5cbi8vIGxldCBnZXREYXRhRnJvbUNvZGUgPSAoY29kZSkgPT4ge1xuLy8gXHRkYXRhYmFzZS5yZWYoJ2Rhdnktam9uZXMtbG9ja2VyLycgKyBjb2RlKS5vbmNlKCd2YWx1ZScsIChzbmFwc2hvdCkgPT4ge1xuLy8gXHRcdHZhciBnYW1lRGF0YSA9IHNuYXBzaG90LnZhbCgpO1xuLy8gXHRcdGlmIChnYW1lRGF0YSkge1xuLy8gXHRcdFx0aW5wdXQgPSBnYW1lRGF0YTtcbi8vIFx0XHRcdGFwcC5pbml0KCk7XG4vLyBcdFx0fSBlbHNlIHtcbi8vIFx0XHRcdGdldENvZGUoYE5vIGRhdGEgZm9yIGNvZGUgJHtjb2RlfS4gRW50ZXIgYW5vdGhlciBjb2RlOmApO1xuLy8gXHRcdFx0Ly9hcHAuaW5pdCgpO1xuLy8gXHRcdH1cbi8vIFx0fSkuY2F0Y2goKGVycikgPT4ge1xuLy8gXHRcdGdldENvZGUoYFRoZXJlIHdhcyBhbiBlcnJvci4gRW50ZXIgYW5vdGhlciBjb2RlOmApO1xuLy8gXHRcdC8vYXBwLmluaXQoKTtcbi8vIFx0fSk7XG4vLyB9XG5cbi8vIGxldCBnZXRDb2RlID0gKG1lc3NhZ2UpID0+IHtcbi8vIFx0dmV4LmRpYWxvZy5wcm9tcHQoe1xuLy8gXHRcdG1lc3NhZ2U6IG1lc3NhZ2UsXG4vLyBcdFx0Y2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuLy8gXHRcdFx0aWYgKHZhbHVlKSB7XG4vLyBcdFx0XHRcdHZhciBjb2RlID0gdmFsdWU7XG4vLyBcdFx0XHRcdGdldERhdGFGcm9tQ29kZShjb2RlKTtcbi8vIFx0XHRcdH0gZWxzZSB7XG4vLyBcdFx0XHRcdGdldENvZGUoXCJObyBjb2RlIGVudGVyZWQuIEVudGVyIHlvdXIgY29kZTpcIik7XG4vLyBcdFx0XHR9XG4vLyBcdFx0fVxuLy8gXHR9KTtcbi8vIH1cblxuLy8gaWYgKHBhcmFtcy5jb2RlKSB7XG4vLyBcdGdldERhdGFGcm9tQ29kZShwYXJhbXMuY29kZSk7XG4vLyB9IGVsc2Uge1xuLy8gXHRnZXRDb2RlKFwiRW50ZXIgWW91ciBDb2RlXCIpO1xuLy8gfVxuXG5cbi8vIHZhciBCQVRUTEVfU0VSVkVSX1VSTCA9ICdodHRwczovL2JhdHRsZXNoaXAtdmluZ2thbi5jOXVzZXJzLmlvLzF2MT9wMT1lc2kxNy5jcy5EZXN0cm95ZXJTaGlwJnAyPWVzaTE3LmhsaTEwOS5GbG9hdGVyJzsvLyArIE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMTAwKTtcblxuLy8gJC5nZXQoQkFUVExFX1NFUlZFUl9VUkwpLnRoZW4oZGF0YSA9PiB7XG4vLyBcdGlucHV0ID0gZGF0YTtcbi8vIFx0YXBwLmluaXQoKTtcbi8vIH0pLmRvbmUoKCkgPT4ge1xuLy8gXHRjb25zb2xlLmxvZyhcIkRhdGEgc3VjY2Vzc2Z1bGx5IHJldHJpZXZlZCBmcm9tIHNlcnZlclwiKTtcbi8vIH0pLmZhaWwoKCkgPT4ge1xuLy8gXHRjb25zb2xlLmxvZyhcIlVuYWJsZSB0byByZXRyaWV2ZSBkYXRhLCBzdGFydGluZyB3aXRoIGxvY2FsIGRhdGFcIik7XG4vLyBcdGFwcC5pbml0KCk7XG4vLyB9KTtcblxuXG5cbiJdfQ==\n"]}