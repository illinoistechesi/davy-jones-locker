{"version":3,"sources":["main.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","Simulation","transform","data","scale","console","log","map","entry","hasOwnProperty","atX","atZ","atY","OPTION","ShipYOffset","x","z","y","preprocess","result","GridScale","Math","floor","ocean","OceanYOffset","width","depth","density","ships","forEach","ship","sunk","health","hull","turns","last","actions","id","type","push","actionChain","undefined","unshift","currentState","states","task","turn","shipProp","action","structure","mapProperty","timeline","initScene","inputs","doc","document","getElementById","track","createElement","setAttribute","appendChild","htmlElements","htmlElement","camera","CameraYOffset","atan","String","battleship","render","slide","value","addEventListener","EVENTS","SliderMouseDown","SliderMouseUp","SliderValue","slider","test","setTimeout","simulate","current","present","isDone","update","html","then","done","moveShip","catch","err","error","fireShip","sinkShip","hitShip","alert","OceanPadding","SinkDistance","BulletArc","WaitTimePerTileMoved","WaitTimeBetweenAction","init","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","getParameterByName","database","ref","child","once","res","val","ids","warn","input","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","Ship"],"mappings":"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","file":"../main.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\n// Initialize Firebase\nvar config = {\n\tapiKey: \"AIzaSyA9EYUXVL5WAh6Aam1qXlWyvi3b7HLcZ1U\",\n\tauthDomain: \"esigamma.firebaseapp.com\",\n\tdatabaseURL: \"https://esigamma.firebaseio.com\",\n\tprojectId: \"esigamma\",\n\tstorageBucket: \"esigamma.appspot.com\",\n\tmessagingSenderId: \"734163636039\"\n};\nfirebase.initializeApp(config);\n\nvar database = firebase.database();\nvar battleship = Ship();\n\nvar test = void 0;\n\nfunction Simulation() {\n\n\t// private\n\tvar OPTION = {\n\t\tGridScale: 4,\n\t\tCameraYOffset: 15,\n\t\tOceanYOffset: 0,\n\t\tOceanPadding: 10,\n\t\tShipYOffset: 0,\n\t\tSinkDistance: 5,\n\t\tBulletArc: 2,\n\t\tWaitTimePerTileMoved: 300,\n\t\tWaitTimeBetweenAction: 50 // in miliseconds\n\t};\n\n\tvar EVENTS = {\n\t\tSliderMouseDown: false,\n\t\tSliderMouseUp: false,\n\t\tSliderValue: 0\n\t};\n\n\tfunction getParameterByName(name, url) {\n\t\tif (!url) url = window.location.href;\n\t\tname = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n\t\tvar regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n\t\tvar results = regex.exec(url);\n\t\tif (!results) return null;\n\t\tif (!results[2]) return '';\n\t\treturn decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n\t}\n\n\tfunction transform(data, scale) {\n\t\tconsole.log(\"transform() \", data);\n\t\tvar result = data.map(function (entry) {\n\t\t\tif (entry.hasOwnProperty(\"atX\") && entry.hasOwnProperty(\"atY\")) {\n\t\t\t\tentry.atX = scale * entry.atX;\n\t\t\t\tentry.atZ = scale * entry.atY; // 3D uses the xz plane as part of the ground\n\t\t\t\tentry.atY = OPTION.ShipYOffset; // vertical offset with respect to the ground and user in VR mode\n\t\t\t}\n\t\t\tentry.x = scale * entry.x;\n\t\t\tentry.z = scale * entry.y; // 3D uses the xz plane as part of the ground\n\t\t\tentry.y = OPTION.ShipYOffset;\n\t\t\treturn entry;\n\t\t});\n\t\treturn result;\n\t};\n\n\tfunction mapProperty(shipProp, action) {\n\t\tconsole.log(shipProp);\n\t\tvar structure = {\n\t\t\tstates: shipProp.states,\n\t\t\ttask: action\n\t\t};\n\n\t\tstructure.states = shipProp.states.map(function (ship) {\n\t\t\tif (action.id === ship.id) {\n\t\t\t\tswitch (action.type) {\n\t\t\t\t\tcase 'MOVE':\n\t\t\t\t\t\t// update state from the result of the last action list\n\t\t\t\t\t\tvar last = action.actions[action.actions.length - 1];\n\t\t\t\t\t\tship.z = last.z;\n\t\t\t\t\t\tship.x = last.x;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tcase 'SINK':\n\t\t\t\t\t\tship.sunk = true;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tcase 'Hit':\n\t\t\t\t\t\tship.health--;\n\t\t\t\t\t\treturn ship;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn ship;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn ship;\n\t\t\t}\n\t\t});\n\t\treturn structure;\n\t}\n\n\t// Map a sequence of actions that are considered atomic into a chain-able list of actions for smooth animation and movements \n\tfunction actionChain(data) {\n\t\tvar result = [];\n\t\tdata.map(function (entry) {\n\t\t\tif (result && result.length > 0) {\n\t\t\t\t// result[i] will always have at least one item in its action attribute list\n\t\t\t\tvar last = result[result.length - 1].actions;\n\t\t\t\t// action can be chained if they are of the same type from the same ship id\n\t\t\t\t// console.log(\"Comparing: \", result[result.length-1], last, entry);\n\t\t\t\tif (last[0].id === entry.id && last[0].type === entry.type && (last[0].type === \"MOVE\" || last[0].type === \"FIRE\" && last[0].atX === entry.atX && last[0].atY === entry.atY)) {\n\t\t\t\t\t// Movement can be chained and firing at the same location can be chained\n\t\t\t\t\tlast.push(entry);\n\t\t\t\t} else {\n\t\t\t\t\tresult.push({\n\t\t\t\t\t\ttype: entry.type,\n\t\t\t\t\t\tactions: [entry]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// if result is empty, initial case\n\t\t\t\tresult.push({\n\t\t\t\t\ttype: entry.type,\n\t\t\t\t\tactions: [entry]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tconsole.log(result);\n\t\treturn result;\n\t}\n\n\tfunction preprocess(data) {\n\t\tvar result = {};\n\t\tconsole.log(\"preprocess() \", data);\n\n\t\t// defines the ocean/map configuration\n\t\tresult.map = {\n\t\t\tx: OPTION.GridScale * Math.floor(data.ocean.x / 2) - 2,\n\t\t\ty: OPTION.OceanYOffset,\n\t\t\tz: OPTION.GridScale * Math.floor(data.ocean.y / 2),\n\t\t\twidth: 200,\n\t\t\tdepth: 200,\n\t\t\tdensity: 120\n\n\t\t\t// scale up ship's initial locations\n\t\t};result.ships = transform(data.ships, OPTION.GridScale);\n\n\t\t// add sunk property into the initial state of the ships\n\t\tresult.ships.forEach(function (ship) {\n\t\t\tship.sunk = false;\n\t\t\tship.health = ship.hull;\n\t\t});\n\n\t\t// scale up coordinates in the action list, then call the actionChain to group sequences of action into a unit\n\t\tresult.turns = actionChain(transform(data.turns, OPTION.GridScale));\n\t\tresult.turns.push({ type: 'END', actions: undefined });\n\t\tresult.turns.unshift({ type: 'START', actions: undefined });\n\n\t\tconsole.log(result);\n\n\t\tresult['timeline'] = [];\n\t\tresult['present'] = 0;\n\n\t\tconsole.log('init states: ', result.ships);\n\n\t\tvar currentState = { states: result.ships, task: result.turns[0] };\n\t\t// calculate ships' state for all the turns, used to animate later\n\t\tresult.turns.forEach(function (turn) {\n\t\t\tcurrentState = mapProperty(currentState, turn);\n\t\t\tresult.timeline.push(currentState);\n\t\t});\n\n\t\tconsole.log(result);\n\t\treturn result;\n\t}\n\n\tfunction render(data) {\n\t\tvar htmlElement = {};\n\t\tvar doc = document.getElementById('scene'); // <a-scene> reference\n\n\t\t// reposition camera - camera must be already present when html loads\n\t\tvar camera = document.getElementById('camera');\n\t\t//camera.setAttribute('position', data.ocean.x + \" \" + data.ocean.y + \" \" + data.ocean.z);\n\t\tcamera.setAttribute('position', data.map.x + \" \" + data.map.y + \" \" + (data.map.z + 1.5 * data.map.x));\n\t\tcamera.setAttribute('camera', 'userHeight: ' + OPTION.CameraYOffset);\n\t\tcamera.setAttribute('rotation', -Math.atan(OPTION.CameraYOffset / (data.map.z + data.map.x)));\n\n\t\t// Generate Map\n\t\t// TODO: Possible edge cases with the map edge not being big enough\n\t\tvar map = document.createElement('a-ocean');\n\t\tmap.setAttribute('position', data.map.x + \" \" + data.map.y + \" \" + data.map.z);\n\t\tmap.setAttribute('width', String(data.map.width));\n\t\tmap.setAttribute('depth', String(data.map.depth));\n\t\tmap.setAttribute('density', String(data.map.density));\n\t\tdoc.appendChild(map);\n\n\t\t// Spawn Ships\n\t\tdata.ships.forEach(function (entry) {\n\t\t\thtmlElement[entry.id] = battleship.render(entry);\n\t\t});\n\n\t\treturn htmlElement;\n\t}\n\n\tfunction initScene(inputs) {\n\t\tvar doc = document.getElementById('scene');\n\t\tvar track = document.createElement('a-curve');\n\t\ttrack.setAttribute('id', 'track');\n\t\ttrack.setAttribute('type', 'Line');\n\t\tdoc.appendChild(track);\n\n\t\tvar data = preprocess(inputs);\n\t\tvar htmlElements = render(data);\n\t\tdata['html'] = htmlElements;\n\n\t\tvar slide = document.getElementById('slider');\n\t\tslide.setAttribute('min', 0);\n\t\tslide.setAttribute('max', data.timeline.length);\n\t\tslide.value = 0;\n\t\tslide.addEventListener('mousedown', function () {\n\t\t\tEVENTS.SliderMouseDown = true;\n\t\t});\n\t\tslide.addEventListener('mouseup', function () {\n\t\t\tEVENTS.SliderMouseDown = false;\n\t\t\tEVENTS.SliderMouseUp = true;\n\t\t\tEVENTS.SliderValue = slider.value;\n\t\t});\n\n\t\ttest = data;\n\n\t\t// begin simulation\n\t\tsetTimeout(function () {\n\t\t\tsimulate(data);\n\t\t}, 1000);\n\t}\n\n\tfunction simulate(data) {\n\t\tvar slider = document.getElementById(\"slider\");\n\t\tvar current = data.timeline[data.present++];\n\t\tvar isDone = false;\n\t\tif (data.present == data.timeline.length) isDone = true;\n\n\t\t// TODO: Use the OPTION's time between per action to animate slider increment\n\t\tif (!EVENTS.SliderMouseDown) {\n\t\t\tslider.value = data.present;\n\t\t}\n\n\t\tif (EVENTS.SliderMouseUp) {\n\t\t\tEVENTS.SliderMouseUp = false;\n\t\t\tdata.present = EVENTS.SliderValue;\n\t\t\tbattleship.update(data.html, current).then(function (done) {\n\t\t\t\tsimulate(data);\n\t\t\t});\n\t\t\treturn;\n\t\t} else if (current && !isDone) {\n\t\t\tswitch (current.task.type) {\n\t\t\t\tcase \"MOVE\":\n\t\t\t\t\tbattleship.moveShip(data.html, current, OPTION).then(function (done) {\n\t\t\t\t\t\tsimulate(data);\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error('Error at movement simulation: ', err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"FIRE\":\n\t\t\t\t\tbattleship.fireShip(current, OPTION).then(function (done) {\n\t\t\t\t\t\t//alert(\"Fired \" + data.turns.length + \" actions left\");\n\t\t\t\t\t\t// console.log(\"Fire case 0: \", data.present.task.type);\n\t\t\t\t\t\tsimulate(data);\n\t\t\t\t\t\t// });\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error('Error at firing simulation: ', err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"SINK\":\n\t\t\t\t\tbattleship.sinkShip(data.html, current, OPTION).then(function (done) {\n\t\t\t\t\t\t//alert(\"Sunk \"+ data.turns.length + \" actions left\");\n\t\t\t\t\t\tsimulate(data);\n\t\t\t\t\t\t// });\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.error('Error at sinking simulation: ', err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"HIT\":\n\t\t\t\t\tbattleship.hitShip(data.html, current).then(function (done) {\n\t\t\t\t\t\tsimulate(data);\n\t\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t\tconsole.log('Error at ship damage simulation: ', err);\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"END\":\n\t\t\t\t\t// Disabled slider because resetting timeline is not working\n\t\t\t\t\t// slider.addEventListener('change', () => {\n\t\t\t\t\t// \tsimulate(data);\n\t\t\t\t\t// \tslider.removeEventListener('change');\n\t\t\t\t\t// });\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\talert(\"Simulation Done, use slider to playback.\");\n\t\t\t\t\t}, 5000);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"START\":\n\t\t\t\t\tconsole.log('Reading start of simulation marker.');\n\t\t\t\t\tsimulate(data);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log(\"Unknown Action Type \" + current.type + \" in simulate function, skipping.\");\n\t\t\t\t// comment below during development to catch bugs, production code should continue along with simulation\n\t\t\t\t//simulate(data);;\n\t\t\t}\n\t\t} else {\n\t\t\t// Disabled slider because resetting timeline is not working\n\t\t\t// slider.addEventListener('change', () => {\n\t\t\t// \tsimulate(data);\n\t\t\t// \tslider.removeEventListener('change');\n\t\t\t// });\n\t\t\tsetTimeout(function () {\n\t\t\t\talert(\"Simulation Done...\");\n\t\t\t}, 10000);\n\t\t}\n\t}\n\n\t// public\n\tvar app = {\n\n\t\tinit: function init() {\n\t\t\tvar inputs = {};\n\t\t\tvar code = getParameterByName('code');\n\n\t\t\tif (code) {\n\t\t\t\tvar ref = database.ref('davy-jones-locker').child(code);\n\t\t\t\tref.once('value', function (res) {\n\t\t\t\t\tconsole.log(\"Firebase: \", res.val());\n\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\"ids\": res.val().init.ships.map(function (s) {\n\t\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"ships\": res.val().init.ships,\n\t\t\t\t\t\t\"turns\": res.val().turns,\n\t\t\t\t\t\t\"ocean\": res.val().init.map\n\t\t\t\t\t};\n\t\t\t\t}, function (err) {\n\t\t\t\t\tconsole.warn(\"Unknown URL Code \" + code + \", using default offline input\");\n\t\t\t\t\tinputs = {\n\t\t\t\t\t\t\"ids\": input.init.ships.map(function (s) {\n\t\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t\"ships\": input.init.ships,\n\t\t\t\t\t\t\"turns\": input.turns,\n\t\t\t\t\t\t\"ocean\": input.init.map\n\t\t\t\t\t};\n\t\t\t\t}).then(function () {\n\t\t\t\t\tconsole.log(\"init() \", inputs);\n\t\t\t\t\tinitScene(inputs);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconsole.log('Missing URL parameter code, using default offline input');\n\t\t\t\tinputs = {\n\t\t\t\t\t\"ids\": input.init.ships.map(function (s) {\n\t\t\t\t\t\treturn s.id;\n\t\t\t\t\t}),\n\t\t\t\t\t\"ships\": input.init.ships,\n\t\t\t\t\t\"turns\": input.turns,\n\t\t\t\t\t\"ocean\": input.init.map\n\t\t\t\t};\n\t\t\t\tconsole.log(\"init() \", inputs);\n\t\t\t\tinitScene(inputs);\n\t\t\t}\n\t\t}\n\t};\n\n\treturn app;\n}\n\nvar app = Simulation();\napp.init();\n\n//let params = getParameterByName(document.location.search);\n\n// let getDataFromCode = (code) => {\n// \tdatabase.ref('davy-jones-locker/' + code).once('value', (snapshot) => {\n// \t\tvar gameData = snapshot.val();\n// \t\tif (gameData) {\n// \t\t\tinput = gameData;\n// \t\t\tapp.init();\n// \t\t} else {\n// \t\t\tgetCode(`No data for code ${code}. Enter another code:`);\n// \t\t\t//app.init();\n// \t\t}\n// \t}).catch((err) => {\n// \t\tgetCode(`There was an error. Enter another code:`);\n// \t\t//app.init();\n// \t});\n// }\n\n// let getCode = (message) => {\n// \tvex.dialog.prompt({\n// \t\tmessage: message,\n// \t\tcallback: (value) => {\n// \t\t\tif (value) {\n// \t\t\t\tvar code = value;\n// \t\t\t\tgetDataFromCode(code);\n// \t\t\t} else {\n// \t\t\t\tgetCode(\"No code entered. Enter your code:\");\n// \t\t\t}\n// \t\t}\n// \t});\n// }\n\n// if (params.code) {\n// \tgetDataFromCode(params.code);\n// } else {\n// \tgetCode(\"Enter Your Code\");\n// }\n\n\n// var BATTLE_SERVER_URL = 'https://battleship-vingkan.c9users.io/1v1?p1=esi17.cs.DestroyerShip&p2=esi17.hli109.Floater';// + Math.ceil(Math.random() * 100);\n\n// $.get(BATTLE_SERVER_URL).then(data => {\n// \tinput = data;\n// \tapp.init();\n// }).done(() => {\n// \tconsole.log(\"Data successfully retrieved from server\");\n// }).fail(() => {\n// \tconsole.log(\"Unable to retrieve data, starting with local data\");\n// \tapp.init();\n// });\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUE7QUFDQSxJQUFJLFNBQVM7QUFDWixTQUFRLHlDQURJO0FBRVosYUFBWSwwQkFGQTtBQUdaLGNBQWEsaUNBSEQ7QUFJWixZQUFXLFVBSkM7QUFLWixnQkFBZSxzQkFMSDtBQU1aLG9CQUFtQjtBQU5QLENBQWI7QUFRQSxTQUFTLGFBQVQsQ0FBdUIsTUFBdkI7O0FBRUEsSUFBSSxXQUFXLFNBQVMsUUFBVCxFQUFmO0FBQ0EsSUFBSSxhQUFhLE1BQWpCOztBQUVBLElBQUksYUFBSjs7QUFFQSxTQUFTLFVBQVQsR0FBc0I7O0FBRXJCO0FBQ0EsS0FBSSxTQUFTO0FBQ1osYUFBVyxDQURDO0FBRVosaUJBQWUsRUFGSDtBQUdaLGdCQUFjLENBSEY7QUFJWixnQkFBYyxFQUpGO0FBS1osZUFBYSxDQUxEO0FBTVosZ0JBQWMsQ0FORjtBQU9aLGFBQVcsQ0FQQztBQVFaLHdCQUFzQixHQVJWO0FBU1oseUJBQXVCLEVBVFgsQ0FTYztBQVRkLEVBQWI7O0FBWUEsS0FBSSxTQUFTO0FBQ1osbUJBQWlCLEtBREw7QUFFWixpQkFBZSxLQUZIO0FBR1osZUFBYTtBQUhELEVBQWI7O0FBTUEsVUFBUyxrQkFBVCxDQUE0QixJQUE1QixFQUFrQyxHQUFsQyxFQUF1QztBQUN0QyxNQUFJLENBQUMsR0FBTCxFQUFVLE1BQU0sT0FBTyxRQUFQLENBQWdCLElBQXRCO0FBQ1YsU0FBTyxLQUFLLE9BQUwsQ0FBYSxTQUFiLEVBQXdCLE1BQXhCLENBQVA7QUFDQSxNQUFJLFFBQVEsSUFBSSxNQUFKLENBQVcsU0FBUyxJQUFULEdBQWdCLG1CQUEzQixDQUFaO0FBQ0EsTUFBSSxVQUFVLE1BQU0sSUFBTixDQUFXLEdBQVgsQ0FBZDtBQUNBLE1BQUksQ0FBQyxPQUFMLEVBQWMsT0FBTyxJQUFQO0FBQ2QsTUFBSSxDQUFDLFFBQVEsQ0FB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ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIEluaXRpYWxpemUgRmlyZWJhc2VcbmxldCBjb25maWcgPSB7XG5cdGFwaUtleTogXCJBSXphU3lBOUVZVVhWTDVXQWg2QWFtMXFYbFd5dmkzYjdITGNaMVVcIixcblx0YXV0aERvbWFpbjogXCJlc2lnYW1tYS5maXJlYmFzZWFwcC5jb21cIixcblx0ZGF0YWJhc2VVUkw6IFwiaHR0cHM6Ly9lc2lnYW1tYS5maXJlYmFzZWlvLmNvbVwiLFxuXHRwcm9qZWN0SWQ6IFwiZXNpZ2FtbWFcIixcblx0c3RvcmFnZUJ1Y2tldDogXCJlc2lnYW1tYS5hcHBzcG90LmNvbVwiLFxuXHRtZXNzYWdpbmdTZW5kZXJJZDogXCI3MzQxNjM2MzYwMzlcIlxufTtcbmZpcmViYXNlLmluaXRpYWxpemVBcHAoY29uZmlnKTtcblxubGV0IGRhdGFiYXNlID0gZmlyZWJhc2UuZGF0YWJhc2UoKTtcbmxldCBiYXR0bGVzaGlwID0gU2hpcCgpO1xuXG5sZXQgdGVzdDtcblxuZnVuY3Rpb24gU2ltdWxhdGlvbigpIHtcblx0XG5cdC8vIHByaXZhdGVcblx0bGV0IE9QVElPTiA9IHtcblx0XHRHcmlkU2NhbGU6IDQsXG5cdFx0Q2FtZXJhWU9mZnNldDogMTUsXG5cdFx0T2NlYW5ZT2Zmc2V0OiAwLFxuXHRcdE9jZWFuUGFkZGluZzogMTAsXG5cdFx0U2hpcFlPZmZzZXQ6IDAsXG5cdFx0U2lua0Rpc3RhbmNlOiA1LFxuXHRcdEJ1bGxldEFyYzogMixcblx0XHRXYWl0VGltZVBlclRpbGVNb3ZlZDogMzAwLFxuXHRcdFdhaXRUaW1lQmV0d2VlbkFjdGlvbjogNTAgLy8gaW4gbWlsaXNlY29uZHNcblx0fTtcblxuXHRsZXQgRVZFTlRTID0ge1xuXHRcdFNsaWRlck1vdXNlRG93bjogZmFsc2UsXG5cdFx0U2xpZGVyTW91c2VVcDogZmFsc2UsXG5cdFx0U2xpZGVyVmFsdWU6IDBcblx0fTtcblxuXHRmdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSwgdXJsKSB7XG5cdFx0aWYgKCF1cmwpIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuXHRcdG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csIFwiXFxcXCQmXCIpO1xuXHRcdGxldCByZWdleCA9IG5ldyBSZWdFeHAoXCJbPyZdXCIgKyBuYW1lICsgXCIoPShbXiYjXSopfCZ8I3wkKVwiKTtcblx0XHRsZXQgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcblx0XHRpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuXHRcdGlmICghcmVzdWx0c1syXSkgcmV0dXJuICcnO1xuXHRcdHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgXCIgXCIpKTtcblx0fVxuXG5cdGZ1bmN0aW9uIHRyYW5zZm9ybShkYXRhLCBzY2FsZSkge1xuXHRcdGNvbnNvbGUubG9nKFwidHJhbnNmb3JtKCkgXCIsIGRhdGEpO1xuXHRcdGxldCByZXN1bHQgPSBkYXRhLm1hcCgoZW50cnkpID0+IHtcblx0XHRcdGlmIChlbnRyeS5oYXNPd25Qcm9wZXJ0eShcImF0WFwiKSAmJiBlbnRyeS5oYXNPd25Qcm9wZXJ0eShcImF0WVwiKSkge1xuXHRcdFx0XHRlbnRyeS5hdFggPSBzY2FsZSAqIGVudHJ5LmF0WDtcblx0XHRcdFx0ZW50cnkuYXRaID0gc2NhbGUgKiBlbnRyeS5hdFk7IC8vIDNEIHVzZXMgdGhlIHh6IHBsYW5lIGFzIHBhcnQgb2YgdGhlIGdyb3VuZFxuXHRcdFx0XHRlbnRyeS5hdFkgPSBPUFRJT04uU2hpcFlPZmZzZXQ7IC8vIHZlcnRpY2FsIG9mZnNldCB3aXRoIHJlc3BlY3QgdG8gdGhlIGdyb3VuZCBhbmQgdXNlciBpbiBWUiBtb2RlXG5cdFx0XHR9XG5cdFx0XHRlbnRyeS54ID0gc2NhbGUgKiBlbnRyeS54O1xuXHRcdFx0ZW50cnkueiA9IHNjYWxlICogZW50cnkueTsgLy8gM0QgdXNlcyB0aGUgeHogcGxhbmUgYXMgcGFydCBvZiB0aGUgZ3JvdW5kXG5cdFx0XHRlbnRyeS55ID0gT1BUSU9OLlNoaXBZT2Zmc2V0O1xuXHRcdFx0cmV0dXJuIGVudHJ5O1xuXHRcdH0pO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH07XG5cblx0ZnVuY3Rpb24gbWFwUHJvcGVydHkoc2hpcFByb3AsIGFjdGlvbikge1xuXHRcdGNvbnNvbGUubG9nKHNoaXBQcm9wKTtcblx0XHRsZXQgc3RydWN0dXJlID0ge1xuXHRcdFx0c3RhdGVzOiBzaGlwUHJvcC5zdGF0ZXMsXG5cdFx0XHR0YXNrOiBhY3Rpb25cblx0XHR9O1xuXG5cdFx0c3RydWN0dXJlLnN0YXRlcyA9IHNoaXBQcm9wLnN0YXRlcy5tYXAoKHNoaXApID0+IHtcblx0XHRcdGlmIChhY3Rpb24uaWQgPT09IHNoaXAuaWQpIHtcblx0XHRcdFx0c3dpdGNoKGFjdGlvbi50eXBlKSB7XG5cdFx0XHRcdFx0Y2FzZSAnTU9WRSc6XG5cdFx0XHRcdFx0XHQvLyB1cGRhdGUgc3RhdGUgZnJvbSB0aGUgcmVzdWx0IG9mIHRoZSBsYXN0IGFjdGlvbiBsaXN0XG5cdFx0XHRcdFx0XHRsZXQgbGFzdCA9IGFjdGlvbi5hY3Rpb25zW2FjdGlvbi5hY3Rpb25zLmxlbmd0aC0xXTtcblx0XHRcdFx0XHRcdHNoaXAueiA9IGxhc3Quejtcblx0XHRcdFx0XHRcdHNoaXAueCA9IGxhc3QueDtcblx0XHRcdFx0XHRcdHJldHVybiBzaGlwO1xuXHRcdFx0XHRcdGNhc2UgJ1NJTksnOlxuXHRcdFx0XHRcdFx0c2hpcC5zdW5rID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHJldHVybiBzaGlwO1xuXHRcdFx0XHRcdGNhc2UgJ0hpdCc6XG5cdFx0XHRcdFx0XHRzaGlwLmhlYWx0aC0tO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHNoaXA7XG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdHJldHVybiBzaGlwO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHNoaXA7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHN0cnVjdHVyZTtcblx0fVxuXG5cdC8vIE1hcCBhIHNlcXVlbmNlIG9mIGFjdGlvbnMgdGhhdCBhcmUgY29uc2lkZXJlZCBhdG9taWMgaW50byBhIGNoYWluLWFibGUgbGlzdCBvZiBhY3Rpb25zIGZvciBzbW9vdGggYW5pbWF0aW9uIGFuZCBtb3ZlbWVudHMgXG5cdGZ1bmN0aW9uIGFjdGlvbkNoYWluKGRhdGEpIHtcblx0XHRsZXQgcmVzdWx0ID0gW107XG5cdFx0ZGF0YS5tYXAoKGVudHJ5KSA9PiB7XG5cdFx0XHRpZiAocmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggPiAwKSB7IFxuXHRcdFx0XHQvLyByZXN1bHRbaV0gd2lsbCBhbHdheXMgaGF2ZSBhdCBsZWFzdCBvbmUgaXRlbSBpbiBpdHMgYWN0aW9uIGF0dHJpYnV0ZSBsaXN0XG5cdFx0XHRcdGxldCBsYXN0ID0gcmVzdWx0W3Jlc3VsdC5sZW5ndGgtMV0uYWN0aW9ucztcblx0XHRcdFx0Ly8gYWN0aW9uIGNhbiBiZSBjaGFpbmVkIGlmIHRoZXkgYXJlIG9mIHRoZSBzYW1lIHR5cGUgZnJvbSB0aGUgc2FtZSBzaGlwIGlkXG5cdFx0XHRcdC8vIGNvbnNvbGUubG9nKFwiQ29tcGFyaW5nOiBcIiwgcmVzdWx0W3Jlc3VsdC5sZW5ndGgtMV0sIGxhc3QsIGVudHJ5KTtcblx0XHRcdFx0aWYgKGxhc3RbMF0uaWQgPT09IGVudHJ5LmlkICYmIGxhc3RbMF0udHlwZSA9PT0gZW50cnkudHlwZSAmJiBcblx0XHRcdFx0XHQoKGxhc3RbMF0udHlwZSA9PT0gXCJNT1ZFXCIpIHx8IFxuXHRcdFx0XHRcdCAobGFzdFswXS50eXBlID09PSBcIkZJUkVcIiAmJiBsYXN0WzBdLmF0WCA9PT0gZW50cnkuYXRYICYmIGxhc3RbMF0uYXRZID09PSBlbnRyeS5hdFkpICkpIHtcblx0XHRcdFx0XHQvLyBNb3ZlbWVudCBjYW4gYmUgY2hhaW5lZCBhbmQgZmlyaW5nIGF0IHRoZSBzYW1lIGxvY2F0aW9uIGNhbiBiZSBjaGFpbmVkXG5cdFx0XHRcdFx0bGFzdC5wdXNoKGVudHJ5KTtcblx0XHRcdFx0fSBcblx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0cmVzdWx0LnB1c2goe1xuXHRcdFx0XHRcdFx0dHlwZTogZW50cnkudHlwZSxcblx0XHRcdFx0XHRcdGFjdGlvbnM6IFtlbnRyeV1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSBcblx0XHRcdGVsc2UgeyAvLyBpZiByZXN1bHQgaXMgZW1wdHksIGluaXRpYWwgY2FzZVxuXHRcdFx0XHRyZXN1bHQucHVzaCh7XG5cdFx0XHRcdFx0dHlwZTogZW50cnkudHlwZSxcblx0XHRcdFx0XHRhY3Rpb25zOiBbZW50cnldXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdGNvbnNvbGUubG9nKHJlc3VsdCk7XG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fVxuXG5cdGZ1bmN0aW9uIHByZXByb2Nlc3MoZGF0YSkge1xuXHRcdGxldCByZXN1bHQgPSB7fTtcblx0XHRjb25zb2xlLmxvZyhcInByZXByb2Nlc3MoKSBcIiwgZGF0YSk7XG5cblx0XHQvLyBkZWZpbmVzIHRoZSBvY2Vhbi9tYXAgY29uZmlndXJhdGlvblxuXHRcdHJlc3VsdC5tYXAgPSB7XG5cdFx0XHR4OiAoKE9QVElPTi5HcmlkU2NhbGUqTWF0aC5mbG9vcihkYXRhLm9jZWFuLngvMikpLTIpLFxuXHRcdFx0eTogT1BUSU9OLk9jZWFuWU9mZnNldCwgXG5cdFx0XHR6OiAoKE9QVElPTi5HcmlkU2NhbGUqTWF0aC5mbG9vcihkYXRhLm9jZWFuLnkvMikpKSxcblx0XHRcdHdpZHRoOiAyMDAsIFxuXHRcdFx0ZGVwdGg6IDIwMCxcblx0XHRcdGRlbnNpdHk6IDEyMFxuXHRcdH1cblxuXHRcdC8vIHNjYWxlIHVwIHNoaXAncyBpbml0aWFsIGxvY2F0aW9uc1xuXHRcdHJlc3VsdC5zaGlwcyA9IHRyYW5zZm9ybShkYXRhLnNoaXBzLCBPUFRJT04uR3JpZFNjYWxlKTtcblxuXHRcdC8vIGFkZCBzdW5rIHByb3BlcnR5IGludG8gdGhlIGluaXRpYWwgc3RhdGUgb2YgdGhlIHNoaXBzXG5cdFx0cmVzdWx0LnNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcblx0XHRcdHNoaXAuc3VuayA9IGZhbHNlO1xuXHRcdFx0c2hpcC5oZWFsdGggPSBzaGlwLmh1bGw7XG5cdFx0fSk7XG5cblx0XHQvLyBzY2FsZSB1cCBjb29yZGluYXRlcyBpbiB0aGUgYWN0aW9uIGxpc3QsIHRoZW4gY2FsbCB0aGUgYWN0aW9uQ2hhaW4gdG8gZ3JvdXAgc2VxdWVuY2VzIG9mIGFjdGlvbiBpbnRvIGEgdW5pdFxuXHRcdHJlc3VsdC50dXJucyA9IGFjdGlvbkNoYWluKCB0cmFuc2Zvcm0oZGF0YS50dXJucywgT1BUSU9OLkdyaWRTY2FsZSkgKTtcblx0XHRyZXN1bHQudHVybnMucHVzaCh7dHlwZTogJ0VORCcsIGFjdGlvbnM6IHVuZGVmaW5lZH0pOyBcblx0XHRyZXN1bHQudHVybnMudW5zaGlmdCh7dHlwZTogJ1NUQVJUJywgYWN0aW9uczogdW5kZWZpbmVkfSk7XG5cblx0XHRjb25zb2xlLmxvZyhyZXN1bHQpO1xuXG5cdFx0cmVzdWx0Wyd0aW1lbGluZSddID0gW107XG5cdFx0cmVzdWx0WydwcmVzZW50J10gPSAwO1xuXG5cdFx0Y29uc29sZS5sb2coJ2luaXQgc3RhdGVzOiAnLCByZXN1bHQuc2hpcHMpO1xuXG5cdFx0bGV0IGN1cnJlbnRTdGF0ZSA9IHtzdGF0ZXM6IHJlc3VsdC5zaGlwcywgdGFzazogcmVzdWx0LnR1cm5zWzBdfTtcblx0XHQvLyBjYWxjdWxhdGUgc2hpcHMnIHN0YXRlIGZvciBhbGwgdGhlIHR1cm5zLCB1c2VkIHRvIGFuaW1hdGUgbGF0ZXJcblx0XHRyZXN1bHQudHVybnMuZm9yRWFjaCgodHVybikgPT4ge1xuXHRcdFx0Y3VycmVudFN0YXRlID0gbWFwUHJvcGVydHkoY3VycmVudFN0YXRlLCB0dXJuKTtcblx0XHRcdHJlc3VsdC50aW1lbGluZS5wdXNoKGN1cnJlbnRTdGF0ZSk7XG5cdFx0fSk7XG5cblx0XHRjb25zb2xlLmxvZyhyZXN1bHQpO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH1cblxuXHRmdW5jdGlvbiByZW5kZXIoZGF0YSkge1xuXHRcdGxldCBodG1sRWxlbWVudCA9IHt9O1xuXHRcdGxldCBkb2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NlbmUnKTsgLy8gPGEtc2NlbmU+IHJlZmVyZW5jZVxuXG5cdFx0Ly8gcmVwb3NpdGlvbiBjYW1lcmEgLSBjYW1lcmEgbXVzdCBiZSBhbHJlYWR5IHByZXNlbnQgd2hlbiBodG1sIGxvYWRzXG5cdFx0bGV0IGNhbWVyYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW1lcmEnKTtcblx0XHQvL2NhbWVyYS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgZGF0YS5vY2Vhbi54ICsgXCIgXCIgKyBkYXRhLm9jZWFuLnkgKyBcIiBcIiArIGRhdGEub2NlYW4ueik7XG5cdFx0Y2FtZXJhLnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBkYXRhLm1hcC54ICsgXCIgXCIgKyBkYXRhLm1hcC55ICsgXCIgXCIgKyAoZGF0YS5tYXAueisoMS41KmRhdGEubWFwLngpKSk7XG5cdFx0Y2FtZXJhLnNldEF0dHJpYnV0ZSgnY2FtZXJhJywgJ3VzZXJIZWlnaHQ6ICcgKyBPUFRJT04uQ2FtZXJhWU9mZnNldCk7XG5cdFx0Y2FtZXJhLnNldEF0dHJpYnV0ZSgncm90YXRpb24nLCAtTWF0aC5hdGFuKE9QVElPTi5DYW1lcmFZT2Zmc2V0LyhkYXRhLm1hcC56K2RhdGEubWFwLngpKSk7XG5cblx0XHQvLyBHZW5lcmF0ZSBNYXBcblx0XHQvLyBUT0RPOiBQb3NzaWJsZSBlZGdlIGNhc2VzIHdpdGggdGhlIG1hcCBlZGdlIG5vdCBiZWluZyBiaWcgZW5vdWdoXG5cdFx0bGV0IG1hcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Etb2NlYW4nKTtcblx0XHRtYXAuc2V0QXR0cmlidXRlKCdwb3NpdGlvbicsIGRhdGEubWFwLnggKyBcIiBcIiArIGRhdGEubWFwLnkgKyBcIiBcIiArIGRhdGEubWFwLnopO1xuXHRcdG1hcC5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgU3RyaW5nKGRhdGEubWFwLndpZHRoKSk7XG5cdFx0bWFwLnNldEF0dHJpYnV0ZSgnZGVwdGgnLCBTdHJpbmcoZGF0YS5tYXAuZGVwdGgpKTtcblx0XHRtYXAuc2V0QXR0cmlidXRlKCdkZW5zaXR5JywgU3RyaW5nKGRhdGEubWFwLmRlbnNpdHkpKTtcblx0XHRkb2MuYXBwZW5kQ2hpbGQobWFwKTtcblxuXHRcdC8vIFNwYXduIFNoaXBzXG5cdFx0ZGF0YS5zaGlwcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuXHRcdFx0aHRtbEVsZW1lbnRbZW50cnkuaWRdID0gYmF0dGxlc2hpcC5yZW5kZXIoZW50cnkpO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIGh0bWxFbGVtZW50O1xuXHR9XG5cblx0ZnVuY3Rpb24gaW5pdFNjZW5lKGlucHV0cykge1xuXHRcdGxldCBkb2MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NlbmUnKTtcblx0XHRsZXQgdHJhY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhLWN1cnZlJyk7XG5cdFx0dHJhY2suc2V0QXR0cmlidXRlKCdpZCcsICd0cmFjaycpO1xuXHRcdHRyYWNrLnNldEF0dHJpYnV0ZSgndHlwZScsICdMaW5lJyk7XG5cdFx0ZG9jLmFwcGVuZENoaWxkKHRyYWNrKTtcblxuXHRcdGxldCBkYXRhID0gcHJlcHJvY2VzcyhpbnB1dHMpO1xuXHRcdGxldCBodG1sRWxlbWVudHMgPSByZW5kZXIoZGF0YSk7XG5cdFx0ZGF0YVsnaHRtbCddID0gaHRtbEVsZW1lbnRzXG5cblx0XHRsZXQgc2xpZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2xpZGVyJyk7XG5cdFx0c2xpZGUuc2V0QXR0cmlidXRlKCdtaW4nLCAwKTtcblx0XHRzbGlkZS5zZXRBdHRyaWJ1dGUoJ21heCcsIGRhdGEudGltZWxpbmUubGVuZ3RoKTtcblx0XHRzbGlkZS52YWx1ZSA9IDA7XG5cdFx0c2xpZGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKCkgPT4ge1xuXHRcdFx0RVZFTlRTLlNsaWRlck1vdXNlRG93biA9IHRydWU7XG5cdFx0fSk7XG5cdFx0c2xpZGUuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsICgpID0+IHtcblx0XHRcdEVWRU5UUy5TbGlkZXJNb3VzZURvd24gPSBmYWxzZTtcblx0XHRcdEVWRU5UUy5TbGlkZXJNb3VzZVVwID0gdHJ1ZTtcblx0XHRcdEVWRU5UUy5TbGlkZXJWYWx1ZSA9IHNsaWRlci52YWx1ZTtcblx0XHR9KTtcblxuXHRcdHRlc3QgPSBkYXRhO1xuXG5cdFx0Ly8gYmVnaW4gc2ltdWxhdGlvblxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0c2ltdWxhdGUoZGF0YSk7XG5cdFx0fSwgMTAwMClcblx0fVxuXG5cdGZ1bmN0aW9uIHNpbXVsYXRlKGRhdGEpIHtcblx0XHRsZXQgc2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzbGlkZXJcIik7XG5cdFx0bGV0IGN1cnJlbnQgPSBkYXRhLnRpbWVsaW5lW2RhdGEucHJlc2VudCsrXTtcblx0XHRsZXQgaXNEb25lID0gZmFsc2U7XG5cdFx0aWYgKGRhdGEucHJlc2VudCA9PSBkYXRhLnRpbWVsaW5lLmxlbmd0aClcblx0XHRcdGlzRG9uZSA9IHRydWU7XG5cdFx0XG5cdFx0Ly8gVE9ETzogVXNlIHRoZSBPUFRJT04ncyB0aW1lIGJldHdlZW4gcGVyIGFjdGlvbiB0byBhbmltYXRlIHNsaWRlciBpbmNyZW1lbnRcblx0XHRpZiAoIUVWRU5UUy5TbGlkZXJNb3VzZURvd24pIHtcblx0XHRcdHNsaWRlci52YWx1ZSA9IGRhdGEucHJlc2VudDtcblx0XHR9XG5cdFx0XG5cdFx0aWYgKEVWRU5UUy5TbGlkZXJNb3VzZVVwKSB7XG5cdFx0XHRFVkVOVFMuU2xpZGVyTW91c2VVcCA9IGZhbHNlO1xuXHRcdFx0ZGF0YS5wcmVzZW50ID0gRVZFTlRTLlNsaWRlclZhbHVlO1xuXHRcdFx0YmF0dGxlc2hpcC51cGRhdGUoZGF0YS5odG1sLCBjdXJyZW50KS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdHNpbXVsYXRlKGRhdGEpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0ZWxzZSBpZiAoY3VycmVudCAmJiAhaXNEb25lKSB7XG5cdFx0XHRzd2l0Y2goY3VycmVudC50YXNrLnR5cGUpIHtcblx0XHRcdFx0Y2FzZSBcIk1PVkVcIjpcblx0XHRcdFx0XHRiYXR0bGVzaGlwLm1vdmVTaGlwKGRhdGEuaHRtbCwgY3VycmVudCwgT1BUSU9OKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHRzaW11bGF0ZShkYXRhKTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKCdFcnJvciBhdCBtb3ZlbWVudCBzaW11bGF0aW9uOiAnLCBlcnIpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiRklSRVwiOlxuXHRcdFx0XHRcdGJhdHRsZXNoaXAuZmlyZVNoaXAoY3VycmVudCwgT1BUSU9OKS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHQvL2FsZXJ0KFwiRmlyZWQgXCIgKyBkYXRhLnR1cm5zLmxlbmd0aCArIFwiIGFjdGlvbnMgbGVmdFwiKTtcblx0XHRcdFx0XHRcdC8vIGNvbnNvbGUubG9nKFwiRmlyZSBjYXNlIDA6IFwiLCBkYXRhLnByZXNlbnQudGFzay50eXBlKTtcblx0XHRcdFx0XHRcdHNpbXVsYXRlKGRhdGEpO1xuXHRcdFx0XHRcdFx0Ly8gfSk7XG5cdFx0XHRcdFx0fSkuY2F0Y2goKGVycikgPT4ge1xuXHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcignRXJyb3IgYXQgZmlyaW5nIHNpbXVsYXRpb246ICcsIGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJTSU5LXCI6XG5cdFx0XHRcdFx0YmF0dGxlc2hpcC5zaW5rU2hpcChkYXRhLmh0bWwsIGN1cnJlbnQsIE9QVElPTikudGhlbigoZG9uZSkgPT4ge1xuXHRcdFx0XHRcdFx0Ly9hbGVydChcIlN1bmsgXCIrIGRhdGEudHVybnMubGVuZ3RoICsgXCIgYWN0aW9ucyBsZWZ0XCIpO1xuXHRcdFx0XHRcdFx0c2ltdWxhdGUoZGF0YSk7XG5cdFx0XHRcdFx0XHQvLyB9KTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmVycm9yKCdFcnJvciBhdCBzaW5raW5nIHNpbXVsYXRpb246ICcsIGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgXCJISVRcIjpcblx0XHRcdFx0XHRiYXR0bGVzaGlwLmhpdFNoaXAoZGF0YS5odG1sLCBjdXJyZW50KS50aGVuKChkb25lKSA9PiB7XG5cdFx0XHRcdFx0XHRzaW11bGF0ZShkYXRhKTtcblx0XHRcdFx0XHR9KS5jYXRjaCgoZXJyKSA9PiB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZygnRXJyb3IgYXQgc2hpcCBkYW1hZ2Ugc2ltdWxhdGlvbjogJywgZXJyKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcIkVORFwiOlxuXHRcdFx0XHRcdC8vIERpc2FibGVkIHNsaWRlciBiZWNhdXNlIHJlc2V0dGluZyB0aW1lbGluZSBpcyBub3Qgd29ya2luZ1xuXHRcdFx0XHRcdC8vIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG5cdFx0XHRcdFx0Ly8gXHRzaW11bGF0ZShkYXRhKTtcblx0XHRcdFx0XHQvLyBcdHNsaWRlci5yZW1vdmVFdmVudExpc3RlbmVyKCdjaGFuZ2UnKTtcblx0XHRcdFx0XHQvLyB9KTtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRcdGFsZXJ0KFwiU2ltdWxhdGlvbiBEb25lLCB1c2Ugc2xpZGVyIHRvIHBsYXliYWNrLlwiKTtcblx0XHRcdFx0XHR9LCA1MDAwKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcIlNUQVJUXCI6XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coJ1JlYWRpbmcgc3RhcnQgb2Ygc2ltdWxhdGlvbiBtYXJrZXIuJyk7XG5cdFx0XHRcdFx0c2ltdWxhdGUoZGF0YSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0Y29uc29sZS5sb2coYFVua25vd24gQWN0aW9uIFR5cGUgJHtjdXJyZW50LnR5cGV9IGluIHNpbXVsYXRlIGZ1bmN0aW9uLCBza2lwcGluZy5gKTtcblx0XHRcdFx0XHQvLyBjb21tZW50IGJlbG93IGR1cmluZyBkZXZlbG9wbWVudCB0byBjYXRjaCBidWdzLCBwcm9kdWN0aW9uIGNvZGUgc2hvdWxkIGNvbnRpbnVlIGFsb25nIHdpdGggc2ltdWxhdGlvblxuXHRcdFx0XHRcdC8vc2ltdWxhdGUoZGF0YSk7O1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBEaXNhYmxlZCBzbGlkZXIgYmVjYXVzZSByZXNldHRpbmcgdGltZWxpbmUgaXMgbm90IHdvcmtpbmdcblx0XHRcdC8vIHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG5cdFx0XHQvLyBcdHNpbXVsYXRlKGRhdGEpO1xuXHRcdFx0Ly8gXHRzbGlkZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2hhbmdlJyk7XG5cdFx0XHQvLyB9KTtcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHRhbGVydChcIlNpbXVsYXRpb24gRG9uZS4uLlwiKTtcblx0XHRcdH0sIDEwMDAwKTtcblx0XHR9XG5cdH1cblxuXHQvLyBwdWJsaWNcblx0dmFyIGFwcCA9IHtcblxuXHRcdGluaXQ6ICgpID0+IHtcblx0XHRcdGxldCBpbnB1dHMgPSB7fTtcblx0XHRcdGxldCBjb2RlID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdjb2RlJyk7XG5cblx0XHRcdGlmIChjb2RlKSB7XG5cdFx0XHRcdGxldCByZWYgPSBkYXRhYmFzZS5yZWYoJ2Rhdnktam9uZXMtbG9ja2VyJykuY2hpbGQoY29kZSk7XG5cdFx0XHRcdHJlZi5vbmNlKCd2YWx1ZScsIChyZXMpID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcIkZpcmViYXNlOiBcIiwgcmVzLnZhbCgpKTtcblx0XHRcdFx0XHRpbnB1dHMgPSB7XG5cdFx0XHRcdFx0XHRcImlkc1wiOiByZXMudmFsKCkuaW5pdC5zaGlwcy5tYXAoKHMpID0+IHsgcmV0dXJuIHMuaWQgfSksXG5cdFx0XHRcdFx0XHRcInNoaXBzXCI6IHJlcy52YWwoKS5pbml0LnNoaXBzLFxuXHRcdFx0XHRcdFx0XCJ0dXJuc1wiOiByZXMudmFsKCkudHVybnMsXG5cdFx0XHRcdFx0XHRcIm9jZWFuXCI6IHJlcy52YWwoKS5pbml0Lm1hcFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0sIChlcnIpID0+IHsgXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKGBVbmtub3duIFVSTCBDb2RlICR7Y29kZX0sIHVzaW5nIGRlZmF1bHQgb2ZmbGluZSBpbnB1dGApO1xuXHRcdFx0XHRcdGlucHV0cyA9IHtcblx0XHRcdFx0XHRcdFwiaWRzXCI6IGlucHV0LmluaXQuc2hpcHMubWFwKChzKSA9PiB7IHJldHVybiBzLmlkIH0pLFxuXHRcdFx0XHRcdFx0XCJzaGlwc1wiOiBpbnB1dC5pbml0LnNoaXBzLCBcblx0XHRcdFx0XHRcdFwidHVybnNcIjogaW5wdXQudHVybnMsIFxuXHRcdFx0XHRcdFx0XCJvY2VhblwiOiBpbnB1dC5pbml0Lm1hcFxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhcImluaXQoKSBcIiwgaW5wdXRzKTtcblx0XHRcdFx0XHRpbml0U2NlbmUoaW5wdXRzKTtcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnTWlzc2luZyBVUkwgcGFyYW1ldGVyIGNvZGUsIHVzaW5nIGRlZmF1bHQgb2ZmbGluZSBpbnB1dCcpO1xuXHRcdFx0XHRpbnB1dHMgPSB7XG5cdFx0XHRcdFx0XCJpZHNcIjogaW5wdXQuaW5pdC5zaGlwcy5tYXAoKHMpID0+IHsgcmV0dXJuIHMuaWQgfSksXG5cdFx0XHRcdFx0XCJzaGlwc1wiOiBpbnB1dC5pbml0LnNoaXBzLCBcblx0XHRcdFx0XHRcInR1cm5zXCI6IGlucHV0LnR1cm5zLCBcblx0XHRcdFx0XHRcIm9jZWFuXCI6IGlucHV0LmluaXQubWFwXG5cdFx0XHRcdH1cblx0XHRcdFx0Y29uc29sZS5sb2coXCJpbml0KCkgXCIsIGlucHV0cyk7XG5cdFx0XHRcdGluaXRTY2VuZShpbnB1dHMpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblxuXHRyZXR1cm4gYXBwO1xufVxuXG5sZXQgYXBwID0gU2ltdWxhdGlvbigpO1xuYXBwLmluaXQoKTtcblxuLy9sZXQgcGFyYW1zID0gZ2V0UGFyYW1ldGVyQnlOYW1lKGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaCk7XG5cbi8vIGxldCBnZXREYXRhRnJvbUNvZGUgPSAoY29kZSkgPT4ge1xuLy8gXHRkYXRhYmFzZS5yZWYoJ2Rhdnktam9uZXMtbG9ja2VyLycgKyBjb2RlKS5vbmNlKCd2YWx1ZScsIChzbmFwc2hvdCkgPT4ge1xuLy8gXHRcdHZhciBnYW1lRGF0YSA9IHNuYXBzaG90LnZhbCgpO1xuLy8gXHRcdGlmIChnYW1lRGF0YSkge1xuLy8gXHRcdFx0aW5wdXQgPSBnYW1lRGF0YTtcbi8vIFx0XHRcdGFwcC5pbml0KCk7XG4vLyBcdFx0fSBlbHNlIHtcbi8vIFx0XHRcdGdldENvZGUoYE5vIGRhdGEgZm9yIGNvZGUgJHtjb2RlfS4gRW50ZXIgYW5vdGhlciBjb2RlOmApO1xuLy8gXHRcdFx0Ly9hcHAuaW5pdCgpO1xuLy8gXHRcdH1cbi8vIFx0fSkuY2F0Y2goKGVycikgPT4ge1xuLy8gXHRcdGdldENvZGUoYFRoZXJlIHdhcyBhbiBlcnJvci4gRW50ZXIgYW5vdGhlciBjb2RlOmApO1xuLy8gXHRcdC8vYXBwLmluaXQoKTtcbi8vIFx0fSk7XG4vLyB9XG5cbi8vIGxldCBnZXRDb2RlID0gKG1lc3NhZ2UpID0+IHtcbi8vIFx0dmV4LmRpYWxvZy5wcm9tcHQoe1xuLy8gXHRcdG1lc3NhZ2U6IG1lc3NhZ2UsXG4vLyBcdFx0Y2FsbGJhY2s6ICh2YWx1ZSkgPT4ge1xuLy8gXHRcdFx0aWYgKHZhbHVlKSB7XG4vLyBcdFx0XHRcdHZhciBjb2RlID0gdmFsdWU7XG4vLyBcdFx0XHRcdGdldERhdGFGcm9tQ29kZShjb2RlKTtcbi8vIFx0XHRcdH0gZWxzZSB7XG4vLyBcdFx0XHRcdGdldENvZGUoXCJObyBjb2RlIGVudGVyZWQuIEVudGVyIHlvdXIgY29kZTpcIik7XG4vLyBcdFx0XHR9XG4vLyBcdFx0fVxuLy8gXHR9KTtcbi8vIH1cblxuLy8gaWYgKHBhcmFtcy5jb2RlKSB7XG4vLyBcdGdldERhdGFGcm9tQ29kZShwYXJhbXMuY29kZSk7XG4vLyB9IGVsc2Uge1xuLy8gXHRnZXRDb2RlKFwiRW50ZXIgWW91ciBDb2RlXCIpO1xuLy8gfVxuXG5cbi8vIHZhciBCQVRUTEVfU0VSVkVSX1VSTCA9ICdodHRwczovL2JhdHRsZXNoaXAtdmluZ2thbi5jOXVzZXJzLmlvLzF2MT9wMT1lc2kxNy5jcy5EZXN0cm95ZXJTaGlwJnAyPWVzaTE3LmhsaTEwOS5GbG9hdGVyJzsvLyArIE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMTAwKTtcblxuLy8gJC5nZXQoQkFUVExFX1NFUlZFUl9VUkwpLnRoZW4oZGF0YSA9PiB7XG4vLyBcdGlucHV0ID0gZGF0YTtcbi8vIFx0YXBwLmluaXQoKTtcbi8vIH0pLmRvbmUoKCkgPT4ge1xuLy8gXHRjb25zb2xlLmxvZyhcIkRhdGEgc3VjY2Vzc2Z1bGx5IHJldHJpZXZlZCBmcm9tIHNlcnZlclwiKTtcbi8vIH0pLmZhaWwoKCkgPT4ge1xuLy8gXHRjb25zb2xlLmxvZyhcIlVuYWJsZSB0byByZXRyaWV2ZSBkYXRhLCBzdGFydGluZyB3aXRoIGxvY2FsIGRhdGFcIik7XG4vLyBcdGFwcC5pbml0KCk7XG4vLyB9KTtcblxuXG5cbiJdfQ==\n"]}