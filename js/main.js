!function t(e,n,s){function i(o,r){if(!n[o]){if(!e[o]){var p="function"==typeof require&&require;if(!r&&p)return p(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};e[o][0].call(c.exports,function(t){var n=e[o][1][t];return i(n||t)},c,c.exports,t,e,n,s)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<s.length;o++)i(s[o]);return i}({1:[function(t,e,n){"use strict";function s(){function t(t,e,n){console.log("transform() ",t);return t.map(function(t){return t.hasOwnProperty("atX")&&t.hasOwnProperty("atY")&&(t.atX=e*t.atX,t.atZ=e*t.atY,t.atY=n.ShipYOffset),t.x=e*t.x,t.z=e*t.y,t.y=n.ShipYOffset,t})}function e(e,n){var s={};console.log("preprocess() ",e,n),s.map={x:n.GridScale*Math.floor(e.ocean.x/2)-2,y:n.OceanYOffset,z:n.GridScale*Math.floor(e.ocean.y/2),width:200,depth:200,density:120},s.ships=t(e.ships,n.GridScale,n),s.ships.forEach(function(t){t.sunk=!1}),s.turns=function(t){var e=[];return t.map(function(t){if(e&&e.length>0){var n=e[e.length-1].actions;n[0].id===t.id&&n[0].type===t.type&&("MOVE"===n[0].type||"FIRE"===n[0].type&&n[0].atX===t.atX&&n[0].atY===t.atY)?n.push(t):e.push({type:t.type,actions:[t]})}else e.push({type:t.type,actions:[t]})}),console.log(e),e}(t(e.turns,n.GridScale,n)),s.turns.push({type:"END",actions:void 0}),console.log(s),s.snapshots={past:[],present:{},future:[]},console.log("init states: ",s.ships);var i={states:s.ships,next:s.turns[0]};return s.turns.forEach(function(t){s.snapshots.future.unshift(i),i=function(t,e,n){console.log(t);var s={states:t.states,next:e};return s.states=t.states.map(function(t){if(e.id!==t.id)return t;switch(e.type){case"MOVE":var n=e.actions[e.actions.length-1];return t.z=n.z,t.x=n.x,t;case"Sunk":return t.sunk=!0,t;default:return t}}),s}(i,t)}),s.snapshots.present=s.snapshots.future.pop(0),console.log(s),s}function n(t){var n=document.getElementById("scene"),i=document.createElement("a-curve");i.setAttribute("id","track"),i.setAttribute("type","Line"),n.appendChild(i),console.log("initScene() preprocess() ",t);var p=e(t,r),u=function(t,e){var n={},s=document.getElementById("scene"),i=document.getElementById("camera");i.setAttribute("position",t.map.x+" "+t.map.y+" "+(t.map.z+1.5*t.map.x)),i.setAttribute("camera","userHeight: "+e.CameraYOffset),i.setAttribute("rotation",-Math.atan(e.CameraYOffset/(t.map.z+t.map.x)));var o=document.createElement("a-ocean");return o.setAttribute("position",t.map.x+" "+t.map.y+" "+t.map.z),o.setAttribute("width",String(t.map.width)),o.setAttribute("depth",String(t.map.depth)),o.setAttribute("density",String(t.map.density)),s.appendChild(o),t.ships.forEach(function(t){n[t.id]=a.render(t)}),n}(p,r);console.log("initScene() render() ",u);var c=document.getElementById("slider");c.setAttribute("min",0),c.setAttribute("max",p.snapshots.future.length),c.value=0;var l={html:u,snapshots:p.snapshots};o=l,setTimeout(function(){s(l,r)},1e3)}function s(t,e){console.log("simulate: ",t);document.getElementById("slider").value=t.snapshots.past.length;var n=!1;0==t.snapshots.future.length&&(n=!0);var i=t.snapshots.future.pop(),o=t.html;if(i&&!n)switch(console.log("current: ",i),i.next.type){case"MOVE":a.moveShip(o,i.next.actions,e).then(function(n){t.snapshots.past.push(t.snapshots.present),t.snapshots.present=i,s(t,e)}).catch(function(t){console.error(t)});break;case"FIRE":a.fireShip(i.next.actions,e).then(function(n){t.snapshots.past.push(t.snapshots.present),t.snapshots.present=i,s(t,e)}).catch(function(t){console.error(t)});break;case"SINK":a.sinkShip({html:t.html,present:i},e).then(function(n){t.snapshots.past.push(t.snapshots.present),t.snapshots.present=i,s(t,e)}).catch(function(t){console.error(t)});break;case"HIT":break;case"END":setTimeout(function(){alert("Simulation Done")},1e4);break;default:console.log("Unknown Action Type "+i.type+" in simulate function, skipping.")}else setTimeout(function(){alert("Simulation Done")},1e4)}var r={GridScale:4,CameraYOffset:15,OceanYOffset:0,OceanPadding:10,ShipYOffset:0,SinkDistance:5,BulletArc:2,WaitTimePerTileMoved:300,WaitTimeBetweenAction:50};return{init:function(){var t={},e=function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("code");if(e){i.ref("davy-jones-locker").child(e).once("value",function(e){t={ids:e.val().init.ships.map(function(t){return t.id}),ships:e.val().init.ships,turns:e.val().turns,ocean:e.val().init.map}},function(n){console.warn("Unknown URL Code "+e+", using default offline input"),t={ids:input.init.ships.map(function(t){return t.id}),ships:input.init.ships,turns:input.turns,ocean:input.init.map}}).then(function(){console.log("init() ",t),n(t)})}else console.log("Missing URL parameter code, using default offline input"),t={ids:input.init.ships.map(function(t){return t.id}),ships:input.init.ships,turns:input.turns,ocean:input.init.map},console.log("init() ",t),n(t)}}}firebase.initializeApp({apiKey:"AIzaSyA9EYUXVL5WAh6Aam1qXlWyvi3b7HLcZ1U",authDomain:"esigamma.firebaseapp.com",databaseURL:"https://esigamma.firebaseio.com",projectId:"esigamma",storageBucket:"esigamma.appspot.com",messagingSenderId:"734163636039"});var i=firebase.database(),a=Ship(),o=void 0;s().init()},{}]},{},[1]);
//# sourceMappingURL=maps/main.js.map
