!function t(e,n,i){function a(o,r){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!r&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[o]={exports:{}};e[o][0].call(p.exports,function(t){var n=e[o][1][t];return a(n||t)},p,p.exports,t,e,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(t,e,n){"use strict";function i(){function t(t,e,n){console.log("transform() ",t);return t.map(function(t){return t.hasOwnProperty("atX")&&t.hasOwnProperty("atY")&&(t.atX=e*t.atX,t.atZ=e*t.atY,t.atY=n.ShipYOffset),t.x=e*t.x,t.z=e*t.y,t.y=n.ShipYOffset,t})}function e(e,n){var i={};console.log("preprocess() ",e),i.map={x:n.GridScale*Math.floor(e.ocean.x/2)-2,y:n.OceanYOffset,z:n.GridScale*Math.floor(e.ocean.y/2),width:200,depth:200,density:120},i.ships=t(e.ships,n.GridScale),i.ships.forEach(function(t){t.sunk=!1}),i.turns=actionChain(t(e.turns,n.GridScale,n)),i.turns.push({type:"END",actions:void 0}),console.log(i),i.snapshots={past:[],present:{},future:[]},console.log("init states: ",i.ships);var a={states:i.ships,next:resutl.turns[0]};return i.turns.forEach(function(t){i.snapshots.future.append(a),a=function(t,e,n){console.log(t);var i={states:t.states,next:e};return i.states=t.states.map(function(t){if(e.id!==t.id)return t;switch(e.type){case"MOVE":var n=e.actions[e.actions.length-1];return t.z=n.z,t.x=n.x,t;case"Sunk":return t.sunk=!0,t;default:return t}}),i}(a,t)}),i.snapshots.present=i.snapshots.future.pop(0),console.log(i),i}function n(t){var n=document.getElementById("scene"),a=document.createElement("a-curve");a.setAttribute("id","track"),a.setAttribute("type","Line"),n.appendChild(a),console.log("initScene() ",t);var c=e(t,r),u=function(t,e){var n={},i=document.getElementById("scene"),a=document.getElementById("camera");a.setAttribute("position",t.map.x+" "+t.map.y+" "+(t.map.z+1.5*t.map.x)),a.setAttribute("camera","userHeight: "+e.CameraYOffset),a.setAttribute("rotation",-Math.atan(e.CameraYOffset/(t.map.z+t.map.x)));var o=document.createElement("a-ocean");o.setAttribute("position",t.map.x+" "+t.map.y+" "+t.map.z),o.setAttribute("width",String(t.map.width)),o.setAttribute("depth",String(t.map.depth)),o.setAttribute("density",String(t.map.density)),i.appendChild(o),t.ships.forEach(function(t){n[t.id]=s.render(t)})}(c,r);console.log(c);var p=document.getElementById("slider");p.setAttribute("min",0),p.setAttribute("max",c.snapshots.future.length),p.value=0;var f={html:u,snapshots:c.snapshots};o=f,setTimeout(function(){i()},1e4)}function i(){var t=!0;0==c.length&&(t=!1);var e=c.shift();if(e&&t)switch(e.type){case"MOVE":s.moveShip(e.actions).then(function(t){i()}).catch(function(t){console.error(t)});break;case"FIRE":s.fireShip(e.actions).then(function(t){i()}).catch(function(t){console.error("error: ",t)});break;case"HIT":s.hitShip(e.actions).then(function(t){i()}).catch(function(t){console.log(t)});break;case"SINK":s.sinkShip(e.actions).then(function(t){i()}).catch(function(t){console.error(t)});break;default:console.warn("Unknown Action type "+e.type+" in simulate function, skipping."),i()}else setTimeout(function(){vex.dialog.alert("Simulation Completed.")},1e3)}var r={GridScale:4,CameraYOffset:25,OceanYOffset:0,OceanPadding:10,ShipYOffset:0,SinkDistance:5,BulletArc:2,WaitTimePerTileMoved:300,WaitTimeBetweenAction:50},c=[];return{init:function(){var t={},e=function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("code");if(e){a.ref("davy-jones-locker").child(e).once("value",function(e){t={ids:e.val().init.ships.map(function(t){return t.id}),ships:e.val().init.ships,turns:e.val().turns,ocean:e.val().init.map}},function(n){console.warn("Unknown URL Code "+e+", using default offline input"),t={ids:input.init.ships.map(function(t){return t.id}),ships:input.init.ships,turns:input.turns,ocean:input.init.map}}).then(function(){console.log("init() ",t),n(t)})}else console.log("Missing URL parameter code, using default offline input"),t={ids:input.init.ships.map(function(t){return t.id}),ships:input.init.ships,turns:input.turns,ocean:input.init.map},console.log("init() ",t),n(t)}}}firebase.initializeApp({apiKey:"AIzaSyA9EYUXVL5WAh6Aam1qXlWyvi3b7HLcZ1U",authDomain:"esigamma.firebaseapp.com",databaseURL:"https://esigamma.firebaseio.com",projectId:"esigamma",storageBucket:"esigamma.appspot.com",messagingSenderId:"734163636039"});var a=firebase.database(),s=Ship(),o=void 0;i().init()},{}]},{},[1]);
//# sourceMappingURL=maps/main.js.map
