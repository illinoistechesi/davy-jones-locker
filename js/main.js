!function e(t,n,i){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return a(n||e)},l,l.exports,e,t,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(e,t,n){"use strict";function i(){function e(e,t){console.log("transform() ",e);return e.map(function(e){return e.hasOwnProperty("atX")&&e.hasOwnProperty("atY")&&(e.atX=t*e.atX,e.atZ=t*e.atY,e.atY=s.ShipYOffset),e.x=t*e.x,e.z=t*e.y,e.y=s.ShipYOffset,e})}function t(t){var n={};console.log("preprocess() ",t),n.map={x:s.GridScale*Math.floor(t.ocean.x/2)-2,y:s.OceanYOffset,z:s.GridScale*Math.floor(t.ocean.y/2),width:200,depth:200,density:120},n.ships=e(t.ships,s.GridScale),n.ships.forEach(function(e){e.sunk=!1,e.health=e.hull}),n.turns=function(e){var t=[];return e.map(function(e){if(t&&t.length>0){var n=t[t.length-1].actions;n[0].id===e.id&&n[0].type===e.type&&("MOVE"===n[0].type||"FIRE"===n[0].type&&n[0].atX===e.atX&&n[0].atY===e.atY)?n.push(e):t.push({type:e.type,actions:[e]})}else t.push({type:e.type,actions:[e]})}),console.log(t),t}(e(t.turns,s.GridScale)),n.turns.push({type:"END",actions:void 0}),n.turns.unshift({type:"START",actions:void 0}),console.log(n),n.timeline=[],n.present=0,console.log("init states: ",n.ships);var i={states:n.ships,task:n.turns[0]};return n.turns.forEach(function(e){i=function(e,t){console.log(e);var n={states:e.states,task:t};return n.states=e.states.map(function(e){if(t.id!==e.id)return e;switch(t.type){case"MOVE":var n=t.actions[t.actions.length-1];return e.z=n.z,e.x=n.x,e;case"SINK":return e.sunk=!0,e;case"Hit":return e.health--,e;default:return e}}),n}(i,e),n.timeline.push(i)}),console.log(n),n}function n(e){var n=document.getElementById("scene"),a=document.createElement("a-curve");a.setAttribute("id","track"),a.setAttribute("type","Line"),n.appendChild(a);var c=t(e),l=function(e){var t={},n=document.getElementById("scene"),i=document.getElementById("camera");i.setAttribute("position",e.map.x+" "+e.map.y+" "+(e.map.z+1.5*e.map.x)),i.setAttribute("camera","userHeight: "+s.CameraYOffset),i.setAttribute("rotation",-Math.atan(s.CameraYOffset/(e.map.z+e.map.x)));var a=document.createElement("a-ocean");return a.setAttribute("position",e.map.x+" "+e.map.y+" "+e.map.z),a.setAttribute("width",String(e.map.width)),a.setAttribute("depth",String(e.map.depth)),a.setAttribute("density",String(e.map.density)),n.appendChild(a),e.ships.forEach(function(e){t[e.id]=r.render(e)}),t}(c);c.html=l;var p=document.getElementById("slider");p.setAttribute("min",0),p.setAttribute("max",c.timeline.length),p.value=0,p.addEventListener("mousedown",function(){u.SliderMouseDown=!0}),p.addEventListener("mouseup",function(){u.SliderMouseDown=!1,u.SliderMouseUp=!0,u.SliderValue=slider.value}),o=c,setTimeout(function(){i(c)},1e3)}function i(e){var t=document.getElementById("slider"),n=e.timeline[e.present++],a=!1;if(e.present==e.timeline.length&&(a=!0),u.SliderMouseDown||(t.value=e.present),u.SliderMouseUp)return u.SliderMouseUp=!1,e.present=u.SliderValue,void r.update(e.html,n).then(function(t){i(e)});if(n&&!a)switch(n.task.type){case"MOVE":r.moveShip(e.html,n,s).then(function(t){i(e)}).catch(function(e){console.error("Error at movement simulation: ",e)});break;case"FIRE":r.fireShip(n,s).then(function(t){i(e)}).catch(function(e){console.error("Error at firing simulation: ",e)});break;case"SINK":r.sinkShip(e.html,n,s).then(function(t){i(e)}).catch(function(e){console.error("Error at sinking simulation: ",e)});break;case"HIT":r.hitShip(e.html,n).then(function(t){i(e)}).catch(function(e){console.log("Error at ship damage simulation: ",e)});break;case"END":setTimeout(function(){alert("Simulation Done, use slider to playback.")},5e3);break;case"START":console.log("Reading start of simulation marker."),i(e);break;default:console.log("Unknown Action Type "+n.type+" in simulate function, skipping.")}else setTimeout(function(){alert("Simulation Done...")},1e4)}var s={GridScale:4,CameraYOffset:15,OceanYOffset:0,OceanPadding:10,ShipYOffset:0,SinkDistance:5,BulletArc:2,WaitTimePerTileMoved:300,WaitTimeBetweenAction:50},u={SliderMouseDown:!1,SliderMouseUp:!1,SliderValue:0};return{init:function(){var e={},t=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("code");if(t){a.ref("davy-jones-locker").child(t).once("value",function(t){console.log("Firebase: ",t.val()),e={ids:t.val().init.ships.map(function(e){return e.id}),ships:t.val().init.ships,turns:t.val().turns,ocean:t.val().init.map}},function(n){console.warn("Unknown URL Code "+t+", using default offline input"),e={ids:input.init.ships.map(function(e){return e.id}),ships:input.init.ships,turns:input.turns,ocean:input.init.map}}).then(function(){console.log("init() ",e),n(e)})}else console.log("Missing URL parameter code, using default offline input"),e={ids:input.init.ships.map(function(e){return e.id}),ships:input.init.ships,turns:input.turns,ocean:input.init.map},console.log("init() ",e),n(e)}}}firebase.initializeApp({apiKey:"AIzaSyA9EYUXVL5WAh6Aam1qXlWyvi3b7HLcZ1U",authDomain:"esigamma.firebaseapp.com",databaseURL:"https://esigamma.firebaseio.com",projectId:"esigamma",storageBucket:"esigamma.appspot.com",messagingSenderId:"734163636039"});var a=firebase.database(),r=Ship(),o=void 0;i().init()},{}]},{},[1]);
//# sourceMappingURL=maps/main.js.map
